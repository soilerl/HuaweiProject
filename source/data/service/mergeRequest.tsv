repository	id	iid	project_id	title	description	state	created_at	updated_at	merged_by_user_name	merged_at	closed_by_user_name	closed_at	target_branch	source_branch	author_user_name	source_project_id	target_project_id	sha	merge_commit_sha	squash_commit_sha	changes_count	additions	changes	deletions	file_count
tezos/tezos	65634523	1999	3836952	shell: add trace to 'unexpected_error_while_fetching_headers' event	A simple MR to add a bit more information to this generic error.	merged	2020-07-27T10:18:27.390Z	2020-07-28T16:47:51.513Z	romain.nl	2020-07-28T16:47:51.524Z			master	abate@unexpected	abate	9487506	3836952	6bc4bc0558c2d31373b833127aabc14e9319b9b6			2	7	13	6	2
tezos/tezos	65330288	1995	3836952	V7.3 release doc	Patches with the documentation for version 7.3.	merged	2020-07-23T08:57:48.708Z	2020-09-08T09:18:33.667Z	romain.nl	2020-07-23T10:11:19.712Z			master	romain-v7-doc	romain.nl	9487506	3836952	98cbf36bf8bbe2e853510f0eea8f4ddff12dc568			7	74	100	26	7
tezos/tezos	65367670	1996	3836952	Base: fix ocamldoc for network_version.mli	"# Context 

Fixes https://gitlab.com/tezos/tezos/-/issues/871.
This MR only changes a couple of ocamldoc comments.

# Reviewers

Possibly: @julien.t"	merged	2020-07-23T14:06:27.260Z	2020-07-27T11:09:40.274Z	pirbo	2020-07-27T11:09:40.283Z			master	romain-network-version-doc	romain.nl	9487506	3836952	33e13926938e41d1a26bac87c16e286592df4100			1	25	32	7	1
tezos/tezos	65246442	1991	3836952	Fix/enhance config show mockup	"On master, the command `./tezos-client --mode mockup config show mockup`
outputs.

``` text
Default value of --bootstrap-accounts:
...
Default value of --protocol-constants:
{ ""hard_gas_limit_per_operation"":
                                           ""1040000"",
                                         ""hard_gas_limit_per_block"":
                                           ""10400000"",
                                         ""hard_storage_limit_per_operation"":
                                           ""60000"", ""cost_per_byte"": ""1000,
                                           ""chain_id"": ""NetXynUjJNZm7wi"" }
```

The indentation of the second part is not ideal.

This MR fixes that issue so that the new output is:

``` text
Default value of --bootstrap-accounts:
...
Default value of --protocol-constants:
{ ""hard_gas_limit_per_operation"": ""1040000"",
  ""hard_gas_limit_per_block"": ""10400000"",
  ""hard_storage_limit_per_operation"": ""60000"", ""cost_per_byte"": ""1000"",
  ""chain_id"": ""NetXynUjJNZm7wi"" }
```


# Reviewers

@rafoo\_ @klakplok"	merged	2020-07-22T14:47:32.233Z	2020-07-27T14:25:32.199Z	pirbo	2020-07-27T14:25:32.220Z			master	rb@fix/mockup-show-config	richard.bonichon	14747364	3836952	cb7885ad139829f5289b6dd27579111c43741745			1	3	8	5	1
tezos/tezos	64948687	1984	3836952	Emacs/Michelson mode: ignore stderr when calling the client	"# Context 

This fixes a bug that prevents to use the Emacs Michelson mode with a mockup client whose data dir has not been initialised by the `tezos-client --data-dir <dir> create mockup` command.

Fixes: nomadic-labs/tezos#201 by implementing the first solution (ignore stderr).

# Manually testing the MR

- setup the mode to use a mockup client with an empty data dir such as `/tmp/mockup`: `(setq michelson-client-command ""tezos-client --base-dir /tmp/mockup --mode mockup --protocol ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"")`
- visit a Michelson file
- move point to an instruction and check that two stack types appear in the `*Michelson*` buffer

# Automatic testing

I don't think it is applicable here.

# Reviewers

Suggested reviewers: @klakplok, @julien.t, @richard.bonichon

Propose suitable reviewers for this MR."	merged	2020-07-20T12:47:11.380Z	2020-08-18T16:31:44.821Z	arvidnl	2020-08-14T05:47:04.041Z			master	rafoo@michelson_mode_ignore_stderr	rafoo_	9487506	3836952	fa2ce7a3d74c1e08b1fddf2bce188a0b46787191			1	2	4	2	1
tezos/tezos	64930601	1982	3836952	WIP: docs: deprecation policy	This MR add a deprecation policy for the REST API.	opened	2020-07-20T10:13:09.158Z	2020-10-27T09:41:09.349Z					master	abate@deprecations	abate	9487506	3836952	4ebdf168bb81eb746824c4c018baf53c6b9632ee			1	50	50	0	1
tezos/tezos	64948374	1983	3836952	Shell: allow more concurrency when shutting down	"# Context 

Shutting down the DDB occurred sequentially, with the reader for each peer and then the chain workers shutdown one after the other. This MR allows all the peer readers to be closed concurrently.

Fixes https://gitlab.com/tezos/tezos/-/issues/869

# Manually testing the MR

`dune build @src/lib_shell/runtest`

# Automatic testing

happens in the CI

# Reviewers

@bidinger"	merged	2020-07-20T12:44:32.991Z	2020-08-07T22:13:56.646Z	smondet	2020-08-07T22:13:56.957Z			master	raphael-p@more-concurrency-in-ddb	raphael-proust	9487506	3836952	ab76f17f6f984f3a635675879ff96aa561b3698a			1	16	30	14	1
tezos/tezos	65623074	1998	3836952	Doc: update ledger setup command	small update to the key-management doc	merged	2020-07-27T08:41:20.295Z	2020-07-27T12:47:31.773Z	pirbo	2020-07-27T12:47:31.780Z			master	marco-doc	paracetamolo	9487506	3836952	4ab199c2b297620df2a881f3c10ea1ac84d6b849			1	9	26	17	1
tezos/tezos	64955910	1985	3836952	RPC: Don't emit an empty trace even when given zero errors	"# Context 

The error monad uses lists of errors as trace. It relies on the invariant that traces are never empty (in multiple places in the implementation) but never enforces it statically.

The RPC library makes some conversions between error messages received as answers to queries, and tzresult values. The conversion for errors just plainly translated each json message of a certain array.

This MR checks whether the array of errors is empty and special cases on the empty array.

Might be a fix for https://gitlab.com/tezos/tezos/-/issues/864 but it'd need to be confirmed.

# Manually testing the MR

`dune build @src/lib_rpc/runtest`

And also the reproduction steps from the aforementioned issue:

> 1. Configure your baker client to use a remote HTTP signer.
> 2. Start the baker client.
> 3. Take the remote HTTP signer offline while you have the opportunity to bake blocks.
> 4. Wait until you see the crash.


# Reviewers

@vbotbol  @arvidnl"	merged	2020-07-20T13:42:20.203Z	2020-07-31T16:12:18.969Z	pirbo	2020-07-31T16:07:22.902Z			master	raphae-p@avoid-empty-trace-in-rpc	raphael-proust	9487506	3836952	0334aa6d02642148c22d2c52eb30a172e08df84e		c8d5de69fb390da17270e421bdb98e9bcd14bd5a	1	23	26	3	1
tezos/tezos	64798224	1979	3836952	WIP: CI: Add automatic deployment and monitoring service	"**CLOSED** in favor of pipeline triggers in a side repository : https://gitlab.com/nomadic-labs/monitoring-playbooks

This MR adds a new *manual* CI action to provision a remote machine with a node compiled from the current branch and run prometheus/grafana alongside using tezos-metrics to generate the associate metrics.

The action is manual, so it wont run at every commit. Moreover it uses a protected variable available only on selected branches, and as host it will use the branch name. This has to be manually associate  to a VM in the ansible-role respository.

In other words, provisioning a machine is a restricted action and it will do nothing if not properly configured for a specific branch and a specific VM.

This configuration is needed for the p2p_master branch.

Before merging I'd like also to move the ansible-role in nomadic-labs namespace."	closed	2020-07-17T18:26:54.341Z	2020-07-21T12:13:08.667Z			abate	2020-07-21T12:13:08.682Z	master	p2p_monitoring	abate	9487506	3836952	7ee2df25c6ea42b3b2e952ce64f86d81a24e4571			1	23	23	0	1
tezos/tezos	65057020	1986	3836952	Proto_compiler: turn all protocol warnings into errors	"# Context 

This change turns protocol compiler all warnings into errors (apart from the warnings that are already suppressed in warning-list `-w` above). This is to avoid introducing code change that triggers warnings, which go unnoticed because the CI build still passes.

# Manually testing the MR

To test, one can introduce a change in alpha protocol that triggers a warning and ensure that this warning fails the build.

# Automatic testing

This is tested by `dune build @runtest_compile_protocol`

# Reviewers

@romain.nl @pirbo @abate"	merged	2020-07-21T09:32:13.267Z	2020-07-27T13:21:34.540Z	pirbo	2020-07-27T10:29:33.488Z			master	tomas/proto-warn-error-all	tzemanovic	11412215	3836952	9174e749fa3b295a3762448f6136ca040a791b7c			14	56	112	56	14
tezos/tezos	64724954	1976	3836952	P2p: minor doc fix	Fixes https://gitlab.com/tezos/tezos/-/issues/870	merged	2020-07-17T08:21:43.784Z	2020-07-20T12:59:49.813Z	raphael-proust	2020-07-20T12:59:50.141Z			master	philb@p2p_minor_doc_fix	bidinger	9487506	3836952	e28ea01e6be8dc7e4ddede864ee9f76d09710b11			1	1	2	1	1
tezos/tezos	64531793	1971	3836952	Scripts: tezos-client uses --endpoint instead of --addr, --port, or --tls		merged	2020-07-15T15:05:56.109Z	2020-07-15T16:27:31.222Z	vbotbol	2020-07-15T16:27:31.301Z			master	endpoint_in_scripts	pirbo	9487506	3836952	e13f236a52e7606c8a90fdcd4a13c85785da0c07			3	32	64	32	3
tezos/tezos	65247090	1992	3836952	Fix that `config init -o file` fails + fix `--config-file` `password_filename` handling + add tests	"Fixes https://gitlab.com/nomadic-labs/tezos/-/issues/202

Branch: https://gitlab.com/nomadic-labs/tezos/-/commits/smelc-issue-202-config-init-cli-fix

Here's what this MR does:

- [X] Add a test witnessing the issue 202 (`config init -o` doesn't work anymore)
- [X] Remove command `config init mockup` and implement it in `config init` when `--mode mockup` is specified. This is possible because the two configurations and the two modes are orthogonal to each other. Check that the test passes, hereby fixing issue 202.
- [X] Add a roundtrip test that checks that the file generated by `config init` can be given as input and that `config init`ing again yields the same file as the original one.
- [X] The previous test revealed than field `password_filename` of `--config-file` was being ignored. Hence fix that too.
- [X] Remove command `config show mockup` and implement it in `config show`, for consistency.
- [X] Add tests of `config show`, because well, I was on the way :cat:

Note that, compared to the original report, we don't do any change to the baker. As @igarnier mentioned, the baker's options cannot be easily separated from the main client's options. However, because this MR changes `config init mockup` to `--mode mockup config init`, the baker should not be disturbed by the mockup mode anymore in its normal operations; since the baker is not supposed to pass `--mode mockup` in the first place.

Suggested reviewers: @igarnier @richard.bonichon @rafoo\_ @bidinger"	merged	2020-07-22T14:53:26.462Z	2020-07-31T10:12:32.967Z	pirbo	2020-07-31T10:12:32.974Z			master	smelc-issue-202-config-init-cli-fix	smelc	9487506	3836952	48a19c665452d19e1ca5bb458f61bd336e727191			4	314	451	137	4
tezos/tezos	64540779	1972	3836952	Fix error management in the baker	!1820 introduced a bug that made the baker close its context on any encountered error making it fail when it starts baking a new block. This MR fixes this issue by introducing a finaliser in the scheduler loop. The baker will now also retries baking a block for a maximum of 5 times before stopping and waiting for a new head.	merged	2020-07-15T16:17:26.972Z	2020-08-24T13:10:14.325Z	pirbo	2020-08-24T13:10:14.381Z			master	vbot@fix_baker_closing_context	vbotbol	9487506	3836952	6c7461bac93760e3ed40bba087b683194f22c275			10	82	104	22	10
tezos/tezos	65247349	1993	3836952	Mockup-mode: allow setting initial timestamp	"This MR allows an extra parameter to be setup for the mockup mode, that
is the `initial_timestamp` so that it can be something different from
`Time.Protocol.epoch`

Both the documentation and the tests have been augmented to reflect the change.

## Possible reviewers

@smelc @rafoo\_ @klakplok @igarnier"	merged	2020-07-22T14:55:07.329Z	2020-07-27T13:48:45.462Z	pirbo	2020-07-27T13:48:45.472Z			master	rb@mockup-initial-timestamp	richard.bonichon	14747364	3836952	2c5d199767b726c1b57e5c0d5dd6a81b2ed37945			5	90	126	36	5
tezos/tezos	64482061	1969	3836952	Shell/DDb: remove deadcode	Optional `?peer` parameter isn't used in `Advertise.current_head`, and `Advertise.current_branch`.	merged	2020-07-15T09:19:54.551Z	2020-08-03T08:51:16.472Z	raphael-proust	2020-08-03T08:51:16.480Z			master	philb@ddb_deadcode	bidinger	9487506	3836952	226038c3273c9ee53dbffd2194b2b786cfc7aa50			2	29	94	65	2
tezos/tezos	64288927	1965	3836952	Shell: small refactor	Fix #865	merged	2020-07-13T16:45:13.439Z	2020-07-15T13:48:27.386Z	pirbo	2020-07-15T13:48:27.823Z			master	raphael-p@small-refactoring-in-shell--fix-865	raphael-proust	9487506	3836952	d627a498205f89f5388dca6a32f54bcd67a7b1e7			1	10	22	12	1
tezos/tezos	64340424	1966	3836952	add minimal profile for rustup	"according to this https://github.com/rust-lang/rust-clippy/issues/5136 , the command `rustup toolchain install 1.39.0` fails on rpi because some unnecessary deps such as `rust-clippy` are unavailable for rpi.

running `rustup set profile minimal` fixes this issue"	merged	2020-07-14T03:50:07.417Z	2020-07-16T10:28:30.337Z	pirbo	2020-07-16T10:28:30.394Z			master	patch-1	chiptus	19939353	3836952	58cd897fb25ad94f637fdb7c0e8901f2d8d851aa			1	1	1	0	1
tezos/tezos	65221946	1987	3836952	Remove legacy logging from p2p events io scheduler	"This MR removes the legacy logging from p2p scheduler.
It also removes a couple of redundant debug messages.

To make the event handling more uniform I changed 
the type of p2p_io_scheduler.register to a Lwt.t type."	merged	2020-07-22T11:48:05.028Z	2020-09-17T11:47:00.702Z	pirbo	2020-07-27T09:25:31.704Z			master	abate@p2p_events_io_scheduler	abate	9487506	3836952	73482b7bcd4a2513b87e4a3031792bee5c1b37fd			2	154	208	54	2
tezos/tezos	64072724	1963	3836952	fixup! Error_monad: test recursive registration	Reflect dependency to alcotest-lwt in opam file	merged	2020-07-10T09:52:45.706Z	2020-07-10T10:51:12.321Z	pirbo	2020-07-10T10:51:12.366Z			master	error_monad_opam	pirbo	9487506	3836952	33cebf3f075e68bc426e93e7a22b5e508581ae92			1	1	1	0	1
tezos/tezos	64721114	1974	3836952	Client: mockup: load correct proto in config {show, init} mockup	"Fixes: nomadic-labs/tezos#200

Branch: [smelc-issue-200-mockup-cmd-glitchs](https://gitlab.com/nomadic-labs/tezos/-/commits/)

This MR has two commits:

1. Add a test that fails, because of issue nomadic-labs/tezos#200. The test is more general than the failure, it's a Cartesian product with 24 cases; 2 of them fail. All cases were untested so far.
2. Fix the problem, witness that the test passes now.

Suggested reviewers: @igarnier, @richard.bonichon, @rafoo\_"	merged	2020-07-17T07:47:50.481Z	2020-08-17T14:24:14.427Z	tzemanovic	2020-08-17T14:24:14.692Z			master	smelc-issue-200-mockup-cmd-glitchs	smelc	9487506	3836952	397dd233a10cc6df0df959e2a624c7947997dd0c			5	86	123	37	5
tezos/tezos	63809856	1959	3836952	[WIP] chain_validator: Refactorization for the new mempool	"This MR is extracted from !968 and is mostly a refactorization of the chain_validator with some change in the vocabulary.

Mostly the refactorization is about the use of the `lib_worker` library. Moreover, we have also added a request which is not used now but will be used by the new mempool (`notify_mempool`).

Moreover, we have changing the name `prevalidator` to `mempool_validator` according to !968 but currently we keep the `prevalidator` module as it is."	closed	2020-07-08T07:43:34.184Z	2020-09-22T12:49:38.851Z			Saroupille	2020-09-22T12:49:38.873Z	master	francois@team_mempool@refactor-chain_validator	Saroupille	9487506	3836952	bc5361f153bd0fb6185084327fe3e1ae71c02e8d			26	575	939	364	26
tezos/tezos	63759510	1958	3836952	Context: get rid of del, copy of remove_rec	"`del` and `remove_rec` are the same thing, let's get rid of one of them.

The protocol counterpart is metastatedev/tezos!234

Fixes metastatedev/tezos#193

Test plan: CI"	merged	2020-07-07T17:27:01.580Z	2020-07-13T23:02:15.963Z	pirbo	2020-07-13T23:02:16.300Z			master	mehdi@remove_rec	mbouaziz	9487506	3836952	18c02909c6daffbd0e794e2c3fd5aeb3a567481e			9	6	27	21	9
tezos/tezos	65225286	1990	3836952	a few disparate commits on error and exn management	"# Context 

This MR reduces the use of exceptions for control-flow.  
It also fixes a few bugs in error/exn management."	merged	2020-07-22T12:18:07.272Z	2020-08-26T15:42:01.768Z	klakplok	2020-08-26T15:42:01.804Z			master	raphael-p@a-few-code-quality-passes-on-error-and-exn-management	raphael-proust	9487506	3836952	28f3cee39b5d25dfd09fc7a8723b7437a8f18416			13	166	335	169	13
tezos/tezos	63571401	1954	3836952	Snapshots: improve performance of the context dump	"Changes:

- avoid unbounded caching of subtrees;
- traversal is tail-recursive in the depth of the tree;
- avoid various unnecessary `option`s;
- group calls to `Tree.get_tree` to make more efficient use of tree
  caching.

The new implementation is faster and uses less than half as much memory.

Total time | Peak memory usage
:----------------------:|:-------------------------:
![image](/uploads/b6c7c9bea1be06ad98719571976841e8/image.png) | ![image](/uploads/66a19124d37f4c54a09635a798b0fbd8/image.png)

As discussed offline, the memory usage is still linear in the size of the context due to the node visitation tracking, but this is required to keep an easily-specified canonical form for the snapshots.

Additionally, this changes the internal API to one that is easier to implement efficiently within Irmin itself. Rather than using low-level tree manipulations, the context dump now uses a single iterator function provided by `context.ml`. This internal API is now held in `context_dump_intf.ml`, to avoid excessive duplication of types.

(edit: added some additional performance improvements and corresponding charts.)"	merged	2020-07-06T07:05:03.064Z	2020-09-09T15:36:39.433Z	pirbo	2020-09-09T15:36:40.237Z			master	improve-context-dump	CraigFe	18643592	3836952	4135f3b3d18d96515a532564896db96953673f7f			4	297	733	436	4
tezos/tezos	63357629	1952	3836952	WIP: Docs/clic: tutorial	https://gitlab.com/nomadic-labs/tezos/-/issues/195	opened	2020-07-02T16:54:24.477Z	2020-08-20T11:00:42.426Z					master	arvid@clic-doc	arvidnl	9487506	3836952	66b68ba3e2dc243db5aa81e1551d286771b75ce5			10	595	595	0	10
tezos/tezos	64252782	1964	3836952	Add missing encoding cases		merged	2020-07-13T12:46:08.520Z	2020-08-28T12:37:35.474Z	adrianbrink	2020-07-13T13:45:46.702Z			master	tomas/encoding-missing-case-upstream	tzemanovic	11412215	3836952	d9d582e67f9f4ea38d2b4af44eff1f2feae91973			3	21	24	3	3
tezos/tezos	64623636	1973	3836952	Stdlib: improve documentation of dont_wait	ping @julien.t	merged	2020-07-16T10:07:46.322Z	2020-08-27T08:05:50.652Z	arvidnl	2020-08-27T08:05:50.970Z			master	raphael-p@improve-doc-of-lwt-utils-dont-wait	raphael-proust	9487506	3836952	1e6a262fa5693f638a96c309bc99d21697da9f9b			1	39	41	2	1
tezos/tezos	63602706	1955	3836952	Storage: use Irmin 2.2.0	"Very small port to use the Irmin 2.2.0 API in the context dump.

CC @pirbo."	closed	2020-07-06T12:08:04.265Z	2020-07-07T07:15:42.815Z			pirbo	2020-07-07T07:15:42.844Z	master	use-irmin-2.2.0	CraigFe	18643592	3836952	476eb7706e7d629572f63f32a7b3b2d294fda808			2	5	7	2	2
tezos/tezos	63627941	1956	3836952	Add coq_of_ocaml (and use irmin 2.2.0)	This is the new !1955 and !1931	merged	2020-07-06T15:41:57.235Z	2020-07-07T08:32:10.802Z	pirbo	2020-07-06T22:03:00.904Z			master	use-irmin-2.2.0	pirbo	9487506	3836952	536b1845cd39805b39d8002cd94656a62c3c736a			5	19	25	6	5
tezos/tezos	63344252	1951	3836952	Error_monad: [@inline] trivial functions (ok, return, etc.)		merged	2020-07-02T14:58:38.121Z	2020-07-06T13:56:05.444Z	klakplok	2020-07-06T13:56:05.495Z			master	raphael-p@force-inline-in-simple-error-monad-functions	raphael-proust	9487506	3836952	6993dacd211de0aa9ca8a21f82a739b5b2972c71			1	6	12	6	1
tezos/tezos	63706699	1957	3836952	Add testing instructions to contribution guidelines	"Fixes: https://gitlab.com/nomadic-labs/tezos/-/issues/144

This MR adds testing instructions to the contribution guidelines.

I also fixed a spelling error.

# How to test :)

    $ cd docs && sphinx-build -b html . ""_build"" developer/merge_team.rst && xdg-open _build/developer/merge_team.html

# Suggested reviewers:

@mbouaziz @rafoo\_"	merged	2020-07-07T10:35:38.683Z	2020-08-24T14:09:52.406Z	adrianbrink	2020-08-24T14:09:52.713Z			master	arvid@contribution_testing_guidelines	arvidnl	9487506	3836952	d25564d959868fa9d3b91da269f0c06f4ffbbde8			2	23	29	6	2
tezos/tezos	63286959	1948	3836952	doc: fix error in configuration file example	fix an error in the node's config file documentation spotted in #842	merged	2020-07-02T08:15:01.085Z	2020-07-02T11:03:27.316Z	adrianbrink	2020-07-02T11:03:27.560Z			master	julien@fix_log_doc	julien.t	9487506	3836952	9dcf30f0024da45f6d497bee0d33de066351b876			1	1	2	1	1
tezos/tezos	63150109	1946	3836952	lib_stdlib_unix: Remove the RPC dependency	We remove a non necessary `RPC` dependency from `lib_stdlib_unix` so that less packages are needed to be install from `opam` to install libraries depending on `lib_stdlib_unix` but not `RPC`.	merged	2020-07-01T08:01:38.600Z	2020-07-01T11:55:07.291Z	adrianbrink	2020-07-01T11:55:07.330Z			master	francois@remove-rpc-dep-in-stdlib-unix-opam	Saroupille	9487506	3836952	5f7d9e62c7f6df76464550af6307672d855b38da		5f7d9e62c7f6df76464550af6307672d855b38da	3	1	5	4	3
tezos/tezos	64517841	1970	3836952	WIP: partial handling of DDB errors at the DDB level	"After discussing with @bidinger I think this MR might not be the correct solution for the problem.
Back to wip for the moment.

At the moment, the DDB does not take care of removing the operation from the queue in the event of an error, leaving this to the caller. This patch takes care of catching the errors are removing the operations, but at the same time does not change the current behavior. The caller on error can decide to make a new request or simply print a warning and forget about it. Since we operate at the DDB level this is valid for both headers and operation fetch requests.

In my initial tests, this patch also solves the problem in https://gitlab.com/tezos/tezos/-/issues/858 .

I'm not sure how to add a regression test here. Help will be much appreciated."	closed	2020-07-15T13:34:05.675Z	2020-09-03T12:12:34.905Z			abate	2020-09-03T12:12:34.918Z	master	abate@ddb_timeout	abate	9487506	3836952	bad8e78e5a64349be73c3b816acff47f2a6a0538			4	26	33	7	4
tezos/tezos	63212544	1947	3836952	Everywhere: do not exit on dont_wait uncaught exception	"In most cases just print the uncaught exception, in some cases dont not wait.

Precondition to !1880"	merged	2020-07-01T15:16:13.347Z	2020-07-13T12:07:38.334Z	pirbo	2020-07-13T12:07:38.375Z			master	raphael-p@dont-crash-when-dont-wait	raphael-proust	9487506	3836952	832758ff8028d64f6ec72e161646c14feaf719d5			15	148	219	71	15
tezos/tezos	64400008	1968	3836952	Lwtreslib: support seeded hashtbls	"Part of https://gitlab.com/tezos/tezos/-/merge_requests/1872 which contains more context. This MR specifically

- adds support for seeded hashtbl in Lwtreslib
- export string-specialised hastbl in TzPervasives (because there were a few places that used a generic hashtable with string keys only)
- use exported specialised tbl where appropriate (occurrences for this were found in the follow-up MR !1895)

This MR paves the way for !1522 (which aims to improve security) and for the rest of !1872 (which generally improves the error monad and the error management)."	merged	2020-07-14T13:14:04.597Z	2020-08-11T15:41:03.607Z	mbouaziz	2020-08-11T15:41:03.648Z			master	raphael-p@complete-lwtreslib-s-hashtbl-with-support-for-non-specialised-tables	raphael-proust	9487506	3836952	fc2d5c5003398e65506d30cd39365e731205f82e			12	199	232	33	12
tezos/tezos	63311070	1950	3836952	WIP: migration : cleanup alpha previous	"This MR is based on https://gitlab.com/metastatedev/tezos/-/merge_requests/132 where only commit touching proto_alpha have been  left.

This MR cleans all occurence of ""alpha_previous"" which where mainly used for `./scripts/snapshot_alpha.sh`. This script have been cleaned up of that in this MR https://gitlab.com/tezos/tezos/-/merge_requests/1949"	closed	2020-07-02T11:35:27.007Z	2020-07-02T11:37:49.294Z			sribar	2020-07-02T11:37:49.305Z	master	sylvain/clean-alpha-previous	sribar	11412215	3836952	bf7b5fc8ea2a8e8b4d5ba8133e357b6270d486e2			537+	27496	48591	21095	679
tezos/tezos	62955634	1942	3836952	Flextesa: Add Alpha protocol and use as default	"The goal of this MR is to configure Flextesa to be able to use it on Alpha proto protocol with changes after Carthage.

Currently, when flextesa uses Alpha protocol, it uses Carthage constants, client commands, etc. for it. In the protocol proposal branch, some constants from Carthage are being changed, so Alpha needs to have its case."	merged	2020-06-29T15:45:37.568Z	2020-07-07T08:10:13.602Z	pirbo	2020-07-07T08:10:13.644Z			master	tomas/flextesa-alpha-constants	tzemanovic	11412215	3836952	62d476defca993015b17712354c5a0ce1fbe16cd			4	21	38	17	4
tezos/tezos	63092506	1944	3836952	Client/mockup: remove --chain-id-seed arg in create mockup command	"We added the `compute chain id from seed` client command, hence the `--chain-id-seed` argument to create mockup can be removed without compromising the ability for users to configure custom chain ids for their mockup.

This allows to simplify a bit the mockup client initialization logic.

# TODO:
- remove or adapt tests involving --chain-id-seed

# Suggested reviewers
- @richard.bonichon @smelc @rafoo\_"	merged	2020-06-30T15:31:22.557Z	2020-07-20T11:48:10.859Z	pirbo	2020-07-20T11:48:10.912Z			master	igarnier@remove-chain-id-seed-arg	igarnier	9487506	3836952	fb99053b8d6590581c7349149567c36c202e11ae			14	40	187	147	14
tezos/tezos	63115025	1945	3836952	doc: fix glitchs in table of contents and mockup documentation	"This MR fixes two things:


* That there is a `Chain id` entry in the left table of contents on https://tezos.gitlab.io/index.html, whereas this entry belongs to the mockup page. ![chain_id_in_toc](/uploads/c67b99d7b62fd0e7430f8d6bfc713aff/chain_id_in_toc.png)
* That some code blocks in the markdown documentation look wrong:  ![broken-code-blocks-online](/uploads/f9d42c4e1618de9693b1f22fe85f9591/broken-code-blocks-online.png)

Suggested reviewers: @igarnier @arvidnl @bidinger"	merged	2020-06-30T19:53:15.805Z	2020-07-02T15:58:15.442Z	arvidnl	2020-07-02T15:58:17.525Z			master	smelc-fix-mockup-doc-glitchs	smelc	9487506	3836952	f004ed59b0061c132463026bbac3c0389d6aa8c1			1	5	6	1	1
tezos/tezos	62749191	1938	3836952	WIP: doc: give direnv instructions for making dependencies locally available to tezos	"This MR aims at improving build reproducibility by minimizing dependencies to the global installation and making it easier to have multiple tezos clones - using different versions - working at the same time. This is done by using [direnv](https://direnv.net/) that

> augments existing shells with a new feature that can load and unload environment variables depending on the current directory.

These instructions are optional and do not replace the usual instructions. The aim is, however, to start going into this direction. This MR will wait for !1711 to be merged first, as this MR will then be augmented with instructions specific to the test framework.

Recommended reviewers: @arvidnl @mbouaziz @dannywillems 

Note that this MR does NOT document how to install tools locally to the `tezos` directory (this is done already for `opam` because a local switch is used). It is desirable but it doesn't work at the moment for `cargo` and `rustup`.

Normally `cargo` and `rustup` support a local install by specifying `CARGO_HOME` and `RUSTUP_HOME` like this:

```bash
cd tezos
export CARGO_HOME=$(pwd)/.cargo
export RUSTUP_HOME=$(pwd)/.rustup
curl https://sh.rustup.rs -sSf | sh
```

So the following in `.envrc` should work:

```
PATH_add .cargo/bin
```

but unfortunately compilation fails as follows:

```
[ERROR] The compilation of conf-rust failed at ""/home/churlin/.opam/opam-init/hooks/sandbox.sh build which cargo"".
#=== ERROR while compiling conf-rust.0.1 ======================================#
# context     2.0.4 | linux/x86_64 | ocaml-base-compiler.4.09.1 | git+https://gitlab.com/tezos/opam-repository.git#f9f3b9f7cd60a54f06836cca466a19f562c9b833
# path        /media/crypt1/nomadic/tezos/_opam/.opam-switch/build/conf-rust.0.1
# command     ~/.opam/opam-init/hooks/sandbox.sh build which cargo
# exit-code   1
# env-file    ~/.opam/log/conf-rust-28040-ccabea.env
# output-file ~/.opam/log/conf-rust-28040-ccabea.out
<><> Error report <><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
┌─ The following actions failed
│ λ build conf-rust 0.1
```

because `opam` must somehow escape `direnv`'s sandbox (this is sad :crying_cat_face:)."	opened	2020-06-26T09:28:51.827Z	2020-06-29T08:45:17.209Z					master	smelc-direnv-install-instructions	smelc	9487506	3836952	59db752b9cb753ec39ea6ff8ecddfefa6e2bb0d3			1	42	42	0	1
tezos/tezos	62755347	1939	3836952	WIP: More Michelson typechecking tests	See nomadic-labs/tezos#186.	opened	2020-06-26T10:25:47.443Z	2020-08-20T16:44:06.464Z					master	rafoo@test_michelson_typecheking	rafoo_	9487506	3836952	7e73cd95ad4c756eb6f5a8c1d1be1c48887c5204			54	3394	3536	142	54
tezos/tezos	65224063	1989	3836952	P2p,Node: make identity generation cooperative	"# Context 

Introduce explicit yield points in the computation of the proof-of-work/p2p-identity.

Should fix https://gitlab.com/tezos/tezos/-/issues/709 and https://gitlab.com/tezos/tezos/-/issues/661 if applied in combination with https://gitlab.com/tezos/tezos/-/merge_requests/1880


# Manually testing the MR

Cherry-pick this commit on top of https://gitlab.com/tezos/tezos/-/merge_requests/1880 , generate a new identity and ctrl+c.

# Automatic testing

Automatic testing is possible but a bit difficult. Especially until https://gitlab.com/tezos/tezos/-/merge_requests/1880 is merged.

# Reviewers

@rafoo\_ @Saroupille @vect0r who all have been involved with the issues mentioned above"	merged	2020-07-22T12:06:16.379Z	2020-08-20T16:38:30.952Z	vbotbol	2020-08-20T15:53:55.522Z			master	raphael-p@lwt-ise-crypto-gen-proof-of-work	raphael-proust	9487506	3836952	1f3e469b7a35dea18baf168e29c978db594f3f75			18	134	177	43	18
tezos/tezos	62532606	1935	3836952	Reorder CI stages	Optional stages go afterwards to make the UI of pipelines more intuitive on gitlab.	merged	2020-06-24T14:01:16.851Z	2020-06-25T16:42:58.869Z	pirbo	2020-06-25T16:42:58.927Z			master	raphael-p@reorder-CI-stages	raphael-proust	9487506	3836952	92f9a2f3b6f6f32ebc5f29e8e5bd301bd7e7b0fb			1	2	4	2	1
tezos/tezos	62420802	1931	3836952	WIP: Install coq-of-ocaml	"We add a CI rule to check that coq-of-ocaml is correctly installed. The next step will be to actually run coq-of-ocaml, in the development branch once rebased on `master`. See https://gitlab.com/metastatedev/tezos/-/merge_requests/111

Part of the task https://gitlab.com/nomadic-labs/tezos/-/issues/161"	closed	2020-06-23T16:35:47.384Z	2020-07-07T07:18:56.547Z			pirbo	2020-07-07T07:18:56.561Z	master	guillaume-claret@add-coq-of-ocaml-to-ci-opam	clarus1	9487506	3836952	4fa4834bb8addbf917a9e163081fbadc5184fb5b			3	12	14	2	3
tezos/tezos	62504507	1933	3836952	p2p: demote all  swap errors to info	"This MR address the point raised in https://gitlab.com/tezos/tezos/-/issues/844

demote all swap messages to info level 

related to https://gitlab.com/tezos/tezos/-/issues/420"	merged	2020-06-24T10:18:40.814Z	2020-07-07T10:51:30.091Z	arvidnl	2020-07-07T10:51:30.133Z			master	abate@p2p_swap_errors	abate	9487506	3836952	ec198d588b6c438246dac9dda30449d20510891f			1	1	2	1	1
tezos/tezos	62417505	1930	3836952	WIP Add a CI rule to run coq-of-ocaml	"Attempt to add a CI rule to check the conversion to Coq. I hope to get some kind of linting from coq-of-ocaml, so that:

* it is quick to fix if needed;
* main errors are avoided.

What we do:

* run coq-of-ocaml on each file of the protocol;
* stop at the first conversion errors, with a ""failure is allowed"" mode.

We add an entry in the CI file, plus a `coq-of-ocaml` folder in the protocol with the configuration for coq-of-ocaml. Note that we check that coq-of-ocaml generate some Coq with no errors, but we do not check that the generated code compiles. This is not necessarily true, name collisions or missing GADTs annotations are examples of errors.

Part of the task https://gitlab.com/nomadic-labs/tezos/-/issues/161"	closed	2020-06-23T16:03:27.093Z	2020-06-24T08:34:36.327Z			clarus1	2020-06-24T08:34:36.347Z	master	guillaume-claret@add-coq-of-ocaml-to-ci	clarus1	9487506	3836952	b8d1a88802a5b42d9805a3f5d8fe5e88cfe082b4			3	13	16	3	3
tezos/tezos	62620334	1937	3836952	Update dependency to ringo 0.5	Note to merger: DO NOT MERGE top commit which is only for testing purpose	merged	2020-06-25T07:33:36.097Z	2020-06-26T20:42:10.132Z	pirbo	2020-06-26T20:42:10.171Z			master	raphael-p@update-to-ringo-0.5	raphael-proust	9487506	3836952	e5fc7f9e10805bb74f0f290bc64e2beb855672d0			9	18	30	12	9
tezos/tezos	62181788	1925	3836952	Emacs: fix fontification of numbers and bytes constants	"This fixes a small bug in the regular expressions for constant fontification in the Emacs Michelson mode: negative numbers and bytes literals were not supported. Since the result of fontification is used for indentation, this caused indentation issues when these unsupported constants appeared as part of sequences. I have attached a file that shows the problem: the file is well-indented and well-typed according to `mockup_client typecheck script` but without the patch Emacs reindents it badly.

[sets.tz](/uploads/e1b63cfee8b74dea611cfe7745ae34f1/sets.tz)"	merged	2020-06-22T09:59:57.227Z	2020-06-22T13:26:45.782Z	adrianbrink	2020-06-22T13:26:45.816Z			master	rafoo@emacs_fontification	rafoo_	9487506	3836952	3fa6cdd87ae6606ca53d66c474894703b9131fcc			1	2	3	1	1
tezos/tezos	62471812	1932	3836952	Update opam repository to include bls12-381 test deps	As requested by @pirbo [here](https://gitlab.com/tezos/opam-repository/-/merge_requests/97#note_365722619), this MR updates the opam repository to include [`py_ecc`](https://github.com/ethereum/py_ecc), a python library for elliptic curve cryptography, notably including primitives for the BLS12-381 curve construction.	merged	2020-06-24T04:54:04.859Z	2020-06-25T21:12:54.494Z	pirbo	2020-06-25T21:12:54.531Z			master	ash/update-upstream-opam-repo	A-Manning	11412215	3836952	ec9d2cfe3cc3ba6de8ff8a163888be5b84aa1bd9			3	3	5	2	3
tezos/tezos	62061374	1922	3836952	CI: fix documentation rule for master	"The last commit replaced the except rule, but it should have extended
the rule which was inherited."	merged	2020-06-19T16:35:55.989Z	2020-06-19T17:23:23.363Z	pirbo	2020-06-19T17:23:23.396Z			master	romain-ci	romain.nl	9487506	3836952	387879c7d2975b61525cb5c96eb265dc9c3018cd			1	16	16	0	1
tezos/tezos	62920242	1940	3836952	WIP: Lib_p2p: unregister points with no common protocol	"Point with incompatible protocol are usually detected locally, but
sometimes a node can think that the remote node is compatible while the
remote node decide otherwise, in case of a deprecated version for example.

Previous patch preventing node registration, from MR !1609, was only effective in the second case. 

This patch allows the removal of incompatible points from the
known_points table in both cases and add a tests for both cases.

In case of a Nack with a list of neighbors, we register the neighbors,
as they might have different restrictions, but we greylist the peer
Id, in order to not being sent back and forth from this point to its
neighbors and so on."	opened	2020-06-29T10:52:37.497Z	2020-09-16T07:37:22.047Z					master	julien@unregister_no-common-net-version_wth-test	julien.t	9487506	3836952	eebfa482b35f43199826d5c8d17f7eec8860b051			5	292	352	60	5
tezos/tezos	62168191	1924	3836952	distributed_db: Fix the protocol on activation	"During the hand-checking (or activation) of the `distributed_db`
protocol, too many messages were sent (`Get_current_branch`). We add a
field `last_activation_request` to remember the last time we sent an
activation message.

This MR addresses issue nomadic-labs/tezos#134 .

# How to test this MR

If you set `TEZOS_LOG` to `""* -> debug""` to print messages received by the `distributed_db`, you can see (before this patch) that the messages `Get_current_branch` is sent many times between two nodes in less than a second which is not necessary (which is a concurrence issue). This patch memoizes the last time such request was sent to prevent this. After this patch, the message is sent only once on activation."	closed	2020-06-22T08:23:39.977Z	2020-07-17T08:32:54.365Z			Saroupille	2020-07-17T08:32:54.380Z	master	francois@ddb-fix-activation	Saroupille	9487506	3836952	e51f527fff7a111f919842538ace8819bb228d42			1	26	30	4	1
tezos/tezos	62204435	1926	3836952	WIP: Tests/python: fix flaky test with pytest.rerun	"`test_p2p.py` was failing spuriously, most likely due to the maintenance process which is triggered non-deterministically. See https://gitlab.com/nomadic-labs/tezos/-/issues/177

This MR 
* add `pytest-rerunfailures` to the list of python requirements
* fixes the test but allowing to re-run `test_check_stat` with a delay (using `pytest-rerunfailures`). This is more robust that using `time.sleep`

Note: we already use some ad-hoc retry mechanism in utility functions (e.g. `utils.check_protocol`).
Using `pytest-rerunfailures` provides a more systematic way of doing the same thing.

WIP:
* It seems `pytest.mark.flaky` doesn't interact well with `pytest.incremental`
* this MR depends on https://gitlab.com/tezos/opam-repository/-/merge_requests/98 that updates `scripts/python_requirements.txt` in `tezos/opam-repository/`"	closed	2020-06-22T12:57:08.386Z	2020-07-17T09:54:34.653Z			bidinger	2020-07-17T09:54:34.547Z	master	philb@fix_test_p2p	bidinger	9487506	3836952	462d569e043b46f6aff0c5a462f6a9b2d79c4f4e			2	2	2	0	2
tezos/tezos	62159448	1923	3836952	remove root from diff, remove get_size RPC		closed	2020-06-22T07:01:20.951Z	2020-06-22T07:02:08.600Z			paracetamolo	2020-06-22T07:02:08.612Z	master	marco-sapling-remove-root	paracetamolo	11412215	3836952	cc8dc51e15ff5745e74924b2a6b179640ff46e86			543+	32473	53068	20595	683
tezos/tezos	62354814	1928	3836952	shell_services: change encoding of pipeline field from int8 to int16	"This MR change the encoding of workers status and in particular the encoding of the pipeline field.

This field is the possible culprit of the following error:
```
$ while :; do curl http://172.3.27.2:8732/workers/prevalidators ; done
(Invalid_argument ""Json_encoding.construct: int8 out of range"")(Invalid_argument ""Json_encoding.construct: int8 out of range"")(Invalid_argument ""Json_encoding.construct: int8 out of range"")(Invalid_argument ""Json_encoding.construct: int8 out of range"")(Invalid_argument ""Json_encoding.construct: int8 out of range"")(Invalid_argument ""Json_encoding.construct: int8 out of range"")(Invalid_argument ""Json_encoding.construct: int8 out of range"")(Invalid_argument ""Json_encoding.construct: int8 out of range"")(Invalid_argument ""Json_encoding.construct: int8 out of range"")(Invalid_argument ""Json_encoding.construct: int8 out of range"")(Invalid_argument ""Json_encoding.construct: int8 out of range"")(Invalid_argument ""Json_encoding.construct: int8 out of range"")
```

Reviewers: @adrianbrink @raphael-proust @arvidnl "	merged	2020-06-23T08:32:27.096Z	2020-07-07T09:12:59.897Z	arvidnl	2020-07-02T12:44:33.144Z			master	abate@prevalidator_int8	abate	9487506	3836952	2ec7343bae3fd201683a37037fb57a8484dfe259			1	2	4	2	1
tezos/tezos	63309964	1949	3836952	update migration script, documentation and test	"This MR is based on https://gitlab.com/metastatedev/tezos/-/merge_requests/132 cleaned of commit modifying proto_alpha so it can be merged against master

Add `user_activated_upgrade.sh` to facilitate testing of migrations in sandbox or from snapshots. This was part of `activate_protocol.sh` but it was removed at some point."	merged	2020-07-02T11:24:37.244Z	2020-07-13T07:35:46.124Z	pirbo	2020-07-09T13:15:42.798Z			master	sylvain/update-migration-script-test	sribar	11412215	3836952	4c39489cc8ed972ff1639016f673bc78dc3c7597		ff133d10696d03ecb9de7e8112058854cd1ed32d	14	525	873	348	14
tezos/tezos	62405742	1929	3836952	Lint.sh: allow to ignore files	"Use a `--ignore file_a.ml file_b.ml` blacklisting option rather than a whitelist in `dune` files.

Reviewers: @smondet @pirbo "	merged	2020-06-23T14:32:28.594Z	2020-06-30T14:23:22.260Z	smondet	2020-06-30T14:23:22.298Z			master	mehdi@lint_ignore	mbouaziz	9487506	3836952	336193dd136e8e43165a30b8677c63e664b2c1c0			9	110	200	90	9
tezos/tezos	62047912	1919	3836952	Fix operation data and metadata failing encodings/decodings		merged	2020-06-19T14:18:56.171Z	2020-06-19T14:48:59.698Z	pirbo	2020-06-19T14:48:59.743Z			master	vbot@fix_metadata_serialization	vbotbol	9487506	3836952	38d4244d67a370d6461547305073128f58282b69			7	120	165	45	7
tezos/tezos	62048337	1920	3836952	Documentation for v7.2 release	We are releasing version 7.2, so the documentation, changelog, and version number need to be updated.	merged	2020-06-19T14:23:02.866Z	2020-06-19T16:27:30.484Z	pirbo	2020-06-19T16:27:30.513Z			master	romain-v7-doc	romain.nl	9487506	3836952	17cab7c5384dc0315ba8828e21ccb27ac07d003b			4	32	39	7	4
tezos/tezos	64723529	1975	3836952	test the migration/stitching with tezt	"This MR add test made with the tezt framework to check that the migration/stitching of a protocol works as expected in a real context.

this test requires a real context and a yes-node. It uses the user-activated ability to check the migration happens after one block then it bakes until the end of the cycle 

For a dev to use this test he only needs to download a snapshot and it's just two commands away : 

```
$ ./scripts/prepare_migration_test.sh auto bond_007 snapshot.roll
$ dune exec tezt/manual_tests/main.exe -- -v --keep-temp migration 
```

I made this [branch](https://gitlab.com/metastatedev/tezos/-/commits/sylvain/proto-proposal-test-migration) to be able to test with proto-proposal branch and environment V1

---- 
previous MR before tezt was merged : 

https://gitlab.com/nomadic-labs/tezos/-/merge_requests/177"	merged	2020-07-17T08:11:57.271Z	2020-08-17T09:14:50.282Z	tzemanovic	2020-08-17T09:14:50.320Z			master	sylvain/tezt	sribar	11412215	3836952	57df64d40a675b16f233a8698ab64c98dce9659c			12	855	1094	239	12
tezos/tezos	63879112	1961	3836952	Draft: RFC: Error_monad/Lwt_result_std_lib: generalize error/trace types when possible	"Functions in the `Error_monad` and in `Lwt_result_std_lib` are specialized for THE `error` type (and `trace` defined as `error list`) but most don't need to.

Generalizing this type allows to reuse them in other contexts, e.g. with a local error type, or to write shortcutting folds such as `find_first`.

Test plan: CI"	closed	2020-07-08T15:46:01.416Z	2020-09-16T07:37:45.924Z			raphael-proust	2020-09-16T07:37:45.952Z	master	mehdi@generalize_error	mbouaziz	9487506	3836952	e5e3e47b81fec41284780d6e69b3a1ea12eb8d21			39	777	1168	391	39
tezos/tezos	61700756	1911	3836952	(fixup) Opam: remove test for unvendored libraries	we really need to fix when the CI runs the opam tests	merged	2020-06-16T17:23:01.691Z	2020-06-16T18:04:39.006Z	pirbo	2020-06-16T18:04:39.034Z			master	extern_secp256k1	pirbo	9487506	3836952	4c0f397ba6d2a8a9decbb814d553ff65f6e07e3b			1	0	20	20	1
tezos/tezos	61935794	1916	3836952	Improve description of /chains/<chain>/blocks	The description of the `/chains/<chain>/blocks` RPC was a bit confusing, for instance, it talked about multiple blockchain heads...	merged	2020-06-18T14:22:38.847Z	2020-06-22T14:17:21.501Z	adrianbrink	2020-06-22T14:17:21.533Z			master	eugenz_chain_services_update_description	eugenz	9487506	3836952	c83b742ef0dc5125fb59b01640006f5357ecabd4			1	10	19	9	1
tezos/tezos	61693612	1910	3836952	Documentation: fix margin on table of contents in generated OCaml documentation	"Fixes #610

Credit to @kinokasai for this patch.

Instead of using absolute positioning, this commit puts the
table of contents inline on top of the page. This fixes the problem
that the toc would cover the contents on some pages.

Before:
![screenshot-20191028-155618.png](/uploads/ad85bdaf87eaa3fdf47191f811dbd62e/screenshot-20191028-155618.png)

After:
![doc_css_fix](/uploads/3f5d0006a27ff00548c884faecc811ea/doc_css_fix.png)

Browse generated documentation in gitlab pipeline artifacts: https://nomadic-labs.gitlab.io/-/tezos/-/jobs/597888194/artifacts/docs/_build/api/api-inline.html"	merged	2020-06-16T16:18:37.137Z	2020-07-02T16:33:44.784Z	adrianbrink	2020-07-02T16:33:45.288Z			master	arvid@doc-fix-css-toc	arvidnl	9487506	3836952	d1fd0f67f464a1dae34f097b7be3e7252676eb3b		d1fd0f67f464a1dae34f097b7be3e7252676eb3b	1	2	2	0	1
tezos/tezos	62534371	1936	3836952	Hide absent metadata in RPCs instead of failing	"When a block has its metadata pruned, querying it using `../blocks/<block>` RPC will fail with a 404. This MR rework the block and operation service's encoding by making metadata optional. Thus, we only display pruned contents (header + operations without metadata) instead of failing. However, if a block has been pruned, `../blocks/<block>/metadata` will still fail with a 404 which is the expected behaviour.

This is possibly breaking for applications that expect to always find a ""metadata"" field in the JSON object. Testing for the existence of this ""metadata"" field is thus required when querying nodes running in full history mode."	merged	2020-06-24T14:17:10.233Z	2020-10-01T09:51:23.306Z	pirbo	2020-07-13T17:23:03.164Z			master	vbot@hide_absent_metadata	vbotbol	9487506	3836952	fb8d468296995bbd0d360bd005dcb9dcfe738c15			17	349	612	263	17
tezos/tezos	61683980	1908	3836952	Extern secp256k1 and irmin		merged	2020-06-16T14:58:02.483Z	2020-06-16T17:05:27.867Z	pirbo	2020-06-16T17:05:27.903Z			master	extern_secp256k1	pirbo	9487506	3836952	290ba68854134650cbece1358ece3f8f837f3b29			183	3	33076	33073	183
tezos/tezos	62023994	1917	3836952	Client: pretty-print baker in dry-runs	fixes #840	merged	2020-06-19T10:37:46.913Z	2020-06-22T13:48:33.518Z	adrianbrink	2020-06-22T13:48:33.762Z			master	tomas/dry-run-result	tzemanovic	11412215	3836952	f0da8e407175028f539eb50edd902be27f22e45a			12	76	166	90	12
tezos/tezos	61684333	1909	3836952	shell: return enum for rpc sync_state instead of a naked string	"instead of returning a string, this MR returns an enum composed by three elements ""sync"", unsync"" and ""stuck"". This will provide a better documentation."	merged	2020-06-16T15:00:21.646Z	2020-06-22T17:30:53.533Z	adrianbrink	2020-06-22T17:30:53.562Z			master	abate@sync-state	abate	9487506	3836952	8f4255e5c5d20daf983e0b4f5bb7404b4ffc8599			3	17	36	19	3
tezos/tezos	61648692	1906	3836952	WIP: Client: add `pack michelson data` subcommand	this closes #734	closed	2020-06-16T10:17:42.045Z	2020-09-07T13:20:30.681Z			sribar	2020-09-07T13:20:30.706Z	master	hx-734-cli-pack-michelson-data	haochenxie	16805926	3836952	d63ba4979fed16f812926de65012c87eddf39abc				0	0	0	0
tezos/tezos	61531990	1901	3836952	WIP: Client argument accepting both addresses and keys	"Implements the feature requested here: #836 

TODO:
 - [ ] Improve error message when, for example, a public key is passed instead of a secret one
 - [ ] Add automated tests"	opened	2020-06-15T13:43:10.322Z	2020-06-20T16:12:02.638Z					master	rafoo@client_address_args	rafoo_	9487506	3836952	756b1c760064aea1cb3b6a8047bb14de0d4ade5e			10	137	188	51	10
tezos/tezos	61505181	1900	3836952	p2p: remove unused variables: known_points_history_size, known_peer_ids_history_size	"This MR fix a todo in the p2p code and removes two unused variables known_points_history_size and known_peer_ids_history_size.

It also add the description for the option `max_known_peer_ids`"	merged	2020-06-15T11:39:45.632Z	2020-07-16T22:50:19.051Z	pirbo	2020-07-16T22:50:19.089Z			master	abate@p2p_remove_unsed_var	abate	9487506	3836952	4ff5ebb524c25090f546d5776a315db47dbea479			4	5	37	32	4
tezos/tezos	61637354	1904	3836952	Introduce lwtreslib	"Part 2 of !1872

Depends on !1903 "	merged	2020-06-16T08:54:53.581Z	2020-06-22T15:18:46.385Z	adrianbrink	2020-06-22T15:18:46.423Z			master	raphael@introduce-lwtreslib	raphael-proust	9487506	3836952	b06b26d9bb364905e07fb36dc9d65b2e48a4adc1			29	1516	1516	0	29
tezos/tezos	61487282	1899	3836952	"P2p/logging: Demote ""Too many connections"" event from notice to debug"	"
While ""Too few connections"" is an indicator that the node is struggling to find the correct number of peers, and might solicit intervention from the node admin, the event ""Too many connections"" does not imply any action from the node admin as it's part of the self-regulating maintenance cycle of the node.

Demoting the event to debug reduce the amount of logs given by default."	merged	2020-06-15T10:02:13.263Z	2020-06-15T15:32:24.751Z	raphael-proust	2020-06-15T15:32:24.793Z			master	abate@p2p_debug_conn	abate	9487506	3836952	d63ba4979fed16f812926de65012c87eddf39abc			1	1	2	1	1
tezos/tezos	61431885	1897	3836952	Workers: coherent limits: reduce default blacklog size, and use this default in block validator	"The block validator has a different default from the other workers.
This MR reduce the size of the backlog by default, and gives the same
default values to all workers.

It sets :
- backlog_level to notice
- backlog_size to 300 ( to reduce the memory footprint )

It also clarifies what is the list of known heads."	merged	2020-06-14T09:37:36.980Z	2020-06-17T08:46:54.892Z	adrianbrink	2020-06-17T08:46:54.919Z			master	abate@block_validator_limits	abate	9487506	3836952	43dec3382118b457df13125a84000cce0fc7c73c			2	18	26	8	2
tezos/tezos	61564573	1902	3836952	P2p: Replace default arguments by explicit calls to Systime_os.now	"This fixes issue nomadic-labs/tezos!179

- The first commit removes the default argument and inserts explicit calls to `Systime_os.now` where needed to match the original functionality. This makes it manifest that too many calls were performed.
- The second commit removes some now obviously spurious calls to `Systime_os.now`

There's an exception to the first point in `P2p_peer_state.Info.encoding` where I used the provided `creaed` argument instead of calling `now`, because it makes more apparent sense. But I see two `Ringo.Ring` are created while I guess only one is needed. I highly suspect that the call to `P2p_peer_state.Info.create` there should just be removed. CCing @raphael-proust"	merged	2020-06-15T16:04:39.183Z	2020-06-16T15:26:56.980Z	pirbo	2020-06-16T15:26:57.008Z			master	igarnier@p2p-remove-stateful-args	igarnier	9487506	3836952	8a512582a40799bacfac0e528d1aa0b6b27769c4			6	69	121	52	6
tezos/tezos	64399595	1967	3836952	add list to lwtreslib	"`Lwtreslib.List` centralises `Stdlib.List`, `Lwt_list`, and `Error_monad` (the list traversal part).

Depends on !1895  
Part of !1872 

-----------------

### Notes to reviewers/mergers:

#### TL;DR:

- `Lwtreslib.List` is a set of list traversors
- it includes a superset of `Stdlib.List` modulo exception safety
- it includes a superset of `Lwt_list`
- it includes a superset of the `Error_monad` traversors modulo renaming
- `TzPervasives` shadows `List` to `Lwtreslib.List`
- There are no more calls to `Lwt_list`, there are no more calls to the traversors of `Error_monad` (which are removed)
- `Protocol_environment.V0` includes a layer of backwards compatibility
- tests are in https://gitlab.com/tezos/tezos/-/merge_requests/2131

#### More details

- The change set is huge. But most chunks are trivial (`s/Lwt_list.map_s/List.map_s` or `s/[Error_monad.]iter_s/List.iter_es`), a few are easy (`s/List.{hd,tl,nth,find}/Option.get @@ &/`) and very few are actually more complex than that.

- Tests are in the separate MR (!2131). It is separate for a historical reason (other Lwtreslib MRs had not had tests), an MR-organisation reason (!2131 affects more than just list), a review-organisation reason (this MR has already been reviewed and bringing more commits on top would somewhat invalidate the reviews).

    For information, all the list tests passed out of the box. The coverage report (see MR's pipeline) is fairly complete. One of the seq tests failed and one of the commits in !2131 fixes the bug that was found (a reversal of the collection when mapping in parallel).

- The commit are in an order/form made to facilitate the review. Specifically,
    1. The first commit introduces the new `List` module in Lwtreslib. This module follows the same naming and semantic conventions as the rest of Lwtreslib. Note that this module is a strict superset of `Lwt_list`. In addition this module includes all the traversors of the Error-monad but names them according to the convention of Lwtreslib (e.g., `Error_monad.map_s` is `Lwtreslib.map_es` where the “e” is for “error”.)
    2. The next commit shadows `List` using the same shadowing mechanism as the rest of Lwt: expose it in `Base.TzPervasives` which is opened pretty much everywhere. It means that `List` now refers to `Lwtreslib.List` in most of the codebase. This is ok because `Lwtrslib.List` is mostly a superset of `Stdlib.List` except that some functions have been made safe by returning `option` (instead of raising `Not_found`).
    3. The next commit unshadows (or rather re-shadows) List in one specific module that does a lot of matrix operations using lists that are, by-construction neither empty and differently-sized.
    4. The next module removes the traversors from Error_monad. After this commit `Error_monad.iter` is unavailable. `Lwtreslib.List.iter_e` must be used instead. (And similarly for other traversors.)
    5. The following commits simply adapt to the newly shadowing List module. They are split by component (each `src/{bin,proto,lib}_*` is updated one by one). Exceptions are:
        - 39fd06c6 is a module that fixes a small inconsistency in the test build files. Arguably this commit could be in a min-MR of its own. OTOH, it's small enough that it's not an issue here. (Note that the inconsistency tripped me during the compiler-error-driven-development of this MR.)
        - 39fd06c6 adapts the code in `lib_protocol_environment` and it also introduces a backwards compatibility layer in the protocol. This is so that old protocols can still call the legacy error-monad traversors. The backwards-compatibility layer uses the standard `structs` mechanism of the protocol environment.
        - aef437bc makes small optimisations on code that was affected by the MR. Arguably, these optimisations could be made in a separate MR but that would make manual rebasing necessary and introduce a chance that the optimisation is lost during the rebasing.
        - a7c18d18 is a commit that ammends the signature of the `Lwtreslib.List` module, and in particular the error-management of the double-traversors (`iter2`, `map2`, etc.). This was added as a reply to a reviewer's comment. If requested, I can squash this commit onto the other appropriate commits."	closed	2020-07-14T13:10:37.592Z	2020-10-15T12:56:11.184Z			raphael-proust	2020-10-15T12:56:11.199Z	master	raphael-p@add-list-to-lwtreslib	raphael-proust	9487506	3836952	7895052940cd6516656fb465a3c1bd38de831c5c			240	3963	6035	2072	240
tezos/tezos	61342875	1893	3836952	Docs: update variant encoding example	Fixes #835	merged	2020-06-12T10:08:33.827Z	2020-06-12T14:03:24.339Z	pirbo	2020-06-12T14:03:24.536Z			master	raphael-p@fix-835	raphael-proust	9487506	3836952	cf744df89521e22cdc2811548e9eb77045667ae0			1	8	17	9	1
tezos/tezos	61368317	1894	3836952	Fix for duplicated address aliases	"Before this, the client functions to get stored public and private keys from a key hash picked the first available alias for that key hash and then queried the keys associated to that alias. This caused shadowing of known keys when several aliases reference the same key hash and the first one is not associated to the keys.

Fixes #653."	merged	2020-06-12T14:17:11.788Z	2020-06-22T16:11:36.448Z	adrianbrink	2020-06-22T16:07:07.541Z			master	rafoo@duplicated_adddress_alias	rafoo_	9487506	3836952	4d90d79a60376435b86c4329c6359ffc00c05a3c			6	79	85	6	6
tezos/tezos	61820151	1913	3836952	CI: only run doc linkcheck if docs have changed		merged	2020-06-17T16:48:10.627Z	2020-06-24T11:17:46.247Z	adrianbrink	2020-06-24T11:17:46.278Z			master	raphael-p@only-link-check-when-changing-doc	raphael-proust	9487506	3836952	b6a780afd77b6c86752a09e9c7a7174c894fe0c4			1	18	30	12	1
tezos/tezos	61387844	1896	3836952	WIP: Client+Proto_alpha: add typed version of `unpack michelson data`	"- add a typed version to the client command `unpack michelson data`
- add a new RPC service 'helpers/scripts/unpack_data'"	closed	2020-06-12T18:40:36.760Z	2020-06-23T12:40:07.234Z			rafoo_	2020-06-12T21:49:33.279Z	master	hx-cli-typed-unpack	haochenxie	16805926	3836952	a6efab4c2b2d7ad7fe5567c3b8556981b00b8f3a			3	79	98	19	3
tezos/tezos	61634471	1903	3836952	Improve error monad in preparation for lwtreslib	Part 1 of https://gitlab.com/tezos/tezos/-/merge_requests/1872	merged	2020-06-16T08:32:05.884Z	2020-07-02T07:17:47.369Z	mbouaziz	2020-06-17T15:32:53.929Z			master	raphael@improve-error-monad-in-preparation-for-lwtreslib	raphael-proust	9487506	3836952	d7daf3f19120cf01f0fece886e3d1046f6bf19d2			25	104	159	55	25
tezos/tezos	61303905	1892	3836952	WIP: Parallel Error traces when joining process in p2p tests	"This is an addendum to !1826 which introduces a much cleaner handling of parallel errors.

The definition of `Par` error relies on the recursive definition/declaration of errors which is not yet ready for inclusion in tezos, and thus it cannot be included right now.
see !1770 .

!1770 being merged, this has been integrated in !1826"	closed	2020-06-11T21:33:54.165Z	2020-07-08T20:02:16.283Z			julien.t	2020-07-08T20:02:16.303Z	master	julien@p2p_test_process_improvement-wt-parallel-error	julien.t	9487506	3836952	e4ffb7d8629ae01955a461c4657de7618ebbb149			14	910	1107	197	14
tezos/tezos	65503012	1997	3836952	Tezt: Add regression tests for alpha protocol encodings	"# Context 

This MR adds support for regression testing in Tezt (the first commit) and adds a regression test for alpha protocol encoding (the last commit).

This regression runner is wrapper around `Test.run` function, so that any test can be easily converted to regression test.

An example output of a failing regression test can be seen in this log: https://gitlab.com/metastatedev/tezos/-/jobs/658148619

# Manually testing the MR

You can modify the stored regression outputs, run the regression test with e.g. `dune exec tezt/tests/main.exe regression` and it should then fail.

# Reviewers

@romain.nl @arvidnl @paracetamolo"	merged	2020-07-24T17:13:22.502Z	2020-09-10T09:52:49.320Z	raphael-proust	2020-09-10T09:20:54.340Z			master	tomas/encoding-regressions	tzemanovic	11412215	3836952	3fb85bc5beea227056394479f29914d932b6621a			116	2188	2200	12	116
tezos/tezos	61268681	1889	3836952	WIP: Client: add commands for showing the storage of contracts	"Implements #826.

This adds two commands:

- tezos-client get contract storage type of <contract>
  to access the storage type of a contract

- tezos-client show contract storage of <contract>
  to pretty-print the storage of a value (with field annotations and
  type information on leaves)

Example:

```
mockup_client originate contract bar transferring 100 from bootstrap1 running 'parameter unit; storage (pair (list %numbers nat) (pair (big_map %strs bool string) (timestamp %date))); code { CDR; NIL operation; PAIR }' --init 'Pair { 0; 1; 2 } (Pair {} -4)' --burn-cap 2
[..]
mockup_client_master show contract storage for bar
{numbers={0 : nat; 1 : nat; 2 : nat} : list nat;
 cdr={strs=0 : big_map bool string; date=-4 : timestamp}}

```

WIP because not all types are supported for the moment and tests are missing."	opened	2020-06-11T13:48:13.265Z	2020-06-13T22:11:43.555Z					master	rafoo@pretty-print-contract-storage	rafoo_	9487506	3836952	1fb6e796d41c242040428c67fd277dfffd59c38d			3	170	170	0	3
tezos/tezos	61276858	1890	3836952	Signer-backends: remove dead code		merged	2020-06-11T14:58:46.386Z	2020-06-12T12:36:21.568Z	pirbo	2020-06-12T12:36:21.604Z			master	raphael-p@remove-deadcode-in-signer-backends	raphael-proust	9487506	3836952	5cb48cac5123c78b50b9bae914f112e3e8bf162a			1	0	8	8	1
tezos/tezos	65264060	1994	3836952	Improve node configuration validation support	"# Context

### Overview

This MR aims to provide a better support for validating the node configuration.

Currently, most of the configuration validation is done in the `Node_config_file` module.

Here, we provide the `Node_config_validation` module which defines different  
tools that aim  to validate and report errors and warnings of a node configuration  
file in a standardized and proper way, reporting guilty config fields and values.

For now, all the previous configuration tests have been ported to the new module.  
Only a fresh validation is introduced, the one regarding the expected proof-of-work.  
The approach of the `Node_config_validation` aims to ease the creation of new validations  
using combinators and the composition of validations relying on a 'pipeline' design.  
Therefore, I would suggest to concentrate efforts into merging this MR and then expanding the set of validations.

### `tezos-node config validate`

It also introduces a new command, named `tezos-node config validate`, that validates the node configuration file.  
This command can also be used to validate a new parameter, giving that the current configuration file is valid.

For instance:

```shell
$ ./tezos-node config validate --expected-pow 1234
Jul 31 17:21:52.468 - [error] node.config.validation: field ""p2p.expected-proof-of-work"", value: ""1234."". Expected proof-of-work must be between 0 and 256 (inclusive).
```

### The `--disable-config-validation` argument

In order to allow users to play with a configuration file that the node considers as invalid,  
a new argument is introduced, `--disable-config-validation`, that allows to bypass the node  
configuration validation.

For instance:

```shell
$ ./tezos-node run --disable-config-validation --expected-pow 1234
Jul 31 17:29:16.245 - node.main: starting the Tezos node (chain = TEZOS_MAINNET)
Jul 31 17:29:16.245 - node.main: disabled node configuration validation
Jul 31 17:29:16.245 - node.main: disabled local peer discovery
...
``` 

Related issue: https://gitlab.com/tezos/tezos/-/issues/841

Regarding the issue above, this MR performs the right check (i.e `expected-connections` should be less that `max-connections`).

```shell
$ cat ~/.tezos-node/config.json
{
  ""p2p"": {
    ""bootstrap-peers"": [
      ""boot.tzbeta.net""
    ],
    ""listen-addr"": ""[::]:9732"",
    ""limits"": {
      ""max-connections"": 9
    }
  },
  ""rpc"": {
    ""listen-addr"": ""localhost:8732""
  },
  ""log"": {
    ""output"": ""/tmp/tezos-node.log"",
    ""rules"": ""* -> notice"",
    ""template"": ""$(date) - $(section): $(message)""
  }
}
$ ./tezos-node run
Sep 28 12:59:17.484 - [error] node.config.validation: The expected number of connections (50) is greater than the maximum number of connections (9)
Sep 28 12:59:17.484 - [error] node.config.validation: found: ""p2p.limits.expected-connections"" (50), ""p2p.limits.max-connections"" (9)
```
# Manually testing the MR

The MR can easily be tested by creating an incorrect configuration file and trying to validate it. 

# Reviewers

@vect0r"	opened	2020-07-22T17:39:18.930Z	2020-10-26T13:43:08.496Z					master	phink@check-config-consistency	phink	9487506	3836952	fdbbcdcc8a232c2c15cb2dcca06d880b3d8492d5			8	582	819	237	8
tezos/tezos	61187433	1886	3836952	WIP: divide `lib_shell` into smaller libs	"This MR extracts two ""lower-level"" libraries out of `lib_shell`:
1. `lib_state` which provides an abstraction of the store
2. `lib_ddb` which provides an abstraction of the network and the store

Before this MR, `lib_shell` consists of a large number of modules (about 40) with rather complex dependencies and not apparent structure.

The goal of this MR is to make the shell more modular and tractable by making explicit important sub-components, and their dependencies. These components can be specified, tested and maintained separately. 

This split was easy to achieve just by moving files around, the only modifications to the code concern the tests which have been divided into two groups.

WIP:
1. A small part of `shell_test_helpers.ml` is duplicated between `lib_state/test` and `lib_shell/test`. Need to think where is the best place for this (or if we can live with the duplication)
2. double check dependencies in dune/opam files (is there a way to test that automatically?)
3. Rebase over the new storage

For a future MR:
1. We can probably take advantage of libraries namespaces (instead of relying on naming conventions such as `Distributed_db_*`). We can also statically restricting the set of exported modules (only `Distributed_db` is accessed outside `lib_ddb`).
2. The shell bypasses ddb to access the storage, maybe we can have a cleaner abstraction and have `ddb` as the only interface between `lib_shell` and the network/storage."	closed	2020-06-10T18:58:17.666Z	2020-08-05T09:10:59.689Z			bidinger	2020-07-17T09:32:39.870Z	master	philb@extract_lib_ddb	bidinger	9487506	3836952	d889d8ca1eaa129d568f5370f94a96cdb1327a3a			43	310	346	36	43
tezos/tezos	61241534	1888	3836952	Shell: remove DDb operation_hashes messages	"This removes the following messages from `Distributed_db_messages`
* Get_operation_hashes_for_blocks
* Operation_hashes_for_block

As well as the corresponding requesters.

The requester for ""operation hashes"" isn't exported to the shell, so these values are never queried by the shell (nor by ddb).

This addresses https://gitlab.com/nomadic-labs/tezos/-/issues/150

Question: this message isn't used by the node, but it could be used by other tools I'm not aware of. Is it considered part of the specification of a Tezos node or just a relic of the past? 
"	merged	2020-06-11T09:55:39.377Z	2020-06-15T14:47:54.018Z	adrianbrink	2020-06-15T14:47:54.048Z			master	philb@ddb_deadcode	bidinger	9487506	3836952	877802b39a5259adf9ed9a147ac8c106924873b3			9	3	212	209	9
tezos/tezos	61063946	1882	3836952	Test/Python: Fix an issue related to singleprocess option (!1759)	"A bug related to the scoping of a variable (after rebase) made Python
ran the tests in `singleprocess` mode even if the option was not
specified

# How to test this MR

After creating a log directory such as `/tmp/log`

Check that:
1. For a random test using a node, call `pytest` with the option `--singleprocess` and a logging directory with the option `--log-dir`. In the log of the node, observe a line similar to `Apr 16 21:52:41 - block_validator_process_sequential: Initialized`.
2. Without the option, you observe a line similar to `Jun  9 18:46:52.887 - block_validator_process_external: Initialized`"	merged	2020-06-09T16:50:02.204Z	2020-06-10T08:44:36.936Z	pirbo	2020-06-10T08:44:36.962Z			master	francois@fix-singleprocess-option	Saroupille	9487506	3836952	f443a9c38814cb6aae5fef4036138f936d33a869		f443a9c38814cb6aae5fef4036138f936d33a869	1	4	7	3	1
tezos/tezos	60964274	1879	3836952	Sandbox:  update flextesa test suite for ledger-wallet and ledger-baking	"In place of !1860
- Adds tests for the parsing of manager.tz operations
- Fixes terminal-based-prompts to make them more accurate with what ledger actually displays
- Removes dead code"	merged	2020-06-08T20:40:51.923Z	2020-06-15T07:46:58.616Z	pirbo	2020-06-12T13:35:45.715Z			master	jam@flextesa-test-audit	unique_username	5906749	3836952	e5f03b8a72410f331a70e94b356a75f11e35569c			2	509	763	254	2
tezos/tezos	60906768	1878	3836952	Doc: howtoget use opam from apt, remove which	fix #795	merged	2020-06-08T11:01:14.360Z	2020-06-09T08:24:32.911Z	pirbo	2020-06-09T08:24:33.178Z			master	marco-doc	paracetamolo	9487506	3836952	7b04559d7a1afc96381e801e0fb2c696e946cfa0			1	3	14	11	1
tezos/tezos	61157150	1884	3836952	Yet an other tezos/opam-repository refresh (hacl-star+ocamlformat)		merged	2020-06-10T14:26:46.410Z	2020-06-10T17:00:13.608Z	pirbo	2020-06-10T17:00:13.649Z			master	opam_opam_opam	pirbo	9487506	3836952	884944fc4abe1669570b82813c2e4fc286b87290			3	4	7	3	3
tezos/tezos	60900748	1875	3836952	Lib_stdlib_unix: improve performance of display_progress	"... by delaying the formatting of the output message until it's
definitely going to be printed.

Previously, the output string was _always_ constructed by
`Format.kasprintf`, even when the refresh counter had not been reached,
resulting in lots of redundant string allocations inside the hot loop of
the context dump."	merged	2020-06-08T10:03:12.139Z	2020-06-09T10:43:48.793Z	pirbo	2020-06-09T10:43:48.832Z			master	display-progress-performance	CraigFe	18643592	3836952	d2a77026e43a25ecf288f923f4a7348c550d7928			4	48	76	28	4
tezos/tezos	61109671	1883	3836952	P2p: rename P2p_socket.kick into P2p_socket.nack	Small refactoring listed in nomadic-labs/tezos#13	merged	2020-06-10T07:48:15.916Z	2020-11-02T14:54:46.654Z	adrianbrink	2020-06-15T15:09:49.978Z			master	igarnier@rename-p2p-kick-nack	igarnier	9487506	3836952	6d283b0ffc392eee5e3419df6483d067f80b6947			4	14	28	14	4
tezos/tezos	60902433	1877	3836952	Tooling: state OCamlformat version in config files	This causes `ocamlformat` to fail if run with a version other than `0.10`, making it harder to accidentally reformat the entire repository with an incorrect version.	merged	2020-06-08T10:18:48.958Z	2020-06-09T10:15:00.123Z	pirbo	2020-06-09T10:15:00.158Z			master	explicit-ocamlformat-version	CraigFe	18643592	3836952	0ec6100627e993c076e7955088450845b8e503ed			109	109	109	0	109
tezos/tezos	60768666	1874	3836952	Tests: fix wrong usage of assert_run_failure	"Spotted by @bidinger.
`assert_run_failure` is now a context manager."	merged	2020-06-05T12:56:52.009Z	2020-06-15T16:30:17.373Z	pirbo	2020-06-09T11:21:52.181Z			master	dannywillems@fix-wrong-usage-assert-run-failure	dannywillems	9487506	3836952	0b18861dbd3ef6cdc8591d36553b77d077c0a451			1	1	4	3	1
tezos/tezos	61290967	1891	3836952	Modernise option	"For `Option` use the same extension technique as with List and String: have `tzOption.ml` in `lib_stdlib` and merge it with `Stdlib.Option` in `lib_base`.

Note that due to minor differences between `Stdlib.Option` and `Tezos_stdlib.Option`, the changes introduced by this MR are far extensive but shallow. E.g., `map` doesn't take a label for its argument.

Once this is merged, it is possible to open an MR against `proto-proposal` to give the environment v1 access to this new version of option."	merged	2020-06-11T17:36:20.949Z	2020-06-19T15:49:57.414Z	rafoo_	2020-06-18T08:10:01.228Z			master	raphael-p@modernise-option	raphael-proust	9487506	3836952	e384c3ee37f863c39000388c5fa60fa97dc9d8cc			95	450	911	461	95
tezos/tezos	60901518	1876	3836952	Tooling: correctly guard against no arguments to lint.sh	"Previously, the script attempted a `shift` that fails in the case where
no arguments are passed. The usage message is now printed appropriately
in this case."	merged	2020-06-08T10:08:29.281Z	2020-06-15T13:16:23.342Z	adrianbrink	2020-06-15T13:16:23.373Z			master	lint-script-no-arguments	CraigFe	18643592	3836952	0a4c49a61bab9d45a363a3ead88307c93c0e7973			1	1	2	1	1
tezos/tezos	60719483	1870	3836952	"WIP: Resolve ""tezos-client crashes when ~/.tezos-client/config is broken or empty"""	Closes #822	closed	2020-06-05T03:36:13.726Z	2020-06-05T03:36:49.207Z			camlspotter	2020-06-05T03:36:49.222Z	master	822-tezos-client-crashes-when-tezos-client-config-is-broken-or-empty	camlspotter	3836952	3836952	3f4be780d80337454518b7fed424520c1a0a5c3c				0	0	0	0
tezos/tezos	61638938	1905	3836952	Extend lwtreslib with hashtbl	"Part 3 of !1872

Depends on !1904

Reviewers: @mbouaziz @vbotbol"	merged	2020-06-16T09:09:25.437Z	2020-07-07T07:29:55.952Z	pirbo	2020-07-07T07:29:55.991Z			master	raphael-p@extend-lwtreslib-with-hashtbl	raphael-proust	9487506	3836952	e7266ad0ad41093d6db5251666d377414c6f78f4			21	642	745	103	21
tezos/tezos	60679291	1868	3836952	lib_p2p: greylisting peers on decoding error	"Currently a peer that send us a malformed message is simply
disconnected.
This patch additionally bans temporarily (eg greylists) the offending peer.

For the record, greylisting the peer results in a greylisting of its
identity and of its IP address."	merged	2020-06-04T16:17:25.917Z	2020-06-09T23:11:53.346Z	raphael-proust	2020-06-08T09:05:17.456Z			master	julien@p2p_ban_on_decoding_error	julien.t	9487506	3836952	061e0b6e5f981499339782ce4c42c56d6a8b31eb			3	9	11	2	3
tezos/tezos	60719635	1871	3836952	Fixed the error reporting when .tezos-client/config is not a valid JSON file	This is a fix for #822	merged	2020-06-05T03:40:59.678Z	2020-08-03T16:15:20.221Z	raphael-proust	2020-06-12T08:25:23.643Z			master	jun@tezos-client-config-file-parse-error-fix	camlspotter	11126765	3836952	7b3050f978a0118099a80f0e4b69ebd1bbac4e6e		4d45b3357f6e931e54bca7dbb1b2c0852474106c	1	15	23	8	1
tezos/tezos	60626897	1865	3836952	Docker: fix '--rpc-port' option	"* It fixed the **--rpc-port** option which is currently not parsed correctly in the script and passed to the node container.
* It prevents the node to fail due to unknown option at launch."	merged	2020-06-04T10:48:29.098Z	2020-06-09T12:38:37.380Z	romain.nl	2020-06-09T12:38:37.410Z			master	docker-deployment-rpc-port	ycoriton	19186834	3836952	296df0d6144dde546e06a62ea1bda02505759652			1	3	6	3	1
tezos/tezos	60741493	1873	3836952	Update CI integration tests	"This MR updates `.gitlab-ci.yml` with the diff generated by `./scripts/update_integration_test.sh`.

The diff plugs the following tests that were missing:

* `tests_python/tests/test_codec.py`
* `tests_python/tests/test_mockup.py`

Both of these tests were added recently and forgot to update the CI accordingly :face_palm: . Fortunately the tests are still passing, so no harm was done :joy_cat: .

The CI could maybe check that such things are not forgotten, but this should be the subject of another issue."	merged	2020-06-05T09:09:53.928Z	2020-06-09T09:17:17.226Z	pirbo	2020-06-09T09:17:17.262Z			master	smelc-update-CI-integration-tests	smelc	18024911	3836952	20323cc54efaadeceacca0cb6c5946d4601cf583			1	12	12	0	1
tezos/tezos	60696919	1869	3836952	tezos-client: add verbose-signing and blake 2b hash to multisig command suite	"Adds the verbose-signing switch to a number of the multisig commands and also displays the Blake 2b hash in the ""prepare multisig*"" set of commands"	merged	2020-06-04T19:40:50.682Z	2020-06-15T13:38:38.211Z	adrianbrink	2020-06-15T13:38:38.239Z			master	jam@add-verbose-sign-multisig	unique_username	5906749	3836952	247150c2b138f80a351454d2d25d4ee78688f904			6	130	396	266	6
tezos/tezos	60656390	1866	3836952	Protocol environment: fix dependencies in sigs/structs opam and dune		merged	2020-06-04T14:37:33.632Z	2020-06-04T17:48:14.052Z	pirbo	2020-06-04T17:48:14.088Z			master	raphael-p@fix-opam-build-currently-broken-in-master--opam	raphael-proust	9487506	3836952	946cb584605a01e67d823de4fc0f0dc68e8206f2		b0f589dff9a091589ca5ccd5b53aadb61c0167a2	6	17	23	6	6
tezos/tezos	60623128	1864	3836952	Add additional parameter shell to run/run_generic	"Require when a parameter contains quotes.
See https://docs.python.org/3.6/library/subprocess.html#security-considerations

A test in Sapling (see https://gitlab.com/cryptiumlabs/tezos/-/merge_requests/169 and https://gitlab.com/cryptiumlabs/tezos/-/blob/67fd51fb6b08837bb3f59754a61690629ad8c65f/tests_python/client/client.py#L906) does use this feature. Useful for commands like:
```
tezos-client sapling forge transaction using shielded-tez from alice sending \
  ""3 to  zet13DPAZqRRtU9j6u9U35cZrrW4McQBQqun8cMciRzdcLjwNjFrPRnCLUX3CEiVugSQ5 with memo hell0"" \
  ""210 to zet13yz6m1RTCrRtqMyyPzyoJNzF42D3b2VpJ1uPeSyGXHKH7Bvj4akc2pSVvx3DuQyzC with memo hell1"" \
  --json
```

This commit will be cherry-picked for 169."	closed	2020-06-04T10:12:23.702Z	2020-06-08T12:13:05.654Z			dannywillems	2020-06-08T12:13:05.670Z	master	dannywillems@add-shell-param-in-run-python	dannywillems	9487506	3836952	55d480e8fae5d7c0442803cf07e43a421b2e10ae			2	12	18	6	2
tezos/tezos	61171424	1885	3836952	Tests/Python: more deterministic voting full test	"Fixes the voting_full test expectation on protocol transition (the `PROTO_B` baker starts baking when the metadata's `next_protocol` is equal `PROTO_B`, rather than `protocol`). Without this change, the test may not always fail (it's sensitive to timing of when the `PROTO_B` baker bakes the first block). It seems that it's more likely to fail on proto-proposal branch than in master, perhaps because on master proto-alpha and 006 are pretty much the same (modulo migration code).

Furthermore, we
- only use one bootstrap account to bake. This make sure delegate is always active
- use retry-based check of chain_id (to give some leeway for the run time of migration of the new protocol)
- launch new protocol baker only after corresponding protocol is known as 'next_protocol'"	merged	2020-06-10T16:54:22.612Z	2020-07-02T11:36:15.931Z	adrianbrink	2020-07-02T11:36:15.960Z			master	tomas/test-voting-full-next-protocol-fix	tzemanovic	11412215	3836952	14eb0b08931a52826face9960ee28752544a33a5			3	39	58	19	3
tezos/tezos	60554323	1860	3836952	Update flextesa test suite for ledger-wallet and ledger-baking	"- Adds tests for the parsing of manager.tz operations
- Fixes terminal-based-prompts to make them more accurate with what ledger actually displays
- Removes dead code"	closed	2020-06-03T19:27:25.503Z	2020-06-09T11:37:53.934Z			unique_username	2020-06-08T20:41:33.514Z	master	flextesa-dev-master	unique_username	5906749	3836952	5e69e0eca82f0b13e5fb1c424180007f1e4b9f1a			2	509	763	254	2
tezos/tezos	60607183	1861	3836952	Error-only monad in error monad	This MR adds error-only functions to match the combined error-lwt functions of the error monad	merged	2020-06-04T08:09:53.710Z	2020-06-04T14:20:36.930Z	mbouaziz	2020-06-04T11:39:09.691Z			master	raphael-p@error-only-monad-in-error-monad	raphael-proust	9487506	3836952	de994c3ea25b1ce9cb40ce71d5384a4e941620ad			24	148	274	126	24
tezos/tezos	60612324	1863	3836952	PVSS: more tests and various smaller changes	These changes are taken from https://gitlab.com/cryptiumlabs/tezos/-/merge_requests/80	merged	2020-06-04T08:52:51.308Z	2020-06-08T10:23:52.218Z	raphael-proust	2020-06-08T10:23:52.252Z			master	tomas/pvss-wee-bit-more-tests	tzemanovic	11412215	3836952	3ded0cb8ed1c495664b3b4ecdd62007624b35ae8			5	186	213	27	5
tezos/tezos	60362486	1855	3836952	Doc: explain how to get Rust for master	The `master` branch now requires Rust to compile before running `make build-deps`. This MR adds a small paragraph to the documentation to explain this and gives a link to rustup, a script which seems to be the preferred way to install both Rust and Cargo.	merged	2020-06-02T11:19:35.667Z	2020-06-04T12:06:42.614Z	pirbo	2020-06-03T09:02:48.251Z			master	romain-doc-rust	romain.nl	9487506	3836952	16acd8472edbb0092485b66a7f82b61653ebe560			1	4	5	1	1
tezos/tezos	60737082	1872	3836952	WIP: Lwt-result-stdlib: a stdlib replacement that's lwt/error-monad aware	"Replaces !1804 with opam test for the CI

This MR is being replaced with smaller MRs that introduce the different components one by one to ease reviewing/merging.

For historical reason, work has started on different parts concurrently and now the two sequences of MR are kinda independent so we'll need rebasing when one strand gets an MR merged. I, @raphael-proust, being familiar with the aim and implementation of these MR, volunteer to do that.

- Bigger Lwtreslib
    - [x] !1903
    - [x] !1904
    - [x] !1905
    - [x] !1968 
    - [x] !1895
    - [x] !2050 
    - [ ] ~~!1967~~ !2131 (List (and Tests)) 
    - [ ] !2054 (Option)
    - [ ] Arrays
    - [ ] String?
    - [ ] `Seq_s` (Lwt-aware seqs), `Seq_e` (error-aware seqs), etc.

- Better Lwtreslib
    - [x] !2018 
    - [ ] !2131 (Tests (and List))
    - [ ] !2026 (More independence from Error-monad, rearrange `Seq.Monad` at the same time)

- Misc
    - [x] !2036 

---------------------------

This meta-MR introduces `tezos-lwt-result-stdlib`, a library with Set, Map and other collections that are similar to Stdlib's but
- without any exceptions and
- with support for error, lwt, and combined error-lwt monad traversal.

The ultimate aim is to shadow the Stdlib's version to enforce use of the error monad.


### future steps

- [ ] Add support Lwtreslib in the protocol environment
- [ ] Increase shadowing of the Stdlib:
    - [ ] Option
    - [ ] Array
    - [ ] Seqlwt (a Seq-like module that has more integration with Lwt, this should allow to have a lazy `map`) (Wouldn't Lwt_stream suffice?)
    - [ ] Queue
- [ ] make the trace abstract/private (to prevent https://gitlab.com/tezos/tezos/-/issues/864 from ever happening) with generic enough combinators (seuqntial for tracing, concurrent for combining)
- [ ] Absorb `TzString` and `TzList` extensions possibly?"	opened	2020-06-05T08:30:10.490Z	2020-10-15T12:57:01.799Z					master	raphael@error-monad-with-bind-into-lwt--opam	raphael-proust	9487506	3836952	d8439a34d35d1bc647a8a5487ffca15f55c2e659			66	2223	2626	403	68
tezos/tezos	60106265	1852	3836952	Client: missing URI scheme error handling	"When the URI scheme is missing, the current assertion is not informative for users:
```
Fatal error:
  ""Assert_failure src/lib_client_base/client_keys.ml:237:6""
```

This may be even more confusing when one uses a incorrect argument as in #815 "	closed	2020-05-29T16:38:27.095Z	2020-06-02T15:25:20.421Z			tzemanovic	2020-06-02T15:25:20.440Z	master	tomas/client-keys-missing-scheme-error-handling	tzemanovic	11412215	3836952	da7615e4d0d484853ab20abc29ff9c259bc9f301			1	14	17	3	1
tezos/tezos	60358899	1853	3836952	Doc: update to bisect_ppx2.4.1	"It looks like the opam repository now uses a bisect_ppx 2.4.1 which solves a [limitation on the code](https://github.com/aantron/bisect_ppx/issues/319).

This MR reverts some commits from tezos/tezos!1714 and updates the documentation"	merged	2020-06-02T10:45:19.214Z	2020-06-09T17:26:13.609Z	pirbo	2020-06-09T17:26:13.850Z			master	mehdi@bisect_ppx2.4.1	mbouaziz	9487506	3836952	691f08c22e3aafd006a4e29fa1b5e82159f8147a			8	59	149	90	8
tezos/tezos	60612191	1862	3836952	Doc: add a note about the PATH for Rust	The rustup documentation says that it updates the `PATH`, but actually it seems it must be done by hand.	merged	2020-06-04T08:52:23.424Z	2020-06-15T14:07:34.395Z	adrianbrink	2020-06-15T14:07:34.428Z			master	romain-doc-rust	romain.nl	9487506	3836952	073648a9b19144f301d559646dae1303ed79a4fb			1	10	12	2	1
tezos/tezos	60381172	1856	3836952	Client/Mockup: add describe service and allow `rpc {get,post,..}` commands	"This is related to issue nomadic-labs/tezos#168

This MR does two things:

- it registers `description_service` in the service tree of the mockup mode, allowing more informative errors to be given to the user when an RPC is not implemented in this mode.
- it branches the `rpc {get,post,..}` commands back to the mockup mode

The second point involves importing part of the resto http server logic back in the mockup mode but code duplication is thankfully rather limited.

Missing:
* [x] doc
* [x] tests"	merged	2020-06-02T13:57:36.705Z	2020-06-19T16:06:43.693Z	rafoo_	2020-06-17T08:20:41.160Z			master	igarnier@mockup-describe	igarnier	9487506	3836952	eef2c0d4a1b6c258605a16f4cd3e829a55368c29			4	196	235	39	4
tezos/tezos	60060656	1851	3836952	build-deps: add depext conf-libffi		merged	2020-05-29T13:33:25.610Z	2020-05-29T14:09:59.794Z	pirbo	2020-05-29T14:09:59.834Z			master	abate@libffi	abate	9487506	3836952	61c00b8fd7a409002432dba17ece6c19eedb6c35			1	1	2	1	1
tezos/tezos	60361899	1854	3836952	Client: Improve key uri parsing errors	"This is related to #653.
It doesn't implement what 653 expects (being able to give a ""public key hash you know the corresponding secret key of"" when a secret key alias is expected) but it makes slightly more explicit that what was expected is a secret key alias :-).

The vast majority of the changes is a refactoring to ensure that ""uri with no scheme"" error goes through the error monad. I left Uri.of_string ""unprotected"" because I didn't manage to conclude on whether it can fail or not (It relies on Re.exec that can raise Not_found in general but does it on the uri regular expression specifically?)."	merged	2020-06-02T11:13:03.278Z	2020-06-08T19:48:05.211Z	pirbo	2020-06-08T19:48:05.250Z			master	multisig-failure	pirbo	9487506	3836952	ce2ff455c9aadc760c8bb3c320f064a88a3620f1			19	112	229	117	19
tezos/tezos	59841857	1850	3836952	CI: uses a build image with librustzcash	First preliminary step toward libsapling!	merged	2020-05-27T17:48:06.995Z	2020-05-28T08:55:29.810Z	pirbo	2020-05-28T08:55:29.944Z			master	librustzcash_in_base_image	pirbo	9487506	3836952	7cc1bab713ba6b2f202e0581f3817a8edbecad8e			3	3	5	2	3
tezos/tezos	60657535	1867	3836952	CI: run opam tests if opam or dune files changed	"We often have MRs which should run the `opam` tests but don't because the branch does not have `opam` in the name. This MR causes the tests to automatically run `opam` tests if a `.opam` or `dune` file changed, even if the branch name does not contain `opam`.

To test, create branches (on top of `romain-ci`) with or without `opam` / `-release` in the name, and with or without modifying `dune` or `.opam` files, push them and check if the pipeline has stage 3."	merged	2020-06-04T14:45:23.985Z	2020-06-05T10:29:07.787Z	paracetamolo	2020-06-05T10:29:07.825Z			master	romain-ci	romain.nl	9487506	3836952	764fcae3ba2a0dd8bce9377478079de924d16ba9			1	15	19	4	1
tezos/tezos	59689249	1842	3836952	CI: update base docker image (includes libffi)	Fixes tezos/tezos#810	merged	2020-05-26T12:35:39.811Z	2020-05-26T13:39:23.939Z	pirbo	2020-05-26T13:39:24.163Z			master	ffi_in_docker	pirbo	9487506	3836952	dbd78938c8b8f43fa20fde5b04c34fa04a4c90d6			2	2	4	2	2
tezos/tezos	64914073	1980	3836952	Base: add crowbar tests for Time	"
# Context 

Lib base is not tested directly. (As a base library it is tested indirectly when testing the code that relies on it, but that is not sufficient.)

Fixes https://gitlab.com/tezos/tezos/-/issues/538

Depends on the MR https://gitlab.com/tezos/opam-repository/-/merge_requests/104

# Manually testing the MR

```
opam install crowbar
dune build @src/lib_base/runtest
```

# Reviewers

Note to the reviewer: the top commit is not to be merged, it's sole purpose is to point the CI to docker registry of NL"	merged	2020-07-20T08:02:58.443Z	2020-08-25T10:37:20.003Z	pirbo	2020-08-25T10:37:20.499Z			master	raphael-p@test-lib-base	raphael-proust	9487506	3836952	0493e43a0a8a4c60233951db73249f3949839b1c			8	252	256	4	8
tezos/tezos	60506286	1859	3836952	Client: add commands to generate chain ids	"This MR is related to nomadic-labs/tezos#167

It adds two commands. Straight from the `man`:

```
  compute chain id from block hash <hash>
    Computes the chain id corresponding to a block hash.
    <hash>: the block hash from which to compute the chain id
  compute chain id from seed <string>
    Computes a chain id from a seed
    <string>: the seed from which to compute the chain id
```
Example interaction:
```
./tezos-client compute chain id from seed ""My favourite seed""
NetY1kJfpxoe34R
```"	merged	2020-06-03T12:27:38.493Z	2020-06-10T12:39:17.378Z	rafoo_	2020-06-09T20:39:25.332Z			master	igarnier@chain-id-command	igarnier	9487506	3836952	adc6fae701a7c8bdc47ba3c32bf06bcd6cd307e3			4	83	92	9	4
tezos/tezos	59704348	1844	3836952	(Closed because targetting wrong branch)	(Closed because targetting wrong branch)	closed	2020-05-26T14:41:06.757Z	2020-05-26T14:43:24.339Z			igarnier	2020-05-26T14:42:54.956Z	master	igarnier@faster-interp	igarnier	9487506	3836952	db345e4f4f3350efd5951fcdbd2de16625867d0b			593+	20250	40415	20165	607
tezos/tezos	59717196	1846	3836952	Doc: small fix of typo in README.rst	"correct the main `make` command to build the documentation
from `make html` to `make doc-html`"	merged	2020-05-26T15:55:49.766Z	2020-05-29T12:22:36.983Z	pirbo	2020-05-29T12:22:37.163Z			master	hx-doc-readme-typofix	haochenxie	16805926	3836952	c8b4760c1950c1c74dcba9ce79aa48319d9aeb96			1	2	3	1	1
tezos/tezos	59675867	1841	3836952	Doc/Michelson: fix the formatting of the typing rule of FAILWITH	In the Michelson documentation, the typing rule for FAILWITH was badly formatted and the display was not consistent with the other typing rules.	merged	2020-05-26T10:33:51.361Z	2020-05-26T20:51:26.314Z	rafoo_	2020-05-26T20:51:26.664Z			master	rafoo@doc_failwith	rafoo_	9487506	3836952	40d94fb742ecf380538646b02be0b70180a9025c			1	8	14	6	1
tezos/tezos	59493780	1839	3836952	Add missing system dependency in doc	`ctypes-foreign` requires `libffi-dev` (on debian-like systems)	merged	2020-05-23T13:53:12.523Z	2020-05-25T13:08:19.232Z	klakplok	2020-05-25T13:08:19.263Z			master	vbot@fix-sys-dep	vbotbol	9487506	3836952	076ee7dd0bf9ff4491677d764ded2b1c936fe53a			1	1	2	1	1
tezos/tezos	59435905	1837	3836952	WIP: Shadow some stdlib modules with error-aware versions		closed	2020-05-22T14:06:21.789Z	2020-06-03T14:40:34.465Z			raphael-proust	2020-06-03T14:40:34.485Z	master	raphael@shadow-stdlib-seq-set-map	raphael-proust	9487506	3836952	5a8b1e5333925070ae6d33f572e13947e6b8e2db			68	1947	2369	422	70
tezos/tezos	59696850	1843	3836952	No more `Lwt.async`	"Fixes https://gitlab.com/tezos/tezos/-/issues/812

This MR fixes the above issue: it removes calls to `Lwt.async`. One of the removal is done by removing the whole module that the call appears in (the module was dead-code)."	merged	2020-05-26T13:37:01.372Z	2020-05-29T18:39:38.045Z	pirbo	2020-05-29T18:39:38.411Z			master	raphael@no-more-lwt-async	raphael-proust	9487506	3836952	1dd3b62b900b3b4077404c650190f957ccf1fb73			18	163	359	196	18
tezos/tezos	59155683	1834	3836952	Client/mockup: remove calls to Lwt_main.run	"@vect0r reported failures of `tests_python/test/test_mockup.py`:

```
Fatal error:
  Nested calls to Lwt_main.run are not allowed
```

@igarnier guessed this was caused by calls to `Lwt_main.run` in `src/lib_mockup/local_services.ml`. After inspecting them, it seems they are unnecessary hence this MR is removing them. I (@smelc) could not reproduce the issue (which is suspected to be related to different `Lwt` versions) but we have good confidence this patch will fix it nevertheless."	merged	2020-05-20T08:34:06.196Z	2020-05-20T20:57:45.690Z	pirbo	2020-05-20T20:57:45.733Z			master	smelc-mockup-remove-lwt_main_run	smelc	18024911	3836952	63d556a50d6262c552ebf76dd9d024f6a1bdb851			1	44	93	49	1
tezos/tezos	59432761	1836	3836952	introduce structs dot v0, remove mbytes	"This MR does the following:

1. Introduce `src/lib_protocol_environment/structs/` (and a few boilerplate files). This goes along the `src/lib_protocol_environment/sigs/` and aims to provide legacy module implementations for the protocol environment.

2. Remove `MBytes` from all the code that lives outside of the protocol. The protocol code is unchanged, but the deprecated module `MBytes` has been entirely removed from the rest of the code-base. This is made possible by 1.


WIP for the `Option` module: in the branch `raphael@remove-further-modules-with-backwards-compat`"	merged	2020-05-22T13:33:32.989Z	2020-06-04T14:20:37.364Z	paracetamolo	2020-06-04T09:05:28.101Z			master	raphael@remove-mbytes-introduce-structs-dot-v0	raphael-proust	9487506	3836952	076f3ba3bae180af88b562ca0724cf4c52befc9c			44	162	401	239	44
tezos/tezos	59123760	1833	3836952	Tests/python: add missing typing annotations to tests	"Addresses https://gitlab.com/nomadic-labs/tezos/-/issues/166

It does three things:
1. add `check_untyped_defs = True` in `mpyp.ini`, this forces mypy to typecheck code blocks even in non-annotated function (which it doesn't do by default)
2. fix type errors introduced by 1.
3. add type annotations in all tests

3 is particularly useful as it helps the IDE to jump to identifier definitions, even when the definition is lost (because the way pytest links fixture definition to test parameters).

This touches to a lot of code but should be easy to review as it's  mostly annotations.

Note that it doesn't aim at completeness. In particular, some annotations are still missing, for instance
* annotations of fixture definitions that comes from pytest code (e.g `request`)
* `self`, and return type (`None`) of all `test_*` methods (which are only called by pytest)

The next step could be to force developers to annotate everything, for instance by using option
`disallow_untyped_defs = True` in `mypy.ini`.
Pros: we won't forget to add new types
Cons: can be very annoying to add all types, especially some are useless, and some can be hard to find (what's should be the type of pytest `request`?)

There also may be mypy options that enforce some middle ground (we could be more strict on certain files only, and/or add relaxing rules...).

Suggested reviewers: @dannywillems @smelc"	merged	2020-05-19T22:16:28.835Z	2020-06-10T13:37:02.098Z	pirbo	2020-06-10T10:57:13.155Z			master	philb_annotate_tests	bidinger	9487506	3836952	73269702e4ec7f5e60b5c4bbc1f3f39862c3160b			39	599	1120	521	39
tezos/tezos	59705611	1845	3836952	Remove unsafe functions from lwt pipe	Some functions from Lwt_pipe would raise exceptions. This MR removes these functions and forces the caller to deal with cases when the pipe is empty/full. This is to force the caller to be more explicit.	merged	2020-05-26T14:52:56.383Z	2020-07-13T15:57:00.962Z	pirbo	2020-07-13T15:57:01.009Z			master	raphael@remove-unsafe-functions-from-lwt-pipe	raphael-proust	9487506	3836952	0f15f84175e8383234e74d7a6bd8b1c0c6277268			5	53	112	59	5
tezos/tezos	61902721	1914	3836952	p2p: add new rpc /config/p2p and /config/p2p/limits	"FOR CONTEXT READ THE COMMENTS IN THIS MR.

This MR adds two new RPCs `/config/p2p` and `/config/p2p/limits` to 
expose the p2p layer configuration (static and runtime)

It also refactors the code to expose these values. In particular
I move the data types `P2p.config` and `p2p_connect_handler config` in 
to tezos base to expose these values as services.

Reviewers: @julien.t @igarnier @Saroupille"	opened	2020-06-18T11:49:21.750Z	2020-10-29T04:13:59.977Z					master	abate@p2p_config	abate	9487506	3836952	c8ad3e5600999dc4cd489578a5c8377b6548872e			25	677	1297	620	25
tezos/tezos	59090781	1831	3836952	Doc: release candidates are mostly for major versions	We did not make a release candidate for minor version 7.1.	merged	2020-05-19T15:03:40.065Z	2020-05-20T21:24:19.306Z	pirbo	2020-05-20T21:24:19.349Z			master	romain-v7-doc	romain.nl	9487506	3836952	69031428c442ef06bb0bd11a1989abda5b5dee5c			1	1	2	1	1
tezos/tezos	59084005	1829	3836952	Doc: fix version 7.1 note since we backported client patches	Fix a sentence which made sense in a previous branch but which needed to be updated after we backported client patches.	merged	2020-05-19T14:04:44.765Z	2020-05-19T14:32:24.755Z	pirbo	2020-05-19T14:32:24.851Z			master	romain-v7-doc	romain.nl	9487506	3836952	a89fb381167cc1d061d37e92311abbd2dfc7dc31			1	2	4	2	1
tezos/tezos	59778670	1847	3836952	Crypto: Some low-hanging optimisations in PVSS	This MR chnages some of the code in `Pvss` to reduce the number of repeated passes on lists.	merged	2020-05-27T08:59:58.052Z	2020-06-09T17:47:22.803Z	pirbo	2020-06-09T17:47:22.837Z			master	raphael@optimise-pvss	raphael-proust	9487506	3836952	cb51f1e3e5509d83262b065b717c1352960e636f			1	59	59	0	1
tezos/tezos	59080869	1828	3836952	Client/mockup: remove spurious UNIX dependency in mockup	"This MR removes some explicit calls to Unix-dependent functions in the mockup mode.
These have been replaced by calls to (already existing) methods of the client context object.

This partly solves issue https://gitlab.com/nomadic-labs/tezos/-/issues/159.

!1830 depends on this one being merged first."	merged	2020-05-19T13:38:18.915Z	2020-05-20T09:51:37.218Z	raphael-proust	2020-05-20T09:51:37.243Z			master	igarnier@de-unixify-mockup	igarnier	9487506	3836952	9c172548916b3360e3bb4fa5c7607b38285ca00d			9	102	182	80	9
tezos/tezos	59116407	1832	3836952	WIP: Scripts: add a script to aggregate log files	"This MR adds a simple python script that concatenates a set of log files and sort them based on the timestamps on each line. It also adds to each line the name of the corresponding log file.

Example:

```
▶ pytest tests/test_p2p.py --log-dir=tmp  # run some test
...
▶ ls tmp/*   # we have some log files                          
tmp/node0_0.txt  tmp/node1_1.txt  tmp/node2_2.txt  tmp/node3_3.txt  tmp/node4_4.txt

▶ ./scripts/merge_logs.py --help        
usage: merge_logs.py [-h] [--no-tag] [--short-tag] FILES [FILES ...]

Concatenate log files and sort by timestamp. By default, tag each line with the name of the log file.

positional arguments:
  FILES        log files to be merged

optional arguments:
  -h, --help   show this help message and exit
  --no-tag     don't tag lines
  --short-tag  tag lines with a shortened file name

▶ ./scripts/merge_logs.py tmp/* --short-tag 
...
node0_0 May 19 22:15:57.470 - node.main: starting the Tezos node (chain = TEZOS)
node0_0 May 19 22:15:57.470 - node.main: disabled local peer discovery
node0_0 May 19 22:15:57.471 - node.main: read identity file (peer_id = idsANHtwJoUB1yCtJ1iiFmAGjsSU46)
node0_0 May 19 22:15:57.471 - main: shell-node initialization: bootstrapping
node0_0 May 19 22:15:57.471 - main: shell-node initialization: p2p_maintain_started
node0_0 May 19 22:15:57.471 - block_validator_process_external: Initialized
node0_0 May 19 22:15:57.471 - block_validator_process_external: Block validator started on pid 22381 
node0_0 May 19 22:15:57.681 - validator.block: Worker started
node0_0 May 19 22:15:57.681 - node.validator: activate chain NetXdQprcVkpaWU
node0_0 May 19 22:15:57.681 - p2p.maintenance: Too few connections (0)
node0_0 May 19 22:15:57.681 - validator.chain: Worker started for NetXdQprcVkpa
node0_0 May 19 22:15:57.681 - node.chain_validator: no prevalidator filter found for protocol
node0_0 May 19 22:15:57.681 - node.chain_validator:   ProtoGenesisGenesisGenesisGenesisGenesisGenesk612im
node0_0 May 19 22:15:57.682 - prevalidator.NetXdQprcVkpa.ProtoGenesis: Worker started for NetXdQprcVkpa.ProtoGenesis
node0_0 May 19 22:15:57.682 - node.main: starting RPC server on ::ffff:127.0.0.1:18730 (tls = false)
node0_0 May 19 22:15:57.682 - node.main: the Tezos node is now running
node1_1 May 19 22:15:58.761 - node.main: starting the Tezos node (chain = TEZOS)
node1_1 May 19 22:15:58.761 - node.main: disabled local peer discovery
node1_1 May 19 22:15:58.762 - node.main: read identity file (peer_id = idtn4rqNK6dgSfDbj6CQVXRCEXUHfA)
node1_1 May 19 22:15:58.762 - main: shell-node initialization: bootstrapping
node1_1 May 19 22:15:58.762 - main: shell-node initialization: p2p_maintain_started
node1_1 May 19 22:15:58.762 - block_validator_process_external: Initialized
node1_1 May 19 22:15:58.763 - block_validator_process_external: Block validator started on pid 22394 
...
```"	opened	2020-05-19T20:18:33.933Z	2020-08-19T08:43:43.431Z					master	philb_aggregate_log	bidinger	9487506	3836952	83c4a3b7afe4ed2ae06e929b44fb7b594132ab89			1	86	86	0	1
tezos/tezos	58593884	1824	3836952	Update to Lwt 5	New store needs it	merged	2020-05-13T22:06:59.076Z	2020-05-13T23:09:46.088Z	pirbo	2020-05-13T23:09:46.133Z			master	lwt5	pirbo	9487506	3836952	e671e592237d9d8f2e7bfd9f7732ddc94152bc85			9	42	66	24	9
tezos/tezos	59067903	1827	3836952	Lib_crypto: add hacl-star	For now, it is purely artificial to decouple opam-repository update from switching hacl version.	merged	2020-05-19T11:45:28.601Z	2020-05-19T13:58:46.419Z	pirbo	2020-05-19T13:58:46.461Z			master	evercrypt-in-opam	pirbo	9487506	3836952	7edf85e8046a0440fed1fbd5f551ce627b7bd317			3	4	7	3	3
tezos/tezos	59085590	1830	3836952	remove unix dependencies from tezos-shell-services and p2p-shell-services	"This MR removes a unix dependency in  tezos-shell-services and p2p-shell-services.

It removes tezos-workers as direct dependency from tezos-shell-services and p2p-shell-services
and move `worker_types` in `lib_base`

This MR also includes https://gitlab.com/tezos/tezos/-/merge_requests/1828 and can be merged after it.

Last it removes a minor dependency in proto_001 and proto_002 to `Lwt_io`.

Context (please read this issue) :
- https://gitlab.com/tezos/tezos/-/merge_requests/1825"	merged	2020-05-19T14:18:02.732Z	2020-05-22T09:15:34.166Z	romain.nl	2020-05-22T09:15:34.193Z			master	abate@p2p_services-dep	abate	9487506	3836952	c272c0828b5d2cda80e6378763b3393498078a3b			11	18	29	11	11
tezos/tezos	58576471	1823	3836952	Dune: mark vendors/ directory with vendored_dirs	"This prevents `dune` from recursing into the `vendors/` directory when
building all targets, running all tests, or linting with `dune build
@fmt`. Libraries in the `vendors/` directory are also built with
warnings suppressed.

This has the effect of avoiding running tests for `ocaml-blake2`,
`ocaml-lmdb` etc. as part of the `make test` command.

See https://dune.readthedocs.io/en/stable/dune-files.html#vendored-dirs-since-1-11
for more details."	merged	2020-05-13T17:50:26.068Z	2020-05-14T16:20:52.017Z	raphael-proust	2020-05-14T16:20:52.064Z			master	dune-vendored-dirs	CraigFe	18643592	3836952	a21a26e6d9a94aa8b4b0c77447300b85d8bacaef			1	2	2	0	1
tezos/tezos	59799295	1848	3836952	Add a pre-commit hook	"This MR adds a [pre-commit](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks) hook.

The point of this hook is to avoid pushing commits that will trigger silly
CI failures, to save CI runs and have a faster feedback loop (by having
local feedback as opposed to CI feedback). To be fast the hook is incomplete: it doesn't check everything that gitlab CI will check; but it is correct: what the hook checks is required
for gitlab CI to pass. The hook must be fast so that `git commit` stays fast.

This hook:

* executes python tests of staged `*.py` test files
  The point is to execute a subset of `pytest` that is required
  for a commit to pass CI.
  This is most useful when working on the python tests themselves.
* lints and typechecks staged `*.py` files.
* calls ocamlformat on staged `*.ml`, `*.mli` files in a way faster than `make fmt`.
  If staged files are being inspected (i.e. if `--unstaged` is not passed, see below),
  formatted files are added before creating the commit; hereby autoformatting the files upon committing.

The first two points are blocking: if a `pytest` call fails the hook returns a non-zero exit code, forbidding to commit. The same goes for `*.py` files that do not pass linting. The third point is not blocking, because the hook does not try to format a partially staged file (because the call to `ocamlformat` doesn't distinguish between staged and unstaged parts of the file). It seemed overkill to forbid a commit because some unstaged parts are not formatted.

The hook is installed as follows: `ln -sr tests_python/pre_commit.py .git/hooks/pre-commit` (`rm .git/hooks/pre-commit` if you have a hook installed already)

You can call the hook manually on modified but not yet staged files to make sure an upcoming call to `git commit` will succeed using the `--unstaged` flag: `./tests_python/scripts/pre_commit.py --unstaged`.

You can pass `--lint-only` to avoid calling `pytest`, so that the hook
is always fast. In this case, install it as follows:

```
cd .git/hooks
echo '#!/usr/bin/env bash' > pre-commit
echo './tests_python/scripts/pre_commit.py --lint-only ""$@""' >> pre-commit
chmod +x pre-commit
```

I modified the documentation to mention the hook although I'm not really satisfied with the modifications. I feel this hook could be better advertised but I didn't find a better way."	merged	2020-05-27T11:56:07.756Z	2020-07-09T08:25:38.614Z	arvidnl	2020-06-29T14:19:52.664Z			master	smelc-pre-commit-hook-creation	smelc	18024911	3836952	974b06f7b3e6cd2bcdb3b54a122934246b0ae863			3	414	414	0	3
tezos/tezos	58452781	1820	3836952	Try reconnecting when daemons lose connection to the node	"When the node shuts down, daemons' processes will automatically stop as well. This MR reworks the wait and retry mechanism to also retry connecting to the node in the aforementioned situation.

The daemons will wait ~~up to one hour without any response from the node before exiting~~ **forever** trying to restore the connection with a node.

Also removes the asynchronous non-reentrant context closing on garbage-collection that caused a freshly initialized index to be closed and instead exposes `Context.close` (still non-reentrant).

Edit: This mechanism is now enabled by adding the `--keep-alive` option on the command line when starting daemons.

Closes #798"	merged	2020-05-12T17:09:25.402Z	2020-07-15T16:17:31.920Z	adrianbrink	2020-06-08T14:09:25.496Z			master	vbot@daemons_retry	vbotbol	9487506	3836952	7799b4ae13e42d3fd9b4612f162ad8148bd65900			15	296	451	155	15
tezos/tezos	58782500	1825	3836952	Unify simplelogs and legacy logs messages	"This MR does two things :

- remove make_sanitize from the InternalLog.Section module
- use simplelogs.pp to printout messages for the legacy logs.

Using the Simplelogs printer allow us to add more meta-data to the
printout that can be exploit in a json sink.

Context (have a look at the long conversations in these MR and issues ) :

- general discussion about monitoring
  * https://gitlab.com/nomadic-labs/tezos/-/issues/91

- about the changing the print functions for the legacy logging
  * https://gitlab.com/tezos/tezos/-/merge_requests/1743

- about sanitation
  * https://gitlab.com/tezos/tezos/-/merge_requests/1764

- about using a uniform logging system for monitoring logs in general
  * https://gitlab.com/nomadic-labs/tezos/-/issues/142
  * https://gitlab.com/nomadic-labs/tezos/-/issues/91

There are also modules that still use the the legacy logging system
and define their own custom printer. These will be changed in a different MR.

Since converting modules from legacy to simple log is long and time consuming,
this is an interim solution.
"	closed	2020-05-15T14:14:19.661Z	2020-05-28T16:12:03.228Z			abate	2020-05-28T10:59:29.263Z	master	abate@pp_short_log	abate	9487506	3836952	451ecd5d55a87fb35012e7370e6adcbadfcf3587			14	105	203	98	14
tezos/tezos	58451406	1819	3836952	Backports in 006 client	This applies in `src/proto_006_PsCARTHA` the commits made in `src/proto_alpha/lib_client*`.	merged	2020-05-12T16:56:18.776Z	2020-05-18T13:23:38.545Z	romain.nl	2020-05-18T13:23:38.571Z			master	backports_in_006_client	pirbo	9487506	3836952	0a101a5d40a27e6509befac93216a03dfabc4e32			7	243	466	223	7
tezos/tezos	58410258	1817	3836952	Update version and documentation for version 7.1	"DO NOT MERGE before version 7.1 is actually released.

This MR updates the changelog (both in `CHANGES.md` and the release documentation page) and sets the version on `master` to `7.1+dev` (instead of `7.0+dev`).

It also fixed backquotes in the changelog in `version-7.rst`. It was copied from `CHANGES.md` but single backquotes result in italic; what we really wanted was monospace, i.e. double backquotes."	merged	2020-05-12T12:21:33.886Z	2020-05-19T13:16:51.262Z	pirbo	2020-05-19T13:16:51.305Z			master	romain-v7-master	romain.nl	9487506	3836952	fcb50c3404be7d5bda3d32f2c0aacfdf92455e94			3	119	174	55	3
tezos/tezos	62055810	1921	3836952	P2p/io_scheduler: make state of moving average explicit	"Issue: nomadic-labs/tezos#204

The moving average module (in `lib_stdlib_unix`) currently uses a global hash table to store all counters for `p2p_io_scheduler`. There's also a worker that takes care of updating the associated stats.

This MR makes the internal state of this worker manifest. `P2p_io_scheduler` is adapted to these changes: it is now the case that each `P2p_io_scheduler.t` has its own `Moving_average` worker (it was not the case before).

Other changes:
- the refresh rate of the `Moving_average` worker was hardcoded to 1 second, it is now a parameter;
- previously, the worker was lazily started at the creation of the first counter, it is now started when initializing the worker state;
- (unrelated) some unused fields in some records of `P2p_io_scheduler` were removed."	merged	2020-06-19T15:23:50.927Z	2020-08-13T08:52:34.857Z	tzemanovic	2020-08-13T08:52:34.909Z			master	igarnier@moving-average-explicit-state	igarnier	9487506	3836952	cde4a51259809238e98889ce4ad353b525a5de52			5	84	136	52	5
tezos/tezos	58839123	1826	3836952	p2p test framework : detached process improvement	"Fixes: https://gitlab.com/nomadic-labs/tezos/-/issues/132

Currently lib_p2p/test contains a test framework that allows to fork a given number of process that execute a given function in a separated system thread.

This is used to run connections and communications between simplified p2p pools, with fine grain control over the network topology and the order of the messages.

The issue addressed here is that the detached process can only return error code, not the return value of the function executed this lead to a poor UX for people writting test with this framework.

This MR adds a channel from the process in which the result of the executed function is pushed at the end of the run, before stopping the thread. Further more it permit to optionaly specify data encoding for values exchanged with the process. 
It is optional to quicken the writing of test when exchanged values can be exchange easily through marshalling, but it should be used whenever an extensible type is exchanged.


~~This branche is based on @romain.nl work to allow the registering of recursive error kind: !1770~~

~~An addendum to this MR, !1892, provides a better handling of parallel errors.~~"	merged	2020-05-16T11:25:24.916Z	2020-07-27T09:52:00.846Z	pirbo	2020-07-27T09:52:00.855Z			master	julien@p2p_test_process_improvement	julien.t	9487506	3836952	7dfdaf4cedbef123f3454e737d2765414ca037ba			9	556	662	106	9
tezos/tezos	58013290	1811	3836952	Makefile: ignore opam error when checking if Merlin is installed	"If a user only has opam 2.0.0 (which we accept in our version check),
the command emits an error: `opam: unknown option --silent, did you mean -s ?`.
But actually compilation happens anyway.

Instead of requiring users to use opam 2.0.0, I redirect this error
to `/dev/null`. The only consequence is that users with opam 2.0.0
that use merlin will not run `dune build check` automatically, and thus
will get less precise ""jump to definition"" behavior."	merged	2020-05-07T13:15:48.399Z	2020-05-07T14:54:48.854Z	pirbo	2020-05-07T14:54:48.886Z			master	romain-makefile-merlin	romain.nl	9487506	3836952	2efc285c4cde4d428c3b491164cd06959dcaefa1			1	1	2	1	1
tezos/tezos	58451256	1818	3836952	Tests/python: --sandbox is no longer needed	"The `--sandbox` option is no longer needed when running a sandbox node. The genesis public key that we used in the sandbox tests is now hard-coded in the node.

This MR simplifies the python launchers by getting rid of the `--sandbox` option."	merged	2020-05-12T16:54:21.533Z	2020-05-20T08:59:25.221Z	raphael-proust	2020-05-20T08:59:25.251Z			master	philb@test_remove_sandbox_option	bidinger	9487506	3836952	8d281fc0dacac0866595c5577ed1fbad1cbdd671			9	17	86	69	9
tezos/tezos	58015424	1812	3836952	Node: add -d as a short-hand of --data-dir	"`--data-dir` is probably one of the most used command-line options if you
have more than one data-directory or if you're not using the default one,
especially with the multinetwork node.
So I believe it is worth it to have a short-hand for it: `-d`."	merged	2020-05-07T13:32:44.044Z	2020-05-07T16:46:40.108Z	vbotbol	2020-05-07T16:46:40.140Z			master	romain-datadir	romain.nl	9487506	3836952	1f030c40d22fdde4faae3316fc468a10e0af268c			1	3	4	1	1
tezos/tezos	58330742	1816	3836952	WIP: Tests/python: fix multi-branch tests	"The multi-branch tests are broken. This happened because they don't run on the CI and the test API tends to follow the interface of the Tezos tools as they appear on master (which may be incompatible with older revisions).

This MR fixes them and updates the doc. In particular,
* `test_voting_full.py` has been removed. It can now been run on `master` and has been moved to !1373 
* `test_baker_endorser_mb.py` uses more recent revisions, compatible with the current API

TODO:
- make them run on the CI so that they don't deprecate again
- consolidate the API by implementing more tests (e.g. storage upgrade, signer)
- `build_branch.py` should copy the protocol parameters in `$TEZOS_BINARIES` for each protocol along with the executables

Test this MR (see updated doc):

```
TEZOS_HOME=~/tezos
TEZOS_BINARIES=~/tmp/tezos_binaries
TEZOS_BUILD=~/tmp/tezos_build
mkdir -p $TEZOS_BINARIES
mkdir -p $TEZOS_BUILD
scripts/build_branches.py --clone $TEZOS_HOME --build-dir $TEZOS_BUILD \
            --bin-dir $TEZOS_BINARIES \
            c0d5a0e73f56c80491ca3bb73968768a83bb2346 \
            42968139bbc20e6047bbcec8f99964f201250ed1
pytest -sv tests/multibranch/test_baker_endorser_mb.py
```"	closed	2020-05-11T22:09:25.622Z	2020-07-17T09:54:48.016Z			bidinger	2020-07-17T09:54:47.916Z	master	philb@fix_multibranch	bidinger	9487506	3836952	08f70fd8279341889a6426583ec1ec65220c976b			4	52	339	287	4
tezos/tezos	58001528	1809	3836952	WIP: Restore failing non-deterministic P2P tests	The failing tests were apparently an issue related to ports being used at the same time during CI. This MR bumps the range of ports used and resolve this issue for the moment but this should be addressed further by establishing dependencies to port usages throughout the whole test suite (perhaps in the .gitlab-ci.yml ?).	opened	2020-05-07T11:39:20.430Z	2020-06-08T11:27:37.898Z					master	vbot@fix_test_p2p	vbotbol	9487506	3836952	6f6cb498f436f48137a756aac4bc6dc900069c13			2	2	5	3	2
tezos/tezos	58010952	1810	3836952	Makefile: only list protocols with a TEZOS_PROTOCOL file	"If a protocol is deleted or moved, its `src/proto_XXX` directory
will probably remain when switching branch because of leftover files
which are ignored by Git. This is particularly annoying for users
which just want to `git pull && make`, as they face an error
`No rule to make target 'src/proto_plop/lib_protocol/TEZOS_PROTOCOL`.

This patch modifies the Makefile to only try to build protocols for which
there is actually a `TEZOS_PROTOCOL` file, instead of all `proto_*` folders."	merged	2020-05-07T12:54:39.973Z	2020-05-07T14:18:29.768Z	pirbo	2020-05-07T14:18:29.802Z			master	romain-makefile	romain.nl	9487506	3836952	253a3e3b583ac9d34cce8d700467a07611d90854			1	4	5	1	1
tezos/tezos	57997082	1808	3836952	docs-html: fix fonts in shpinx css	"This MR fix https://gitlab.com/tezos/tezos/-/issues/793

And change the aspect of few elements.

![Screenshot_2020-05-07_12-52-56](/uploads/6765de8747eb6b6a58ad613d9c325542/Screenshot_2020-05-07_12-52-56.png)"	merged	2020-05-07T10:53:33.424Z	2020-05-11T22:43:26.780Z	pirbo	2020-05-11T22:43:26.957Z			master	abate@sphinx-css	abate	9487506	3836952	182ae7aa090cd9544baaba868b7d859c87f7e458			2	343	343	0	2
tezos/tezos	58019655	1813	3836952	Tests: update pytest-regtest to a version generating shorter pathnames for log files	"Depends on 
 - https://gitlab.com/nomadic-labs/pytest-regtest/-/merge_requests/2
 - https://gitlab.com/tezos/opam-repository/-/merge_requests/81

This MR updates our version of pytest-regtest to a version that generates shorter regression log filenames (max 140 chars as opposed to 255 earlier). Hopefully, this fixes issues where users were unable to check out the repo due to too long file names.

I also introduce the following changes:
 - automatically add regression marker: I've modified conftest.py so that the `regression` marker is added automatically to all tests that use the regtest fixture. This eliminates fear and doubt that someone forgot to add that marker.
 - remove stale regression files: I found a bunch of regression files that did not seem to correspond to any tests, that I removed"	merged	2020-05-07T14:12:32.110Z	2020-05-07T22:12:06.558Z	pirbo	2020-05-07T22:07:12.045Z			master	arvid@pytest_regtest_shorter_paths	arvidnl	9487506	3836952	62860d3216d22a3055aeb5ebbe2734ae6516ccb3			229	14	19927	19913	229
tezos/tezos	58027274	1814	3836952	Port to the Alcotest 1.0+ API	"This ports uses of the `0.x` Alcotest API to use the newer `1.x` API.

The breaking change is that `Alcotest_lwt` test cases can no longer be nested inside `Alcotest.run` and must use `Alcotest_lwt.run` instead (which returns a promise).

The corresponding PR in `opam-repository` is https://gitlab.com/tezos/opam-repository/-/merge_requests/82."	merged	2020-05-07T15:24:47.232Z	2020-05-13T09:56:41.540Z	pirbo	2020-05-13T09:56:41.576Z			master	upgrade-alcotest-1.1.0	CraigFe	18643592	3836952	f568a415690e962e5cf7a1569bfae020669a0946			37	138	234	96	37
tezos/tezos	58032677	1815	3836952	CI: harmonize linting targets between CI and Makefile	"Previously, OCaml code was also verified in check_python_linting.
Also, check_linting was not executing dune build @runtest-lint
    
Harmonising the Makefile and the CI targets help local development

## How to test
```
gitlab-runner exec docker check_python_linting
gitlab-runner exec docker check_linting
```
You can introduce a syntax error in OCaml to verify it does only check python syntax and vice-versa for python."	merged	2020-05-07T16:25:44.127Z	2020-05-23T07:46:57.360Z	pirbo	2020-05-23T07:46:57.387Z			master	dannywillems@ci-check-python-lint	dannywillems	9487506	3836952	c7126f88f9964c482c14bd95b26c6b3e6af77dea			2	11	19	8	2
tezos/tezos	57813670	1803	3836952	Tests/P2P: skip a non-deterministic test	"This test fails most of the time in the CI but seems hard to reproduce locally so debugging it seems time consuming.

Of course if anyone knows how to fix the test instead of skipping it I will close this MR."	merged	2020-05-05T20:31:44.784Z	2020-05-06T10:18:39.159Z	romain.nl	2020-05-06T10:18:39.186Z			master	rafoo@skip_unit_p2p_test	rafoo_	9487506	3836952	678571873fe4846dda8a920b26aecc484564d94e			1	2	3	1	1
tezos/tezos	57768880	1802	3836952	Update documentation for next release (7.0)	"DO NOT MERGE (yet)

This will be merged once the 7.0 has been released. Once 7.0 is merged, it is no longer a release candidate, so 7.0 becomes the version that users should actually build and use. We update the documentation to reflect that. Because we are switching from a `mainnet`-branch-based release to a multinetwork-based release with version numbers, many details need to be upgraded in ""how to get"" and ""how to use"" sections especially. The changelog (`CHANGES.md` and the release doc page) is also updated with new changes from 7.0~rc1 to 7.0."	merged	2020-05-05T13:09:24.720Z	2020-05-06T13:21:45.706Z	pirbo	2020-05-06T13:21:45.737Z			master	romain-v7-doc	romain.nl	9487506	3836952	8565e392d637b00bb9a041ebb3149298fa4dfe56			13	89	143	54	13
tezos/tezos	57690354	1801	3836952	Doc: TEZOS_CONTEXT -> TEZOS_PROTOCOL		merged	2020-05-04T19:21:47.625Z	2020-05-07T09:52:02.896Z	klakplok	2020-05-07T09:52:03.505Z			master	patch-1	dannywillems	7148137	3836952	b716ffa5629ec5062b45dfb037f759d3db5d0fa8			1	1	2	1	1
tezos/tezos	58565618	1822	3836952	Prepare python tests framework for store rehaul	"This MR aims to add some features to the python test framework to get it ready for the introduction of the new storage backend.

Here are the features:
- Run a node with a given path to a data directory,
- Get a block header by its level,
- Add RPCs to be able to request checkpoint, savepoint ant caboose.

As the new storage backend is not yet available, there is currently not test using those features."	merged	2020-05-13T15:43:44.118Z	2020-05-15T12:38:08.691Z	arvidnl	2020-05-15T12:38:08.722Z			master	vicall@python_for_store_rehaul	vect0r	9487506	3836952	00edabcfafa6cd9c68d34e0ed29a1f8ff5d1afd3			4	37	49	12	4
tezos/tezos	57980575	1807	3836952	Update documentation for 7.0 release	"Users are having troubles with the new release:
- some are confused by the new versioning scheme and ask whether 7.0 is stable even though it's not in the `mainnet` branch;
- some are having issues with remote signing (remote signers need to be updated too);
- some are having trouble to compile opam packages (we need the `--silent` flag which was added in opam 2.0.1);
- some are having an error because of leftover files.

This merge request updates the release notes to help users regarding those issues."	merged	2020-05-07T09:03:42.184Z	2020-05-07T10:35:06.554Z	adrianbrink	2020-05-07T10:35:06.579Z			master	romain-v7-doc	romain.nl	9487506	3836952	975e744c8b2acfc92bb89f348cad4253fcbcca2c			1	42	42	0	1
tezos/tezos	57641107	1800	3836952	Mockup client: Add user documentation	"Meta-issue: https://gitlab.com/nomadic-labs/tezos/-/issues/111

Issue: https://gitlab.com/nomadic-labs/tezos/-/issues/148

This MR adds user documentation for the mockup mode (whose developer documentation is [here]( https://gitlab.com/nomadic-labs/tezos/-/issues/111) and [here](https://gitlab.com/tezos/tezos/-/merge_requests/1499)).

This documentation contains things that are not yet in this branch (for example `config show mockup` and `--bootstrap-accounts`) but @igarnier and the Tweag guys (namely @richard.bonichon and @smelc) decided nevertheless to request merging this one before; because we need the documentation to be merged to be able to update it more easily when we add new features.

In other words, merging this MR will allow us to pack documentation within later MRs. This seems harmless as this documentation won't become public before release 8.0 and at this point the features not in this branch will have made it to `master` too."	merged	2020-05-04T13:04:30.616Z	2020-05-27T12:00:39.919Z	klakplok	2020-05-11T13:32:48.448Z			master	smelc-issue-111-doc	smelc	18024911	3836952	1ad8d3082184e00f12ea965740f2d1091c7748d4			2	155	155	0	2
tezos/tezos	57891326	1805	3836952	lwt_log_sin_unix: Add milliseconds in event messages	"The format for the date for all the events now also include
milliseconds.

# Context

We would like to have a trace of the messages received and sent by the node, in particular the `distrubted_db` messages. From the current event format, this is complicated to draw such diagram when several nodes are involved because the granularity of the current timestamp format is the second. By adding milliseconds, it would be easier to reconstruct such trace by post-processing the events for example.

#How to test this MR

Just run `tezos-node run` and check that the new logging message now prints
`May  6 15:05:41.390 - ...`

# Open questions

- Should we print `milliseconds` for all the events?"	merged	2020-05-06T13:14:09.746Z	2020-05-12T20:47:02.514Z	klakplok	2020-05-12T20:47:02.553Z			master	francois@log-milliseconds	Saroupille	9487506	3836952	6f2b6a9aa62f8d369b72f80a02e6e3228edad6da		6f2b6a9aa62f8d369b72f80a02e6e3228edad6da	1	1	2	1	1
tezos/tezos	57216033	1793	3836952	Opam refresh		merged	2020-04-28T20:54:16.004Z	2020-04-28T21:44:01.441Z	pirbo	2020-04-28T21:44:01.561Z			master	opam-refresh	pirbo	9487506	3836952	d478a3338e0f785a457ef60775efc56c52ca6add			8	11	20	9	8
tezos/tezos	57421485	1798	3836952	CI: remove constraint to run on 'gitlab-org' runners	"Motivation:
The tag ""nomadic-labs"" was a mistake, it has to be removed in order to allow others to run a CI without having to provide their own private runner that they would tag ""nomadic-labs""!

We imposed all jobs but the build of docker images to run on ""gitlab-org"" tagged runners in order to reserve our private ""safe_docker"" runner for the build of docker images but 1/ there is an option in gitlab settings to say ""only run jobs on this runner that require a tag from this runner"" so we could achieve that this way and 2/ it is actually OK to give a try to allowing other jobs to run on that machine"	merged	2020-04-30T17:07:13.368Z	2020-05-04T09:59:46.549Z	pirbo	2020-05-04T09:59:46.577Z			master	gitlab-runner-relaxed	pirbo	9487506	3836952	6a496bb9f1c2f2d963426fe525a0cdb9c1ef77ea			1	0	13	13	1
tezos/tezos	57297588	1796	3836952	Opam: fix tezos-version dependencies	!1489 modified some dependencies in `dune` files but not in the corresponding `.opam` files. This fixes that.	merged	2020-04-29T14:12:26.083Z	2020-04-29T15:03:05.900Z	pirbo	2020-04-29T14:55:50.771Z			master	romain-version-opam	romain.nl	9487506	3836952	a441ea650d1f9c01311f11131f982ae41321e9c8			2	2	2	0	2
tezos/tezos	57415018	1797	3836952	Remove deprecated rpc from client	"This simple MR aims to remove the use of a deprecated RPC in the client. 

`Shell_services.P2p.version` was removed in favour of `Version_services.version`."	merged	2020-04-30T15:45:29.075Z	2020-05-05T09:32:02.624Z	pirbo	2020-05-05T09:32:02.652Z			master	rm_deprecated_rpcs	vect0r	9487506	3836952	764ce8e0725c1849fff82373e2ebcc88d1dc733c			2	5	8	3	2
tezos/tezos	57640899	1799	3836952	Documentation: sandbox mode issue 763	This solves #763.	merged	2020-05-04T13:02:20.360Z	2020-06-10T06:34:18.701Z	adrianbrink	2020-06-09T07:38:30.109Z			master	eugenz_doc_sandbox_mode_issue_763	eugenz	9487506	3836952	ab96433e6d79e90cdad396805025890cea96e165			2	6	7	1	2
tezos/tezos	57274456	1794	3836952	Tests/python: silence mypy errors	"`mypy 0.770` detect new errors. 

In particular, it doesn't infer correctly the type of `subprocess.Popen.__init__`. 
```
 subprocess.Popen.__init__(self, cmd, stdout=stdout, stderr=stderr)
```

By lack of a better solution, I silenced the warning."	merged	2020-04-29T11:28:31.493Z	2020-04-29T15:25:49.491Z	pirbo	2020-04-29T15:25:49.527Z			master	philb@fix_mypyp	bidinger	9487506	3836952	5c06fd48dcb5d51b9ed1f419ad8ca614e813b59f			6	14	24	10	6
tezos/tezos	57296106	1795	3836952	Node: built-in activator key for --network sandbox	"This MR proposes to have the `sandbox` built-in network override the genesis public key with the one which is used by the sandbox shell scripts and Python tests. The private key is already stored in the repository in `src/bin_client/tezos-init-sandboxed-client.sh` and `tests_python/tools/constants.py`.

This MR would make it easier than ever to start a sandbox node without having to use either the sandbox shell scripts or `--sandbox` (both of which imply many other features that you may not need or want). Indeed, all you have to do to activate, say, Carthage in a new sandbox is:
```
./tezos-node config init --data-dir ~/tezos-sandbox --network sandbox --no-bootstrap-peer --private --bootstrap-threshold 0 --expected-pow 0 --rpc-addr localhost:8732
./tezos-node identity generate --data-dir ~/tezos-sandbox
./tezos-node run --data-dir ~/tezos-sandbox
./tezos-client activate protocol PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb with fitness 1 and key unencrypted:edsk31vznjHSSpGExDMHYASz45VZqXN4DPxvsa4hAyY8dHM28cZzp6 and parameters src/proto_006_PsCARTHA/parameters/sandbox-parameters.json
```

After this, one could possibly have `--sandbox` be a short-hand for something like `--network sandbox --no-bootstrap-peer --private --bootstrap-threshold 0 --expected-pow 0` or a subset of those. And one could simplify the sandbox shell scripts, as well as the tests, since they would at least no longer need to store the private activation key."	merged	2020-04-29T13:59:50.858Z	2020-05-11T13:43:59.374Z	klakplok	2020-05-11T13:43:59.558Z			master	romain-sandbox-key	romain.nl	9487506	3836952	ea08cafd9eb884aafe98c82969ee3fc770c6615b			1	11	11	0	1
tezos/tezos	57917525	1806	3836952	Doc: MR testing/coding guidelines	"A small addition in the doc of the MR guidelines.

Just to emphasize that tests are expected and should adhere to simple convention.

Also try to clarify the use of TODO in the code (currently they are detected by merbocop which introduce confusion on whether or not they are allowed)."	merged	2020-05-06T16:13:02.047Z	2020-06-08T11:26:25.742Z	romain.nl	2020-05-11T14:31:29.835Z			master	philb@testing_guidelines	bidinger	9487506	3836952	1c4709db152f9e2ae9be04f9c243ae7786fe097e			2	17	17	0	2
tezos/tezos	56932727	1786	3836952	minor refactoring. use Lwt_utils_unix.create_file in procol_compiler		closed	2020-04-25T21:30:26.479Z	2020-05-20T14:19:52.490Z			raphael-proust	2020-05-20T14:19:52.504Z	master	abate@minor-refacoring	abate	9487506	3836952	3a9fd930bcb935a8bff58288f6864e0610c91cd2			2	12	27	15	2
tezos/tezos	57017341	1788	3836952	Wait for node response before asking protocol upgrades	The baker should wait being bootstrapped to ask for protocol upgrades as the retry mechanism (e.g. if the node is not yet operational) is in the `await_bootstrapped_node` function. Without this patch, the node that has not yet started its RPC server will result in the baker crashing.  	merged	2020-04-27T10:40:01.488Z	2020-04-28T14:13:37.329Z	pirbo	2020-04-28T14:13:37.376Z			master	vbot@baking_wait	vbotbol	9487506	3836952	a1791b9142bdbca8365406157f5401bfbc350fc1			2	4	8	4	2
tezos/tezos	57040327	1789	3836952	Protos: avoid double-naming big_map_diff encoding	"Fix 782

For existing protocols, we change the `lib_client` code, but for alpha
we change the `lib_protocol` code because that makes more sense here."	merged	2020-04-27T14:16:15.450Z	2020-05-06T09:55:59.159Z	pirbo	2020-05-06T09:55:59.183Z			master	raphael-and-francois@fix-782	raphael-proust	9487506	3836952	41533fcddc3292fc53d4faf55c51428d79133d2b			3	3	12	9	3
tezos/tezos	57203666	1792	3836952	Doc: Fix typos and grammar in snapshot docs		closed	2020-04-28T18:17:29.322Z	2020-04-28T22:57:45.616Z			jevonearth	2020-04-28T22:57:45.627Z	master	snapshots_doc_fix	jevonearth	4642912	3836952	aa71d99264cf5dc86d7d87cc7608c6b0b4e15d91			1	27	52	25	1
tezos/tezos	59210883	1835	3836952	Tests/CI: Add test for protocol-compiler rejections	"This MR is a follow-up for
<https://gitlab.com/tezos/tezos/merge_requests/1500>

It adds a new quick test that the compiler expectedly rejects the misuses that
the above MR prevents.

- Using an
  `external` (deep inside a `let module M = struct ... end` in an expression).
- A protocol that tries to escape *The Functor*.


Recommended reviewers: @mbouaziz & @klakplok


![screenshot-20200520-101533](/uploads/8fea9837676f95c10a7910330f41a4e5/screenshot-20200520-101533.png)"	merged	2020-05-20T14:19:14.173Z	2020-06-22T14:43:27.470Z	adrianbrink	2020-06-22T14:43:27.504Z			master	smondet-test-improvements-in-protocol-compiler	smondet	9385204	3836952	1b91c9339204f812e48ef7bae38cf7ee342d69b2			4	131	132	1	4
tezos/tezos	56819165	1784	3836952	Update resto dependency	"Depends on https://gitlab.com/tezos/opam-repository/-/merge_requests/76
"	closed	2020-04-24T08:56:57.143Z	2020-04-28T22:07:38.467Z			pirbo	2020-04-28T22:07:38.476Z	master	raphael@update-resto--opam	raphael-proust	9487506	3836952	d53eed9d0b9b82272407fae0d75c6b66ebc92c13			6	11	22	11	6
tezos/tezos	56782211	1781	3836952	Mockup: open parameters in dune to help script/activate_protocol.sh	"In general it should be avoided using protocol modules named *alpha* in the code and just open them from dune files.
This helps with the workflow of ./scripts/snapshot_alpha.sh and ./scripts/activate_protocol.sh because they don't need to edit code but only opam and dune files."	merged	2020-04-23T20:51:58.270Z	2020-04-24T09:24:55.024Z	pirbo	2020-04-24T09:24:55.106Z			master	marco-master-mockup	paracetamolo	9487506	3836952	85c0a9c629adfd2a29dfe041af97ba172def2a98			2	1	3	2	2
tezos/tezos	60406675	1858	3836952	"Doc: Add ""Install via opam"" to ""How to get"""	"Would close #807

I hope but think information is here but I suspect tone to be a bit too informal and advice for troubleshooting, while I consider them useful, to pollute the point.
"	merged	2020-06-02T17:44:19.212Z	2020-06-09T15:17:57.803Z	rafoo_	2020-06-09T15:17:58.884Z			master	doc_opam_install_tezos	pirbo	9487506	3836952	e1d00bccfa9c9917068b2c3e1b815e1fb8f27c05			1	151	212	61	1
tezos/tezos	56596422	1778	3836952	Docs: fix links	Fixes a few errors returned when running `linkcheck` to build the documentation.	merged	2020-04-22T16:41:24.899Z	2020-04-22T21:12:14.731Z	pirbo	2020-04-22T21:12:14.759Z			master	bb@doc-fix-links	onurb	9487506	3836952	0ae67a421c3a2472b0b0661406efbf2616ed3ab5			4	5	8	3	4
tezos/tezos	56728814	1780	3836952	Marc@old mr	Old stuff from the nomadic remote	closed	2020-04-23T14:43:55.180Z	2020-04-23T14:44:06.654Z			MarcBeunardeau	2020-04-23T14:44:06.673Z	master	marc@old-mr	MarcBeunardeau	11412215	3836952	83392e778a24c7e28537c2bfbcb608430ea339b8			522+	32165	42916	10751	620
tezos/tezos	56606957	1779	3836952	Sandbox client init: parameter to change the host	Useful when the node is not running on the same machine.	merged	2020-04-22T17:42:44.156Z	2020-04-30T11:40:57.601Z	klakplok	2020-04-30T11:40:57.628Z			master	dannywillems@init-sandbox-script-add-host-param	dannywillems	9487506	3836952	c08a78295660e83827393c013c5ed64821bdd41c			1	8	17	9	1
tezos/tezos	61485496	1898	3836952	P2p/logging: remove legacy logging from p2p_protocol	"
As the ongoing effort to remove the legacy logging, this MR clean up the p2p_protocol module."	merged	2020-06-15T09:49:52.787Z	2020-06-30T12:11:57.778Z	arvidnl	2020-06-30T12:11:57.812Z			master	abate@p2p_logs_part2	abate	9487506	3836952	2e52649e67bb4180e2cbbdfd4ece3d07ea7937f1			7	437	753	316	7
tezos/tezos	59829316	1849	3836952	"Add ""multiple transfers"" command to client"	"This MR adds a new command to the client that allows multiple transfers to be passed through the client at once, and treated atomically.

The command in question is
`tezos-client multiple transfers from <src> using <transfers.json>`
where `<src>` is the source contract, and `<transfers.json>` is a list of transfers that needs to be treated, in JSON format, either inlined or in a file. The JSON syntax is described in the client doc.

Reviewers: @vbotbol @vect0r @romain.nl 

Fixes #279"	merged	2020-05-27T15:48:30.113Z	2020-09-09T16:45:04.636Z	pirbo	2020-09-09T16:45:04.970Z			master	lrand@client-batch	lrand	9487506	3836952	9849a268cbb2c257ea3a40588afce4d632bde9e0			13	800	952	152	13
tezos/tezos	56594568	1777	3836952	Shell: remove dead-code from upcoming mempool	Some code from the upcoming mempool was merged into `master`. This code is now actually outdated in the new mempool. This code does not belong anywhere. This MR removes it.	merged	2020-04-22T16:23:45.178Z	2020-04-28T17:44:11.408Z	pirbo	2020-04-28T17:44:11.533Z			master	raphael@clean-up-before-mempool	raphael-proust	9487506	3836952	39546b26d0dfe4c9493ef740890e12730658f17a			4	0	1297	1297	4
tezos/tezos	56417640	1774	3836952	ci: add nomadic-labs tag		merged	2020-04-21T14:40:34.147Z	2020-04-22T20:53:03.636Z	pirbo	2020-04-22T20:53:03.664Z			master	abate-gitlab-tag	abate	9487506	3836952	c956b3d7deb0bb682dab37f8d3689ef8a92b307b			1	1	1	0	1
tezos/tezos	56488633	1776	3836952	Expose `unparse_code` in script_ir_translator.mli	"This just exposes unparse_code in the .mli, for convenience.

This function is called when unparsing lambdas, ie converting from the typed IR to Micheline. It has a distinct performance profile and must be benched separately from unparse_data."	closed	2020-04-22T07:06:47.325Z	2020-04-22T07:10:42.109Z			igarnier	2020-04-22T07:09:07.059Z	master	igarnier@expose_unparse_code	igarnier	11412215	3836952	b0febddc6331808137c88e120f47fa8b1ef07048			560	19530	35651	16121	561
tezos/tezos	56375201	1773	3836952	WIP: lib_p2p: caping the number of opened connections to max_connections	"Registration of pending (outgoing) connections in order to cap the
total number of opened connections."	opened	2020-04-21T08:56:19.484Z	2020-06-15T13:56:06.680Z					master	zay@p2p_max_outgoing_connections	ZaynahDargaye	9487506	3836952	cb1199bdb32b3a27d66e712b9f8c0a0c33c43239			4	70	78	8	4
tezos/tezos	56374125	1772	3836952	Vendors/lmdb tests: Replace /tmp by Filename.get_temp_dir	TravisCI (of ocaml/opam-repository) on MacOS dislikes hardwired use of /tmp	merged	2020-04-21T08:45:02.610Z	2020-04-24T08:30:38.725Z	pirbo	2020-04-24T08:30:38.826Z			master	lmdb_test_travis	pirbo	9487506	3836952	98ad69fd5d9058780b34d72402187003c1276f8e			1	13	21	8	1
tezos/tezos	56251099	1771	3836952	WIP: environment_V0: Fix duplicate encodings issue	"Some encodings from different protocols are registered with the
same name while they are different. This patch prefixes the name
of the encoding with the name of the protocol.


# How to test this MR

On master, the command `tezos-client rpc get /errors` is broken. With this patch, you can check that the list of errors is printed.

# Known issue

Adding back the protocol `004` makes the command `tezos-codec dump encodings` fails with another error

The error vanishes if one change the `json-data-encoding` file `json_schenla.ml` with the following patch:

```
@@ -480,10 +486,15 @@ let insert_definition name elt defs =
       def :: insert rem
     | (_, { kind = Dummy }) :: rem ->
       (name, elt) :: rem
-    | (_, defelt) :: rem ->
-      if not (eq_element elt defelt) then
-        raise (Duplicate_definition (name, elt, defelt)) ;
-      (name, elt) :: rem in
+    | (defpath, defelt) :: rem ->
+      match elt.kind with
+      | Def_ref path when defpath = path -> rem
+      | _ ->
+        if not (eq_element elt defelt) then
+          raise (Duplicate_definition (name, elt, defelt))
+        else
+          (name, elt) :: rem
+ in
```

It is not clear whether this patch is the one intended. The issue is that in `proto_*/lib_client/alpha_client_context.ml` we defined encodings which are already defined in `proto_*/lib_protocol/`. All these encodings are registered. However, the current behavior of `json-data-encoding` is to say that defining a new encoding and defining the definition of this encodings are two different encodings, hence they should not have the same name in the current version of `data_encoding`."	closed	2020-04-20T11:39:36.271Z	2020-04-27T14:18:57.704Z			raphael-proust	2020-04-27T14:18:57.825Z	master	francois@fix-duplicate-encodings	Saroupille	9487506	3836952	dcb84b6b533b41785d70cbf40c9d7042bb38a787			5	11	26	15	5
tezos/tezos	56112509	1768	3836952	Sapling: add test for wallet (gen key and import key)		closed	2020-04-17T20:08:28.560Z	2020-04-17T20:08:37.296Z			dannywillems	2020-04-17T20:08:37.317Z	master	dannywillems-sapling@python-add-test-wallet	dannywillems	11412215	3836952	a4e11893a831f0be40b50ed4232a74ac96277d0c			523+	31494	42246	10752	620
tezos/tezos	57012298	1787	3836952	Mockup client: print back/export mockup parameters	"meta issue: nomadic-labs/tezos#111 

issue: nomadic-labs/tezos#138

branch: https://gitlab.com/smelc/tezos/-/commits/smelc-issue-111-easybits

This MR cannot be merged earlier than tezos/tezos!1720 (i.e. merge tezos/tezos!1720 first).

When creating a mockup, we can specify some protocol parameters and some initial list of bootstrap accounts as .json files. This MR adds the possibility to:
* [X] print back protocol constants and bootstrap accounts at mockup creation
* [X] add a command to defaults of `--boostrap-accounts` and `--protocol-constants`: **config show mockup**
* [X] add a command to export defaults to files (allowing easy customization by the user). Done by adding the command **config init mockup [--bootstrap-accounts <path>] [--protocol-constants <path>]**
* [X] add tests (will require merging after tezos/tezos!1746)
  * [X] Test executing `config show mockup`
  * [X] Test executing `config init mockup`
  * [X] Test that files created with `config show/init mockup` can be successfully passed to `create mockup`'s flags `--bootstrap-accounts` and `--protocol-constants`. I went down the full road and tested the full test matrix (either using `show` or `init` to get the mockup's state and using custom bootstrap accounts or not at `create mockup`).

Here is an execution of `config show mockup`:

```shell
> ./tezos-client -M mockup config show mockup # -M mockup avoids a warning
[ { ""name"": ""bootstrap5"",
    ""sk_uri"":
      ""unencrypted:edsk4QLrcijEffxV31gGdN2HU7UpyJjA8drFoNcmnB28n89YjPNRFm"",
    ""amount"": ""4000000000000"" },
  { ""name"": ""bootstrap4"",
    ""sk_uri"":
      ""unencrypted:edsk2uqQB9AY4FvioK2YMdfmyMrer5R8mGFyuaLLFfSRo8EoyNdht3"",
    ""amount"": ""4000000000000"" },
  { ""name"": ""bootstrap3"",
    ""sk_uri"":
      ""unencrypted:edsk4ArLQgBTLWG5FJmnGnT689VKoqhXwmDPBuGx3z4cvwU9MmrPZZ"",
    ""amount"": ""4000000000000"" },
  { ""name"": ""bootstrap2"",
    ""sk_uri"":
      ""unencrypted:edsk39qAm1fiMjgmPkw1EgQYkMzkJezLNewd7PLNHTkr6w9XA2zdfo"",
    ""amount"": ""4000000000000"" },
  { ""name"": ""bootstrap1"",
    ""sk_uri"":
      ""unencrypted:edsk3gUfUPyBSfrS9CCgmCiQsTCHGkviBDusMxDJstFtojtc1zcpsh"",
    ""amount"": ""4000000000000"" } ]
Default value of --protocol-constants:
{ ""hard_gas_limit_per_operation"": ""1040000"",
  ""hard_gas_limit_per_block"": ""10400000"",
  ""hard_storage_limit_per_operation"": ""60000"", ""cost_per_byte"": ""1000"" }
```

Here is an execution of `config init mockup`:

```shell
> ./tezos-client -M mockup config init mockup --protocol-constants /tmp/consts.json --bootstrap-accounts /tmp/boot.json
Written default --bootstrap-accounts file: /tmp/boot.json
Written default --protocol-constants file: /tmp/consts.json
```

Here are the files that have been created:

```shell
> cat ~/.tezos-client/{bootstrap-accounts,protocol-constants}.json
[ { ""name"": ""bootstrap5"",
    ""sk_uri"":
      ""unencrypted:edsk4QLrcijEffxV31gGdN2HU7UpyJjA8drFoNcmnB28n89YjPNRFm"",
    ""amount"": ""4000000000000"" },
  { ""name"": ""bootstrap4"",
    ""sk_uri"":
      ""unencrypted:edsk2uqQB9AY4FvioK2YMdfmyMrer5R8mGFyuaLLFfSRo8EoyNdht3"",
    ""amount"": ""4000000000000"" },
  { ""name"": ""bootstrap3"",
    ""sk_uri"":
      ""unencrypted:edsk4ArLQgBTLWG5FJmnGnT689VKoqhXwmDPBuGx3z4cvwU9MmrPZZ"",
    ""amount"": ""4000000000000"" },
  { ""name"": ""bootstrap2"",
    ""sk_uri"":
      ""unencrypted:edsk39qAm1fiMjgmPkw1EgQYkMzkJezLNewd7PLNHTkr6w9XA2zdfo"",
    ""amount"": ""4000000000000"" },
  { ""name"": ""bootstrap1"",
    ""sk_uri"":
      ""unencrypted:edsk3gUfUPyBSfrS9CCgmCiQsTCHGkviBDusMxDJstFtojtc1zcpsh"",
    ""amount"": ""4000000000000"" } ]{ ""hard_gas_limit_per_operation"": ""1040000"",
  ""hard_gas_limit_per_block"": ""10400000"",
  ""hard_storage_limit_per_operation"": ""60000"", ""cost_per_byte"": ""1000"" }
```

Reexecuting it a second time yields:

```
> ./tezos-client --mode mockup config init mockup --protocol-constants /tmp/consts.json --bootstrap-accounts /tmp/boot.json
Error:
  Config file to write value of --bootstrap-accounts exists already: /tmp/boot.json
```"	merged	2020-04-27T10:00:07.879Z	2020-06-12T13:00:56.961Z	pirbo	2020-06-12T13:00:56.996Z			master	smelc-issue-111-easybits	smelc	18024911	3836952	5907d19efc61b5cf36039755a956909c1ff7c9be			13	838	974	136	13
tezos/tezos	56112202	1767	3836952	Test python: remember contract	"Fix #773.

I splitted in two commits because I am not sure the tests are going to be accepted in the MR, and I need the remember_contract method to write sapling tests (I cherry-picked it to avoid conflicts while rebasing later). I suppose the first one `38e44578b31cfa0d03e1ad8871921c56115342ef` is going to be accepted."	merged	2020-04-17T20:03:30.451Z	2020-04-20T15:16:47.449Z	paracetamolo	2020-04-20T15:16:47.675Z			master	dannywillems@test-python-remember-contract	dannywillems	9487506	3836952	0675d7e01f1c04969dea2f1deebc87f733540a9d			2	70	70	0	2
tezos/tezos	56245604	1769	3836952	Stdlib: use external Ringo instead of LRU/Ring/WeakRingTable	"This MR replaces the Stdlib modules `Lru_cache`, `Ring`, and `WeakRingTable` by the external dependency `Ringo`. That new dependency is composed mostly of the removed code with a more generic interface and many more tests.

NOTE to the merger:

- This MR needs to be merged first https://gitlab.com/tezos/opam-repository/-/merge_requests/86
- There is a branch with an opam suffix: https://gitlab.com/nomadic-labs/tezos/-/tree/raphael@with-ringo--opam"	merged	2020-04-20T10:43:05.453Z	2020-06-08T17:08:39.763Z	pirbo	2020-06-08T17:08:39.967Z			master	raphael@with-ringo	raphael-proust	9487506	3836952	d1e8efa067282b5d1169f606f04c9c1aec9cb58d			29	115	1568	1453	29
tezos/tezos	56096835	1764	3836952	event_logging: strip withespace when sanitize		closed	2020-04-17T16:32:37.880Z	2020-05-15T14:14:24.624Z			abate	2020-05-11T14:00:04.839Z	master	abate@minor_log_fix	abate	9487506	3836952	5ad0c33c985170caa27eb55e1168b533edfd0b4f			1	5	6	1	1
tezos/tezos	56100843	1766	3836952	Test: extract client instanciation in sandbox	"For the moment, only one client is used in the different tests, through sandbox.client(0). For a given node, only this client is used, including its state (saved keys, known addresses, etc). It may be interesting to allow instantiating a new client for a given node for scenari requiring clients with different states.

We may also want to always use the same node, but different clients (imagine a client A originates a contract on the node N, and you want to test the client feature remembering the contract => you may want to use a client B)."	merged	2020-04-17T17:36:49.168Z	2020-05-07T11:03:44.317Z	pirbo	2020-05-07T11:03:44.354Z			master	dannywillems@test-refacto-client-instance-creation	dannywillems	9487506	3836952	75c05dc7830128dca46b0b26eabf34a026f2ff75			1	40	49	9	1
tezos/tezos	56834463	1785	3836952	Remove legacy logging from p2p	It would be nice to convert all the modules. But it's very time consuming, so this first batch could also be merged now, followed by a second batch in a different MR.	merged	2020-04-24T11:00:47.979Z	2020-06-23T11:58:05.963Z	romain.nl	2020-05-11T15:06:48.825Z			master	abate@p2p-legacy	abate	9487506	3836952	373f869ba13e36c3cc9cbc0385da271f387dac70			9	409	611	202	9
tezos/tezos	56087017	1760	3836952	UX/mockup: signals incompatibility between mode and base directory type	"MR dependency: !1720 !1746 (tests)

Initially this fixes reported UX issues. 

For example, when forgetting to specify the mockup directory.

```
./tezos-client -M mockup transfer 1 from bootstrap1 to bootstrap2 
Node is bootstrapped, ready for injecting operations.
Estimated gas: 10207 units (will add 100 for safety)
Estimated storage: no bytes added
Cannot parse operation.
Fatal error:
  transfer simulation failed
```

The transfer command should not even be attempted when the directory (here the default base directory, aka `~/.tezos-client`) is *not* in the correct mode.

A related glitch is 
```
/tezos-client -M mockup transfer 1 from bootstrap1 to bootstrap2
Error:
  Erroneous command line argument 4 (bootstrap1).
  no contract or key named bootstrap1
  bad contract notation
  Invalid contract notation ""bootstrap1""
```"	merged	2020-04-17T14:40:41.212Z	2020-06-04T14:58:25.975Z	klakplok	2020-06-03T12:35:33.040Z			master	rb@ux/check-mode-base-dir-compat	richard.bonichon	14747364	3836952	9e0bd83b5230a7106ba0b3547f51f7bc15ae16d9			7	103	156	53	7
tezos/tezos	56094271	1763	3836952	Tests: fix some wrong type annotations	"- use_tls is a boolean, not an integer
- base_dir is an optional string.

use_tls does still require a deeper type refactorization. In the add_node, it is an optional tuple, and bool is used to convert, which will give UB"	merged	2020-04-17T15:59:39.112Z	2020-04-20T14:47:25.508Z	paracetamolo	2020-04-20T13:48:07.004Z			master	dannywillems@test-client-use-tls-wrong-type	dannywillems	9487506	3836952	089e339336f640cacc1340c53898b9ace3e76ac8			4	8	15	7	4
tezos/tezos	58552056	1821	3836952	Test/Stdlib: add tests for split	"Test the default behavior of split handles a duplicated separator. Test at the same time the behavior is the same with ~dup:true.

## How to test
```
cd src/lib_stdlib && dune build @runtest
```"	merged	2020-05-13T13:53:37.038Z	2020-06-22T16:40:10.970Z	adrianbrink	2020-06-22T16:40:11.049Z			master	dannywillems@stdlib-test-split-string	dannywillems	9487506	3836952	7b399de7378871a7219821b948a0ed17d754a7dd			3	95	98	3	3
tezos/tezos	56097081	1765	3836952	event_log: Fix level for Debug definition	"Also remove Event_default and force definitions to declare their
level accordingly."	merged	2020-04-17T16:36:12.327Z	2020-04-24T10:48:12.426Z	pirbo	2020-04-24T09:07:47.686Z			master	abate@log_level	abate	9487506	3836952	58c7c33e66f182b0b8c98eaedef9941586770c39			4	4	19	15	4
tezos/tezos	59579074	1840	3836952	Client: now the client binary accept an --endpoint argument to specify the RPC URL base	"Fixes: #861 

Currently to tell the client binary which RPC endpoint it should talk with one could only use the combination of `--addr` `--port` `--tls`. This has its limitation and doesn't support RPC servers that make uses of contextual path.

This MR introduces a new client argument `--endpoint` which allows the user to directly specify an RPC endpoint.

Also, this MR will disallow specifying both --endpoint and any of the other three options; and raise warning if any of --addr --port or --tls exists on either the cli args or in the config file

more specifically, the endpoint will be decided as below

```
  endpoint logic:
    1) if --endpoint provided as CLI argument,
       use it but check no presence of --addr, --port, or --tls
    2) otherwise, merge --addr, --port, and --tls with config file; then
         2a) if --endpoint exists in config file,
             use it but check no presence of merged --addr, --port, or --tls
         2b) otherwise synthesize --endpoint from --addr, --port, and --tls
```"	merged	2020-05-25T12:40:07.776Z	2020-08-10T08:55:13.183Z	pirbo	2020-07-13T14:39:57.976Z			master	hx-client-endpoint-arg	haochenxie	16805926	3836952	0dd6e836a1a764aa51c4c4a8909e947bd9f1171d			10	224	294	70	10
tezos/tezos	55981543	1759	3836952	"tests_python: Add a ""--singleprocess"" option for the node"	"By default, a sandbox node starts without this option. The validation
is therefore externalized to the binary `bin_validation`. This
prevents debug messages emit from `lib_validation` to be printed. 
Using the option `--singleprocess` the node binary also validates blocks. 
This may slow down the node since validation is blocking.

# How to test this MR
For a random test using a node,  call `pytest` with the option `--singleprocess` and a logging directory with the option `--log-dir`. In the log of the node, observe a line similar to `Apr 16 21:52:41 - block_validator_process_sequential: Initialized`."	merged	2020-04-16T19:50:03.854Z	2020-06-09T16:50:07.290Z	klakplok	2020-06-02T12:13:37.091Z			master	francois@test-python-singleprocess-option	Saroupille	9487506	3836952	7132b4e0427d4e2fd0ffc913967b3d5266bc8d8b		7132b4e0427d4e2fd0ffc913967b3d5266bc8d8b	3	24	31	7	3
tezos/tezos	55904301	1757	3836952	[WIP] block_validation: New error when validation pass number is wrong	"If the block validated announced a wrong number of validation pass,
meaning that `block.shell.validation_pass` is different from
List.length `operations` then, the current code fails with
` Error_monad.iteri2_p`. We add a new error
`inconsistent_block_number_of_operations` instead for this case.

TODO:

* [ ] Add a test"	closed	2020-04-16T09:07:49.811Z	2020-06-08T14:20:57.368Z			Saroupille	2020-06-08T14:20:57.380Z	master	francois@fix-block-validation-passes	Saroupille	9487506	3836952	da68b1f983546e5b6b9ec553be9cc3e01ddf94e8			3	17	17	0	3
tezos/tezos	55822187	1754	3836952	Test unaccounted STEPS_TO_QUOTA and interpreter errors	Superseded by https://gitlab.com/tezos/tezos/-/merge_requests/1758	closed	2020-04-15T15:29:22.886Z	2020-04-16T13:37:00.525Z			arvidnl	2020-04-16T13:37:00.673Z	master	arvid@test_unaccounted_steps_to_quota_and_interpreter_errors	arvidnl	9487506	3836952	ba98adc97ef85e3328ac6d38c6aee7a894364570			7	193	199	6	7
tezos/tezos	56090327	1761	3836952	event_logging: add ?(short=false) to pp_log_message	"This MR simple adds an option to `pp_log_message` to pretty print logs without metadata.

Reviewers: for context please read :

- https://gitlab.com/tezos/tezos/-/merge_requests/1743 ( original MR )
- https://gitlab.com/nomadic-labs/tezos/-/issues/91 ( context )
- https://gitlab.com/nomadic-labs/tezos/-/issues/142 ( associated discussion )
- https://docs.graylog.org/en/3.2/pages/gelf.html ( related documentation )
- https://gitlab.com/nomadic-labs/tezos/-/commit/82fdeaa014849b159fcb907379f52d4d1acc13eb ( poc )

"	merged	2020-04-17T15:12:19.535Z	2020-05-05T15:41:38.086Z	romain.nl	2020-05-05T15:41:38.109Z			master	abate@pp_short_log	abate	9487506	3836952	4660339f449d36a15489ce86301fda3402970aee			12	57	88	31	12
tezos/tezos	55899757	1756	3836952	tezos-codec: Fix command `dump encodings`	"The registration of the protocol `004-Pt24m4xi` makes this
command fails. Some encodings have the same name than the one of
other protocols. We fix this problem by removing this protocol from
the dependencies of `tezos-codec`.

### How to test this MR

Before this patch do `tezos-codec dump encodings`and see an error. Apply the patch and see that the command succeeds this time."	merged	2020-04-16T08:23:54.278Z	2020-04-16T10:03:29.984Z	pirbo	2020-04-16T10:03:30.017Z			master	francois@fix-tezos-codec-command	Saroupille	9487506	3836952	d437fb1279a270eb46bcf0b3174ca8e7fad0b94c		d437fb1279a270eb46bcf0b3174ca8e7fad0b94c	1	0	1	1	1
tezos/tezos	55802407	1751	3836952	Add documentation page for 7.0~rc1	"DO NOT MERGE YET - this should only be merged after the release candidate branch is actually created and checked.

This branch adds a new release page for 7.0~rc1. This page will be modified for 7.0 when we release 7.0, which will be a few days after 7.0~rc1 if all goes well.

This branch also adds a Latest Release section in the index page.

This MR is related to https://gitlab.com/tezos/tezos/-/merge_requests/1750 as the changelog is the same. If you have comments on the changelog, please make them there and I will modify this MR as well."	merged	2020-04-15T12:56:07.909Z	2020-04-16T16:25:24.059Z	pirbo	2020-04-16T16:25:24.108Z			master	romain-v7rc-doc	romain.nl	9487506	3836952	9735755064b0b35d1e4f77fb4692adba867c096d			2	199	199	0	2
tezos/tezos	56792213	1783	3836952	Test/Python: Refactor cryptography helpers	"We add a new module `crypto/crypto.py` which aims to encapsulate all the cryptograhic part needed by the `tests`. Consequently, we have refactored a bit the `tools/utils.py` module.

Accordingly, we have changed the two tests which use these features.

This refactor will be helpful in an upcoming MR to forge blocks, similarly to what it is done in `forge_transfer.py`.

# How to test this MR

Check that the following two tests works:

- `forge_transfer.py`: `python3 examples/forge_transfer.py`
- `test_double_endorsement.py`: `pytest tests_python/tests/test_double_endorsement.py`"	closed	2020-04-24T00:36:16.258Z	2020-07-17T08:33:46.269Z			Saroupille	2020-07-17T08:33:46.284Z	master	francois@test-python-refactor-crypto	Saroupille	9487506	3836952	2bacb08d209860ab72704483e07115b643f184cb			8	213	306	93	8
tezos/tezos	55802065	1750	3836952	Set version number to 7.0+dev and add CHANGES.md	"DO NOT MERGE YET - this should be merged just before the actual release (if new features are added in-between we will update the changelog accordingly).

This merge request adds a new `Version` module which contains the current version number. It is set to `7.0+dev` for `master`. It will be modified to `7.0~rc1` in the release branch (and then to `7.0`). This module is written in a way that allows a script to easily access this version number, and I have added such a script for convenience.

If you have made changes since the current Mainnet release that should be documented in the changelog, please review `CHANGES.md` to check that they are documented, and that the documentation is correct."	merged	2020-04-15T12:52:58.596Z	2020-05-11T14:07:17.157Z	pirbo	2020-04-16T14:19:48.736Z			master	romain-v7-version-and-changelog	romain.nl	9487506	3836952	f548bd02911b078c341566dba051ac92e63d841d			5	291	292	1	5
tezos/tezos	55946374	1758	3836952	Test unaccounted STEPS_TO_QUOTA and interpreter errors	"Related nomadic-labs/tezos#137. 

This MR adds a set of tests that tests that script_interpreter
error encoding-decoding is idempotent, that the interpreter returns
Bad_contract_parameter when executed with ill-typed
parameter. Finally, it asserts the behavior of STEPS_TO_QUOTA in the
absence of metering.

# Testing

 - run `dune build --force @src/proto_alpha/lib_protocol/test/runtest_proto_alpha`"	merged	2020-04-16T13:36:32.295Z	2020-04-23T22:00:11.432Z	rafoo_	2020-04-23T22:00:14.320Z			master	arvid@test_unaccounted_steps_to_quota_and_interpreter_errors_opam	arvidnl	9487506	3836952	15ff93cebabef32c26af163e152fcfecf6015df4		2bcf12be53dd7e3d7a12af97c5e2c02f5b5408b6	9	218	224	6	9
tezos/tezos	55813877	1753	3836952	Test deprecated instructions CREATE_CONTRACT/ACCOUNT & STEPS_TO_QUOTA	"Related nomadic-labs/tezos#137.

This MR introduces a set of tests for deprecated michelson instructions CREATE_CONTRACT/ACCOUNT & STEPS_TO_QUOTA.
Admittedly, these tests come a bit late since these are slated for removal (see https://gitlab.com/cryptiumlabs/tezos/-/merge_requests/125). However, if that MR is delayed then this might be useful. If the above MR is merged before, then I'll change this into a MR that ensures that the correct errors are emitted.

# Tests/Python: test deprecated CREATE_CONTRACT flags

This tests all combinations of the delegatable, spendable and
root_name on deprecated CREATE_CONTRACT instruction and ensures that the created contract, which goes through a transformation has the appropriate entrypoints.

I also found something weird: executing legacy `CREATE_CONTRACT` thus
```
        CREATE_CONTRACT
         { parameter (string %default) ;
           storage unit ;
           code { DROP; UNIT ; NIL operation ; PAIR } } ;
```
with either spendable or delegatable set to True, will originate a contract of type (in the case of spendable) `(or (lambda %do unit (list operation)) (string %default %default))`. Note the double annotation `%default`. I'm not sure if this is a bug. Even if it is, it is of limited importance since the CREATE_CONTRACT instruction is not used anywhere. 

# Tests/Python: test deprecated CREATE_CONTRACT/ACCOUNT & STEPS_TO_QUOTA

These tests run the deprecated instructions CREATE_ACCOUNT,
STEPS_TO_QUOTA and the deprecated version of CREATE_CONTRACT, ensuring
that they are still runnable through `tezos-client run script`.

# How to test:

 - `pytest tests_python/tests/test_contract_deprecated.py`"	merged	2020-04-15T14:18:53.181Z	2020-04-21T08:29:11.167Z	pirbo	2020-04-21T08:29:11.199Z			master	arvid@test_deprecated_instructions	arvidnl	9487506	3836952	eedd8818e09856887b6b6c244d9052d8473478c5		a25535ec93523f69ad369ae62647a87d05131df7	27	2551	2583	32	27
tezos/tezos	55627972	1747	3836952	Babylon: remove client tests	Some leftovers from 005 archivisation	merged	2020-04-14T07:11:00.112Z	2020-04-14T13:43:43.680Z	pirbo	2020-04-14T13:43:43.770Z			master	remove_005_client_tests	pirbo	9487506	3836952	82eecbac18d68b4480218611deb3ef68eb847b3e			5	5	1160	1155	5
tezos/tezos	55825245	1755	3836952	ci: add _build cache	"This small MR adds the cache for the `_build` directory.
This should speed up the compilation as dune is smart enough to recompile
only what is needed based on the previous run. The cache is per branch.

This is an example of build https://gitlab.com/nomadic-labs/tezos/-/jobs/512326877
"	merged	2020-04-15T16:01:27.726Z	2020-04-28T18:23:20.875Z	pirbo	2020-04-28T18:23:20.899Z			master	abate-ci-cache	abate	9487506	3836952	c98d5eb11c8a8a9449c20a07a66b9e070a0f77b6			1	4	4	0	1
tezos/tezos	56092811	1762	3836952	Spell check	Playing with my newly-installed vscode extension...	merged	2020-04-17T15:40:35.204Z	2020-05-11T20:39:42.460Z	pirbo	2020-04-21T08:56:15.808Z			master	mehdi@spellcheck	mbouaziz	9487506	3836952	b4e2ee668b203b3f576c464211de278965d9daa1			159	348	695	347	159
tezos/tezos	57869541	1804	3836952	Lwt-result-stdlib: some error-monad-aware, stdlib-like modules	This MR introduces `tezos-lwt-result-stdlib`, a library with `Set` and `Map` modules that are similar to `Stdlib`'s but without any exceptions. The ultimate aim is to shadow the `Stdlib`'s version to enforce use of the error monad.	closed	2020-05-06T10:09:47.583Z	2020-10-15T12:55:44.782Z			raphael-proust	2020-06-05T08:30:36.634Z	master	raphael@error-monad-with-bind-into-lwt	raphael-proust	9487506	3836952	33f609e474b8b604418a909bb69f45abc793e24f			64	2190	2587	397	66
tezos/tezos	55409021	1745	3836952	Doc: roll 10k -> 8k.		merged	2020-04-10T18:59:30.214Z	2020-04-14T07:12:46.389Z	pirbo	2020-04-14T07:12:46.813Z			master	patch-1	dannywillems	7148137	3836952	770de8b2f4e4ac9ec8624b60103f468d8af232a6			1	1	2	1	1
tezos/tezos	55209810	1742	3836952	Add the possibility to customize parameter pretty-printers in simple events	"This MR adds the possibility to customize the pretty-printer for parameters in simple event messages.

See https://gitlab.com/tezos/tezos/-/merge_requests/1663#note_313810331 for an example use case."	merged	2020-04-09T09:03:13.026Z	2020-04-09T14:58:17.741Z	klakplok	2020-04-09T14:44:48.197Z			master	romain-simple-events	romain.nl	9487506	3836952	68fddf17511393273620e24355214689cdb2da56			2	188	296	108	2
tezos/tezos	55701949	1749	3836952	WIP: Add version number	"This MR:
- adds the version number in the code;
- make `tezos-node --version` print this version number;
- ensures that scripts have access to the version number as well (through the `print_version.ml` script).

TODO:
- [ ] add a CI check to ensure that the `master` branch version is always `X.Y+dev`
- [ ] add a CI check to ensure that branches ending with `-release` have a name which is consistent with the version number in the code
- [ ] add `--version` flag to `tezos-client` and delegates"	closed	2020-04-14T16:08:14.136Z	2020-05-11T14:07:22.945Z			romain.nl	2020-05-11T14:07:22.957Z	master	romain-version	romain.nl	9487506	3836952	43ae257d79cab90dc417ac9177ab7b15b1db5913			4	143	144	1	4
tezos/tezos	55286984	1743	3836952	event_log: use pp_log_message with legacy logging	"This MR use Simple.pp_log_message to print in a more uniform fashion logs
for legacy logging modules :

- Debug
- Error
- Event
- Legacy

I've also exposed `Simple.pp_log_message` so all `Internal_log.Definition`
now use the same pretty print function and all variables are now structured.
This is a preliminary work to allow to attach more information to the logs."	closed	2020-04-09T15:58:26.771Z	2020-05-15T14:14:24.588Z			abate	2020-04-17T15:06:35.781Z	master	abate@internal_events_normalize	abate	9487506	3836952	2852abf5d0ac0d718b32d1c0e2d655342f7b400e			10	415	726	311	10
tezos/tezos	56463442	1775	3836952	[WIP] test_python: Forging blocks in Python	"We add a test which craft manually a block in Python.

This MR is rebased upon !1770 so that error from the protocols are visible.


# How to test this MR

- Use `pytest test_python/tests/test_forge.py`

# TODO

- [x] Craft manually a block
- [ ] Craft a block with a `seed nonce`
- [ ] Craft a block with transactions
- [ ] Check nonce revelations"	closed	2020-04-21T23:45:06.759Z	2020-04-23T14:08:58.567Z			Saroupille	2020-04-23T14:08:58.596Z	master	francois@test-forging-block	Saroupille	9487506	3836952	e781acbeb1b8ce6a4c543271f3a07a3d925edea8			13	824	980	156	13
tezos/tezos	56789325	1782	3836952	test python: Adding tezos-codec	"This MR adds a wrapper around `tezos-codec` for the framework python. It uses the the method `subprocess.run` from `python3.7` which is also used in !1659 . We also have added in `tests` a test of this binary which encodes and decodes some datatype. 

To have an access to the binary, we used the `sandbox` launcher via `sandbox.codec()`.

`tezos-codec` will be used in an upcoming MR which will craft blocks with RPCs.

# How to test this MR

Run the new test with the command `pytest test_python/tests/test_codec.py`.

# Dependencies 

The CI fails currently. We need to merge MR !1711 ."	merged	2020-04-23T22:53:55.057Z	2020-04-28T09:54:00.555Z	pirbo	2020-04-28T09:54:00.593Z			master	Francois@test-python-tezos-codec	Saroupille	9487506	3836952	239919e3ae2b3c8f2bf7ba5444d591ffd6b434fd			6	104	106	2	6
tezos/tezos	55047046	1737	3836952	Signer: Ledger backend is optional	The motivation is to compile the client when you don't have hidapi (or you don't want to link to this shared library because you'll distribute the software in binary format)	merged	2020-04-08T08:31:49.237Z	2020-04-08T17:37:45.373Z	pirbo	2020-04-08T17:37:45.404Z			master	optional_ledgerwallet	pirbo	9487506	3836952	77ce724b153965c9135c9ee475111677e21102b1			4	86	135	49	4
tezos/tezos	61236608	1887	3836952	Enhance {client,sandbox}.py APIs to enhance mockup tests and fix directory leak	"This MR is a follow up of https://gitlab.com/nomadic-labs/tezos/-/issues/164

Branch: https://gitlab.com/smelc/tezos/-/commits/smelc-enhance-mockup-tests-fix-leak

This MR does the following:

- [x] It fixes that `-base-dir` was specified twice when executing tezos commands in `client.py`
- [x] It fixes a directory leak. Every successful execution of `tests_mockup.py` leaves nine `tezos-client.*` directories dangling in `/tmp`. I'm to blame here since I'm the main author of this file :face_palm:, but that was my first tezos contribution ever and things were less clear at the time..
- [x] It deletes `client.py`'s method `set_base_dir` which was cumbersome and made initialization of the mockup harder to understand than it should be (and was doing a nefarious side effect). Similarly it deletes mockup specific stuff from `sandbox.py`: field `mockup_client` and method `add_mockup_client`. Initialization that doesn't use the fixture (negative tests) is now a bit more verbose, but it is easier to understand. I preferred the latter.
- [x] It moves a reusable fixture from `test_mockup.py` to the standard place: `conftest.py`
- [x] It extends the mockup's tests, so that `carthage` is tested (this unveiled https://gitlab.com/nomadic-labs/tezos/-/issues/200)

Suggested reviewers: @bidinger @rafoo_ @arvidnl"	merged	2020-06-11T09:19:24.237Z	2020-07-22T09:54:21.530Z	rafoo_	2020-07-22T09:54:21.541Z			master	smelc-enhance-mockup-tests-fix-leak	smelc	18024911	3836952	7e3ebe4ac55a181b1c0a4dbdcec919d77a0a39b0			6	250	430	180	6
tezos/tezos	55063091	1738	3836952	P2P: move errors to services	clients need to know about errors and not depend on implementations	merged	2020-04-08T10:50:35.923Z	2020-04-08T14:07:06.573Z	pirbo	2020-04-08T14:07:08.304Z			master	p2p_errors_in_services	pirbo	9487506	3836952	16c1feff225fbe941a169cd38f59dc46dc6f586a			8	51	96	45	8
tezos/tezos	55207854	1741	3836952	Shell/Logging: Use trace_encoding for trace in chain validator logging	as per https://gitlab.com/tezos/tezos/-/merge_requests/1705#note_320156491	merged	2020-04-09T08:41:39.812Z	2020-04-17T10:57:25.177Z	pirbo	2020-04-17T10:57:25.207Z			master	arvid@use_trace_encoding_for_in_chain_validator_logging	arvidnl	9487506	3836952	8b991521fa0a042f3a4721d2c50f71f60d1f4599		8b991521fa0a042f3a4721d2c50f71f60d1f4599	2	7	22	15	2
tezos/tezos	62954889	1941	3836952	Draft: Multipass without switch of protocol	"# Context

Once a node is bootstrapped, it may be interesting to adopt a pessimistic strategy when a node receives a new alternative branch. In particular, it may be interesting to reject quickly a branch with a wrong fitness.

This merge request implements a first version of the *multipass pipeline*, an alternative to the bootstrap pipeline. 

In this MR, the *multipass pipeline* is similar to the bootstrap pipeline but the node checks first that downloaded headers announced a correct fitness. 

In this MR, the *multipass pipeline* is trigerred only when the branch does not contain a switch of protocol and that the node is in the `Sync` state.

Other MR should follow this one to bring new features to the multipass pipeline. In particular:
- to support switching of protocols
- to check also consensus operations (endorsements)

More details in nomadic-labs/tezos#51

## Implementation details

- We add a proxy between `pipelines` and the `peer_validator` with the new `Pipelines` module. This way, the `peer_validator` is independent of the pipeline implementation
- To avoid copy/past between multipass pipeline and the bootstrap pipeline we have generalized the latter. In particular `bootstrap.create` now takes `Lwt_pipes` in parameter and the cancellation of a pipeline is now done by the `Pipelines` module.

# Manual tests

On main net, one should wait for an alternative branch to come. 

# Automatic tests

We have added new tests for the `Tezt` framework in the file `tezt/tests/sync_alt.ml`. You can try it with

`dune exec tezt/tests/main.exe -- quick -i`

Observe the log to know whether the synchronization mode is the multipass or not.

# Reviewers

@klakplok @vbotbol @vect0r @romain.nl @phink"	opened	2020-06-29T15:38:24.447Z	2020-10-08T22:12:09.269Z					master	francois@multipass-next-gen	Saroupille	9487506	3836952	4d3bbf09278ac0f959f9ffa05bb29c95f507f369			23	1235	1409	174	23
tezos/tezos	55092938	1739	3836952	Node: replace --disable-testchain with --enable-testchain	"Current `mainnet` branch has `--enable-testchain`, not `--disable-testchain`. In other words, testchain is disabled by default in the `mainnet` branch, but it is enabled by default on `master`.

We don't want to change this for next release, but next release is based on `master`. So this backports the current behavior.

The previous `mainnet` patch (commit `34e119888`) did not apply at all anymore so I made this from scratch. I tried to reuse the descriptions from `mainnet`. I think I made another difference compared to the patch in `mainnet`: I also changed the field in `Node.config`, whereas in `mainnet` this field is still `disable_testchain`."	merged	2020-04-08T12:50:27.763Z	2020-04-10T09:39:56.783Z	pirbo	2020-04-10T09:39:56.859Z			master	romain-testchain	romain.nl	9487506	3836952	f8e383057d7d447652b2f5342f83e92ead4324c3			8	34	68	34	8
tezos/tezos	55812339	1752	3836952	Test CREATE_CONTRACT with root name	"Related nomadic-labs/tezos#137.

Creating a contract with CREATE_CONTRACT with a root name field
annotation triggers a logic that internally removes the root name
during typing, and adds it back at interpretation. This test ensures
that the root name is present with the correct type.

To test:

 - `pytest tests_python/tests/test_contract.py -k test_create_contract_rootname`"	merged	2020-04-15T14:04:36.582Z	2020-04-21T09:15:53.872Z	pirbo	2020-04-21T09:15:54.637Z			master	arvid@test_CREATE_CONTRACT_rootname	arvidnl	9487506	3836952	44f5e2a5b1e3f8ca6e38f54c12e9a543ec122766			6	138	138	0	6
tezos/tezos	55042994	1736	3836952	Increase the maximimum file size for LMDB	"* Bump the context from 400GB to 800GB
* Bump the store from 40GB to 80GB"	closed	2020-04-08T07:50:36.403Z	2020-05-04T13:43:47.984Z			klakplok	2020-05-04T13:43:47.998Z	mainnet-lmdb	adrian/mainnet-lmdb-patch	adrianbrink	11412215	3836952	718d468a67cd9ba1deacd6859ef79a4030aed366			2	3	6	3	2
tezos/tezos	61048416	1881	3836952	Tezt: new test framework in OCaml for Tezos	"This MR introduces a new test framework for Tezos: Tezt.

Tezt should let developers write tests which are similar to existing Python and Flextesa tests, with the following focus:
- it lets you write tests in OCaml;
- it aims to be well-documented;
- it should be easy to write new tests;
- it should be easy to update the framework with missing features such as commands and RPCs;
- the output of tests should tell precisely what happens (at least in verbose mode) and be helpful to debug failing tests;
- no active waiting (polling): listen and react to events instead, to make tests run faster and be more reliable.

Currently, Tezt is composed of some generic, non-Tezos-related modules:
- a small `Base` module with some generally useful ""pervasive"" functions;
- a `Log` module to manage the output;
- a `Process` module to manage processes — the output of those processes is transparently logged;
- a `Temp` module to manage temporary files and directories;
- a `JSON` module with lightweight combinators to read JSON values;
- a `Cli` module which reads command-line options on startup, such as the list of tests to run and the verbosity level;
- a `Test` module with a `Test.run` function, which starts tests and cleans up after them.

Tezt also contains the following Tezos-specific modules:
- a `Constant` module with constants such as protocol hashes or identities;
- a `Client` module to run client commands;
- a `Node` module to run node commands and to manage node daemons;
- a `RPC` module with some RPC implementations.

Reviews are welcome as the author of the framework is the worst person to judge whether readability and ease of use have actually been achieved.

To test whether the framework contains enough features, we ported a Flextesa test (node synchronization). It also allows to compare the two frameworks.

To try out the framework with the default options, checkout the branch and run `make tezt`. I invite you to try out the following too:
```
# list command-line options
dune exec tezt/tests/main.exe -- --help

# various verbosities
dune exec tezt/tests/main.exe -- --verbose     # can also just use -v
dune exec tezt/tests/main.exe -- --info        # can also just use -i
dune exec tezt/tests/main.exe -- --commands    # can also just use -c

# keep temporary files for manual inspection
dune exec tezt/tests/main.exe -- --keep-temp

# only run tests with tag ""node"" and ""primary_archive"", and without tag ""secondary_rolling""
dune exec tezt/tests/main.exe -- node primary_archive /secondary_rolling

# list all tests and their tags
dune exec tezt/tests/main.exe -- --list        # can also just use -l
```

Finally, I invite you to look at the CI pipeline for this MR to find the `tezt:main` job and see how it looks, as it is particularly important for debugging that it is readable, especially in case the tests behave differently in the CI and in your computer.

Reviewers: @arvidnl @sribst"	merged	2020-06-09T14:30:18.923Z	2020-07-17T13:44:38.654Z	pirbo	2020-07-16T17:50:51.854Z			master	romain-tezt	romain.nl	9487506	3836952	a26a9a31f09e186cba77194409c8a934e723400e			38	4084	4084	0	38
tezos/tezos	55016129	1735	3836952	WIP: Tests/python: test fork testchain	"This is simple test which forks a test chain from genesis, using the command

```
tezos-client fork test protocol ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK with fitness 1 and key activator and parameters ./src/proto_alpha/parameters/test-parameters.json
```"	closed	2020-04-07T22:26:30.595Z	2020-04-10T20:23:49.032Z			bidinger	2020-04-10T20:23:49.054Z	master	philb@test_fork_testchain	bidinger	9487506	3836952	389ee01090402f3f4cd52e83924f0eaf0de4e2be			3	23	28	5	3
tezos/tezos	55114989	1740	3836952	internal_event: Fix the mutable variable `section`.	"A reference called `sections` was used to register the different
sections of the code so that they can be printed afterwards in the
manual of `tezos-node run`. However, this reference was not updated
with the new events modules such as `Simple` or the one from the
`Worker_logger`.

We have also renamed this variable to `registered_sections`.

# How to test this MR

Just run `tezos-node run --help`. You will see that in this MR more sections are printed.

# Open questions

One may notice that sections are not all consistent, eg: `node.chain_validator` vs `validator.chain`. Both are used in two different ways."	merged	2020-04-08T15:08:08.511Z	2020-04-21T10:30:35.496Z	pirbo	2020-04-21T10:30:35.566Z			master	francois@fix-sections-variable-internal-events	Saroupille	9487506	3836952	5aafe12277964e37e054b4ccbaed248ff968fd2a			4	32	39	7	4
tezos/tezos	57192510	1791	3836952	HACL* v2 Integration	"This MR replaces the vendored integration of the HACL* library with the newer version of HACL* which comes with [OCaml bindings](https://github.com/project-everest/hacl-star/pull/275). In addition to all the cryptographic primitives already used in Tezos, HACL* now also offers verified implementations of Blake2b and SHA-3. More details can be found in issue #589.

Main changes:
* The mixed use of Bigstring and Bytes throughout the lib_crypto interface has been replaced with just Bytes
* The HACL* snapshot in `vendors/ocaml-hacl` has been removed, with some of the code in `Hacl.ml`, along with the unit tests, having been moved to lib_crypto and adapted to the updated API. The HACL* library is now consumed as an opam package.
* `vendors/ocaml-blake2` has also been deleted
* Wherever possible, I also tried to simplify the interfaces in lib_crypto and streamline the usage of cryptographic primitives in the rest of the codebase.
 

Remaining tasks:
* [x]  Rework commit history
* [x]  When the `hacl-star` and `hacl-star-raw` packages are published to opam add them to `opam-repository` at generation time instead of directly in the repository and re-activate `check_opam_test.sh`
* [x]  Switch the lib_crypto interface to use Bytes everywhere, instead of a mixture of Bytes and Bigstring"	merged	2020-04-28T16:12:03.657Z	2020-07-08T12:53:39.108Z	pirbo	2020-05-19T17:31:59.492Z			master	victor-dumitrescu@evercrypt-general	victor-dumitrescu	9487506	3836952	ec4df12973234e94bf5ce869171e0b5d304ab0a7			111	1262	14670	13408	111
tezos/tezos	54957652	1731	3836952	Network flag is only a check, except for config init	"Replaces https://gitlab.com/tezos/tezos/-/merge_requests/1723

The fact that the configuration file is created automatically is confusing, in particular because it saves options such as `--connections` forever (and not just the `--network`, which was the original motivation).

Instead, this MR:
- removes the automatic configuration file generation;
- makes the `--network` flag only cause a check, it cannot modify the configuration, except for `config init`.

Here is an example user experience where one tries to run the node, which tells the user to initialize its configuration file. Then the user forgets the `--network` option, but `config init` has enough information in its output so that the user realizes and try again.

If the user runs the node on an existing Mainnet data directory without a configuration file, the node runs Mainnet:
```
$ ./tezos-node run --data-dir ~/tezos-mainnet
Apr  7 11:07:42 - node.main: starting the Tezos node (chain = TEZOS_MAINNET)
```
If the user tries to run with `--network carthagenet` on an uninitialized node (no config file) or a misconfigured node (wrong network), he gets an error:
```
$ ./tezos-node run --data-dir ~/tezos-carthagenet2 --network carthagenet
tezos-node: Error:
              Specified --network has chain name
              TEZOS_ALPHANET_CARTHAGE_2019-11-28T13:02:13Z, but current configuration
              implies expected chain name TEZOS_MAINNET. Use:
              tezos-node config init --network <NETWORK> to configure your node.
```
He should instead initialize as follows:
```
$ ./tezos-node config init --data-dir ~/tezos-carthagenet2 --network carthagenet
Created /home/romain/tezos-carthagenet2/config.json for network: carthagenet.
```
He can then run the node with the `--network` flag:
```
$ ./tezos-node run --data-dir ~/tezos-carthagenet2 --network carthagenet
Apr  7 11:06:37 - node.main: starting the Tezos node
Apr  7 11:06:37 - node.main:   (chain = TEZOS_ALPHANET_CARTHAGE_2019-11-28T13:02:13Z)
^C
```
or without the `--network` flag:
```
$ ./tezos-node run --data-dir ~/tezos-carthagenet2
Apr  7 11:06:37 - node.main: starting the Tezos node
Apr  7 11:06:37 - node.main:   (chain = TEZOS_ALPHANET_CARTHAGE_2019-11-28T13:02:13Z)
^C
```
or with the wrong `--network` value, in which case he gets an error:
```
$ ./tezos-node run --data-dir ~/tezos-carthagenet2 --network mainnet
tezos-node: Error:
              Specified --network has chain name TEZOS_MAINNET, but current configuration
              implies expected chain name TEZOS_ALPHANET_CARTHAGE_2019-11-28T13:02:13Z.
              Use: tezos-node config init --network <NETWORK> to configure your node.
```"	merged	2020-04-07T11:58:43.808Z	2020-04-14T16:52:10.285Z	pirbo	2020-04-14T16:52:10.345Z			master	romain-network	romain.nl	9487506	3836952	0cd130a34ea91f59b323e7e25ce4dbc5f6f9efb1			11	85	175	90	11
tezos/tezos	54993266	1733	3836952	Build: tezos-client-protocols do not depend on tezos-client-base-unix		merged	2020-04-07T17:01:01.507Z	2020-04-08T13:42:49.118Z	pirbo	2020-04-08T13:42:49.147Z			master	useless_opam_deps_proto_clients	pirbo	9487506	3836952	91d85165d5bdf45e1d2a877a896d0dce1de907b0			14	0	21	21	14
tezos/tezos	54863379	1727	3836952	Test/python: check progress in some tests	"Some ""multi node"" tests would pass even if all nodes stay stuck at genesis. This MR adds a ""test_progress"" method to make sure this incorrect behavior would indeed make the test fail."	merged	2020-04-06T14:40:22.591Z	2020-05-07T11:27:19.237Z	pirbo	2020-05-07T11:27:19.268Z			master	philb@tests_python_progress	bidinger	9487506	3836952	50fa4e9fc3f0c7188f2ffdd9ef914f5fdcd22213			3	13	13	0	3
tezos/tezos	54935896	1730	3836952	WIP:  fix protocol build with final_protocol_version		closed	2020-04-07T09:09:57.298Z	2020-04-07T09:19:41.997Z			sribar	2020-04-07T09:19:42.015Z	master	sylvain/add_final_protocol_to_compiler	sribar	11412215	3836952	655b966531902ef70d7df07ca3455e27a2669754			17	22	27	5	17
tezos/tezos	54878822	1728	3836952	Doc: Fixup links		merged	2020-04-06T16:21:26.078Z	2020-04-06T17:10:45.262Z	pirbo	2020-04-06T17:10:45.311Z			master	is_check_link_happy	pirbo	9487506	3836952	97d84051ca220a276cf5909a9c19ee316010316e			5	30	60	30	5
tezos/tezos	54846919	1726	3836952	WIP: Add tezos-codec-js	"This *WIP* add a new js library `tezos-codec` to the codebase.

The after the merge in master of hacl-star, part of the work from this MR
must be restarted from scratch.

------------

This library is created by compiling the vendorized crypto primitive with emsk to wasm
and transpiling the ocaml code with jsoo.

Each library has a battery of js tests to make sure the wasm memory representation matches
the jsoo memory representation and that the expected interface is functional.

The tezos-codec library is a simple object linking the wasm libraries and providing an
interface composed of 4 functions : list/describe/encode/decode

A nodejs (server side) poc and a frontend poc is availabe in this repository : gitlab.com:abate/test-js.git

Left to do is to to be squashed and polish the MR. Create a Vue.js component and integrate it
in the documentation.

associated issue : https://gitlab.com/nomadic-labs/tezos/-/issues/49

This MR needs two additional packages to be tested

```
export OPAMEXTERNALSOLVER=aspcud # often the opam internal solver dies on this dependency problem
opam remote add default --rank=-1
# opam install js_of_ocaml-lwt lwt.4.2.1 zarith_stubs_js
make build-deps
```

![Screenshot_2020-04-04_17-42-16](/uploads/a9a0bcab55258b16b0d6d0c9053e0344/Screenshot_2020-04-04_17-42-16.png)"	closed	2020-04-06T12:57:46.505Z	2020-09-03T16:25:35.403Z			abate	2020-09-03T16:25:35.298Z	master	abate@tezos-codec-js	abate	9487506	3836952	6a578938dd3ee0efb80773b196d0c0cf2bc27c58			72	5992	6082	90	72
tezos/tezos	54925205	1729	3836952	WIP: Build/OPAM: Fix generation of protocol dune files	"Generator of dune files for protocols now takes as argument a file listing of protocols for which the hash has to be the correct one. This file is not given when dune files are regenerated during compilation through opam.

Of course, my disgusting workaround is not the solution."	closed	2020-04-07T07:24:52.789Z	2020-04-07T15:58:19.747Z			pirbo	2020-04-07T15:58:19.764Z	master	fix_opam_generates_proto_dune	pirbo	9487506	3836952	eda2342ef95cc21c02ec7d985cb35ba26fa17998			15	15	16	1	15
tezos/tezos	55007246	1734	3836952	Shell: treat traces as traces not as lists of errors	Logging events in the shell treated traces as lists of errors. This commit fixes that.	closed	2020-04-07T20:18:01.439Z	2020-04-17T10:51:11.468Z			pirbo	2020-04-17T10:51:11.485Z	master	raphael@improve-shell-events	raphael-proust	9487506	3836952	1bad856c265774d84d3e67ec9ff8c6ae903536f8			2	12	22	10	2
tezos/tezos	54792934	1724	3836952	flextesa: Replace the deprecated `pure` function by `const`	The `pure` function of cmdliner is deprecated.	merged	2020-04-06T07:58:26.374Z	2020-04-06T12:42:36.722Z	pirbo	2020-04-06T12:42:36.814Z			master	francois@deprecated-cmd-liner-pure-to-const	Saroupille	9487506	3836952	e26f349d95df238ec53b0c4ba09c8b510858b9a1			7	27	54	27	7
tezos/tezos	54973587	1732	3836952	Build/OPAM: Fix generation of protocol dune files	"This MR fix the packaging problem introduce by https://gitlab.com/tezos/tezos/-/merge_requests/1691

This MR moves `final_protocol_versions` to `lib_protocol_compiler` and add it to the protocol packaging.


---- 
fixe https://gitlab.com/cryptiumlabs/tezos/-/issues/130"	merged	2020-04-07T14:04:32.599Z	2020-04-07T16:34:47.754Z	pirbo	2020-04-07T16:34:47.790Z			master	fix_opam_with_final_protocol_versions	sribar	11412215	3836952	8b89d58ce3bd5a8fbb2799e604563be377dce367			32	38	45	7	32
tezos/tezos	56250710	1770	3836952	"Support recursive errors and register Economic_protocol_error to solve ""consequence of bad union"""	"This MR is a cleaner version of https://gitlab.com/tezos/tezos/-/merge_requests/1376. See this MR to get a description of the initial problem and how to reproduce it.

The original solution(s) of !1376 were hackish at best (and actually did not work in all cases). This new MR proposes a new, cleaner approach.

~~One of the commits introduce a reference to increment a number which is added as a suffix to the name of the error encoding. This is because the error encoding is registered several times (with a growing set of cases), but we cannot register it with the same name. I'm not very happy with this but without this hack, `tezos-client rpc get /errors` fails with ""duplicate definition""… The drawback of this hack is that this RPC returns a weird structure with several error definitions that are mixed between each other. So, while this MR does solve the ""consequence of bad union"" error, it is still probably not the best implementation. I'm open for ideas to solve this without reworking the JSON encoding library completely.~~

The `Make` functor is applied once per protocol, and once for the shell. It is important to use different encoding names for all of them, and we do this. This fixes the above paragraph.

I believe this MR only works because JSON schemas are lazy. Otherwise, they would be generated several times for the same error type with a growing list of errors, and as those generated encodings share the same name it would not work."	merged	2020-04-20T11:34:53.763Z	2020-07-10T11:04:39.124Z	pirbo	2020-07-08T12:43:21.163Z			master	romain-mu	romain.nl	9487506	3836952	207bba8d811ad05612e01662a7fa72a57526e10c			6	411	512	101	6
tezos/tezos	54460055	1721	3836952	Draft: Replace static Michelson reference with interactive reference	"This is a follow-up on https://gitlab.com/tezos/tezos/-/merge_requests/1264

An important goal of the [interactive Michelson reference](http://michelson.nomadic-labs.com) is to replace the static Michelson reference in the documentation or more specifically, the section on core data types and instructions (as several sections of the static reference: annotations, macros, etc are not covered by this reference). Otherwise, the two references will diverge.

This MR removes those sections from the static reference and replaces them with pointers the interactive reference.

See also [the MR in the interactive reference](https://gitlab.com/nomadic-labs/michelson-reference/-/merge_requests/21) where I'm adding information present in the static reference but not in the interactive.

# Todo

 - [x] Host sources under tezos org repo
 - [x] Host generated documentation under tezos.gitlab.io
 - [ ] Make sure the static/interactive documentations are aligned
 - [ ] Clarify what of the static documentation is not covered by the interactive documentation.
       Examples currently of things not covered: macros, annotations, noop operations CAST and RENAME. 
 - [ ] Clear instructions for how to update the documentation (adding/remove/modifying instructions).
 - [ ] More longterm: move all of static (macros, annotations, ...) into the interactive one."	opened	2020-04-02T14:57:31.439Z	2020-08-27T10:46:35.936Z					master	arvid@doc_replace_old_michelson_ref_with_new	arvidnl	9487506	3836952	eb17a452f657051e4c1a961f4c368f0d601d09d8			2	14	1358	1344	2
tezos/tezos	54410649	1717	3836952	Docs/Michelson: Clarify restriction on APPLY arguments	"Arguments must be both pushable and storable, as discussed in #753,
due to the implementation APPLY (PUSH _ _; PAIR)."	merged	2020-04-02T08:05:44.185Z	2020-04-06T18:10:08.308Z	pirbo	2020-04-06T18:10:08.336Z			master	arvid@doc_fix_apply_documentation_pushable_storable	arvidnl	9487506	3836952	2df163ca128fe6e671724537fff45abe57787af8		2df163ca128fe6e671724537fff45abe57787af8	1	1	2	1	1
tezos/tezos	54410534	1716	3836952	Docs/Michelson: Clarify restriction on APPLY arguments	"Arguments must be both pushable and storable, as discussed in #753,
due to the implementation APPLY (PUSH _ _; PAIR)."	closed	2020-04-02T08:04:58.170Z	2020-04-02T08:05:05.468Z			arvidnl	2020-04-02T08:05:05.483Z	master	arvid@fix_apply_documentation_pushable_storable	arvidnl	9487506	3836952	ece3a5556a2590c9c20934f5ede540501404852c			1	1	2	1	1
tezos/tezos	54502521	1722	3836952	P2p_maintenance: don't send bootstrap in private mode.	"In private mode, unknown points cannot be contacted as they won't be
trusted, their is thus no use for asking point lists to other
peers (which should refuse to answer anyway).

This MR Fixes #751."	merged	2020-04-02T20:57:36.156Z	2020-04-03T18:54:42.410Z	pirbo	2020-04-03T18:54:42.966Z			master	julien@fix_private_mode_bootstrap	julien.t	9487506	3836952	7f21a790341c5778917315d275c79ca34ae634b5			1	15	25	10	1
tezos/tezos	54576815	1723	3836952	Make config file mandatory for run and snapshot import	"The fact that the configuration file is created automatically is confusing, in particular because it saves options such as `--connections` forever (and not just the `--network`, which was the original motivation).

Instead, this MR makes the configuration file mandatory. Here is an example user experience where one tries to run the node, which tells the user to initialize its configuration file. Then the user forgets the `--network` option, but `config init` has enough information in its output so that the user realizes and try again.
```
$ ./tezos-node run --data-dir ~/tezos-carthagenet                                    
tezos-node: Error:
              Configuration file not found: /home/user/tezos-carthagenet/config.json,
              create it with: tezos-node config init --network <NETWORK>
            
$ ./tezos-node config init --data-dir ~/tezos-carthagenet
Created /home/user/tezos-carthagenet/config.json for default network: mainnet.
$ rm ~/tezos-carthagenet/config.json 
$ ./tezos-node config init --data-dir ~/tezos-carthagenet --network carthagenet
Created /home/user/tezos-carthagenet/config.json for network: carthagenet.
$ ./tezos-node run --data-dir ~/tezos-carthagenet                              
Apr  3 11:00:57 - node.main: starting the Tezos node
Apr  3 11:00:57 - node.main:   (chain = TEZOS_ALPHANET_CARTHAGE_2019-11-28T13:02:13Z)
...
```"	closed	2020-04-03T09:05:21.700Z	2020-04-07T11:58:47.289Z			romain.nl	2020-04-06T14:22:53.033Z	master	romain-config	romain.nl	9487506	3836952	448b54d0ddf6346064582f4f76685a10f8a0f32c			7	60	84	24	7
tezos/tezos	54412044	1718	3836952	Remove Zeronet multinetwork alias	"As we removed Babylon delegates (baker etc.) and the proto_genesis_babylonnet protocol, which is actually also the genesis protocol of Zeronet, we cannot actually connect and bake on Zeronet. Users that want to do that need to use the zeronet branch instead.

Actually, the Babylon delegates for Zeronet were removed a long time ago, as Zeronet does not use BabyM1 but BABY5H."	merged	2020-04-02T08:19:39.280Z	2020-04-06T15:10:53.279Z	pirbo	2020-04-06T15:10:53.320Z			master	romain-zeronet	romain.nl	9487506	3836952	ed544a9563c1032ed1ce85af84e810d6b20cb971			4	1	29	28	4
tezos/tezos	54414069	1719	3836952	Everywhere: remove some traces of alphanet.sh	"The current `master` branch is broken because Docker images cannot be generated because the `Dockerfile` tries to copy `alphanet.sh`, which has been renamed into `tezos-docker-manager.sh`.

I took the opportunity to remove other traces of `alphanet.sh` in other places. It is still present in some places in the documentation, but we'll have to wait until the release to fix them."	merged	2020-04-02T08:42:42.868Z	2020-04-06T16:15:34.428Z	pirbo	2020-04-06T16:15:34.605Z			master	romain-docker	romain.nl	9487506	3836952	ddff22ab50c3c0bfa2fcf00744956c614b86fb10			6	35	61	26	6
tezos/tezos	54277464	1712	3836952	Remove proto-genesis-babylonnet and the Babylonnet test network	Babylonnet is no longer supported starting from April 1st.	merged	2020-04-01T08:15:28.086Z	2020-04-01T12:40:58.637Z	pirbo	2020-04-01T12:40:58.673Z			master	romain-genesis-babylonnet	romain.nl	9487506	3836952	e2609fc237aa4fa04b09a12d4c5fa56918618f54			30	12	1072	1060	30
tezos/tezos	54434336	1720	3836952	Allow overriding of certain protocol constants and bootstrap accounts	"Based on https://gitlab.com/tezos/tezos/-/merge_requests/1703 (merge that one first).

Now `create mockup` accepts a new option `--protocol-constants` which allows
us to specify a file with overrides for some of the protocol constants.

Similarly, `--bootstrap-accounts` can be used to specify a custom set of bootstrap
accounts in this format:

```
[
    {
        ""name"": ""bootstrap1"",
        ""sk_uri"": ""unencrypted:edsk2uqQB9AY4FvioK2YMdfmyMrer5R8mGFyuaLLFfSRo8EoyNdht3"",
        ""amount"": ""4000000000000""
    },
    {
        ""name"": ""bootstrap2"",
        ""sk_uri"": ""unencrypted:edsk3gUfUPyBSfrS9CCgmCiQsTCHGkviBDusMxDJstFtojtc1zcpsh"",
        ""amount"": ""4000000000000""
    }
]
```"	merged	2020-04-02T12:01:36.245Z	2020-06-15T10:59:35.800Z	klakplok	2020-05-05T22:13:50.337Z			master	mkarpov@issue-118	mrkkrp	14747066	3836952	63a363029c2a5f9b48170ec972162f71ce81c180			11	396	443	47	11
tezos/tezos	54134765	1706	3836952	Build: Remove 005-PsBabyM1 from the active protocols	Babylon area in Mainnet is over and Babylonnet end of life has come.	merged	2020-03-31T08:27:34.606Z	2020-03-31T15:32:31.018Z	pirbo	2020-03-31T15:32:31.063Z			master	inactive_babylon_opam	pirbo	9487506	3836952	5d50f7a5ab400ae857c0478fa29fa135954fb6ba			127	116	19950	19834	127
tezos/tezos	54187173	1708	3836952	Tests/python: skip failing test in test_example	This tests spuriously fails to due a harmless bug. In the meantime we just skip it.	merged	2020-03-31T15:39:11.102Z	2020-04-02T11:00:44.093Z	romain.nl	2020-04-02T09:42:23.053Z			master	philb@fix_test_example	bidinger	9487506	3836952	5aa9dd61bff520183c5009336136e27dd986bc11			1	12	12	0	1
tezos/tezos	57052931	1790	3836952	Support for `chain_id` parameter in mockup client	"This MR solves issue https://gitlab.com/nomadic-labs/tezos/-/issues/143
This depends on !1800. 

It thus allows the user to specify a `chain id`, either on the command line (`--chain-id-seed` option) or through the configuration file that overrides protocol parameters `--protocol-constants`.

The command line option generates a valid chain id from the given seed. "	merged	2020-04-27T15:41:45.089Z	2020-08-20T15:37:42.026Z	adrianbrink	2020-06-22T15:38:44.786Z			master	rb@chain_id_parameters	richard.bonichon	14747364	3836952	127438f54849376e77a7235f2ba27887404997cb			23	447	617	170	23
tezos/tezos	55434535	1746	3836952	Add tests for persistent mockup mode	"This MR add tests for the features introduced in !1720. Fixes https://gitlab.com/nomadic-labs/tezos/-/issues/115.

branch: https://gitlab.com/smelc/tezos/-/commits/smelc@mockup-client-tests

This is done by adding the new file `tests_python/tests/test_mockup.py`. Meaningful additions to existing file include the addition of the field `mockup_client` to `sandbox.py`'s `Sandbox` class. This additional field keeps track of the state of the mockup.

Code in this MR was authored both by @mrkkrp and myself as I picked up where Mark had stopped."	merged	2020-04-11T13:44:51.850Z	2020-06-10T09:48:18.742Z	romain.nl	2020-05-18T14:27:06.668Z			master	smelc@mockup-client-tests	smelc	18024911	3836952	3416bfcf28f55c0def9e2dc3e172b2cf23147533			4	356	372	16	4
tezos/tezos	54166994	1707	3836952	Contract entrypoint tests	"Increase coverage in script interpreter. 

This MR introduces three tests:
1. Test the `CONTRACT` instruction with/without entry point annotation on address parameters with / without entrypoint annotations. 
2. Test that `CONTRACT %default` is disallowed.
3. Add a test running the `multiple_entrypoints_counter.tz` script."	merged	2020-03-31T13:03:18.890Z	2020-04-09T13:57:46.615Z	klakplok	2020-04-02T15:50:22.589Z			master	arvid@CONTRACT_entrypoint_tests	arvidnl	9487506	3836952	8ab3e0c8dcf109eb52bcd289200c28f2ad2d137b		e3ac24fab8d0e2b310b0348ba53bae3a385be363	4	114	118	4	4
tezos/tezos	54353934	1714	3836952	Tests coverage: update to bisect_ppx2.3	"Followup of tezos/tezos!1626 (task nomadic-labs/tezos#54):

- update to bisect_ppx version 2 to fully support OCaml 4.08 syntax
  - but some Tezos code involving closures with optional arguments had to be modified to please the OCaml typechecker on the instrument code
- use `--bisect-file` (https://github.com/aantron/bisect_ppx/pull/303, merged in bisect_ppx 2.3) which allows getting rid of `BISECT_FILE` variable and the `coverage-setup` Makefile rule.
- improve the instrumentation script to
  - avoid overwriting symlinks
  - find dune files recursively (now just use `scripts/instrument_dune_bisect.sh .` to instrument everything)
  - `--remove` to remove the directive from files"	merged	2020-04-01T16:53:38.531Z	2020-06-02T10:45:24.627Z	rafoo_	2020-05-05T20:11:21.908Z			master	mehdi@bisect_ppx2	mbouaziz	9487506	3836952	64a4f1d6463a7dbbdc8745818c6887cf3edc93c3			15	211	332	121	15
tezos/tezos	54080326	1703	3836952	Mockup client: Further UX improvements	"See https://gitlab.com/nomadic-labs/tezos/-/issues/119.

There were two layers of identical checks: one in
create_mockup_command_handler and another one in create_mockup itself. I
combined the checks so that they are now only in create_mockup.

The function classify_base_dir contains all the logic for analysis of the
state of base_dir, so I re-used it in create_mockup. Now we do create
base_dir if it is missing but only when it did not exist or was empty. These
conditions should be enough to prevent it from overwriting existing data. In
addition to that we indicate the fact that a new directory was created by
printing a message.

I also made classify_base_dir more precise: it now recognizes another
pathological case when base_dir is a file. It looks like the old
implementation was buggy: when given a file it would declare that the
directory does not exist.

I also renamed mockup_mode into client_mode, because it includes
Mode_client, which has nothing to do with mockup.

Now if base dir is a mockup, then we make sure to fail if mockup mode is not
activated.

Finally, we error out when user specifies a different protocol from the one the mockup was created with.

To merge after https://gitlab.com/tezos/tezos/-/merge_requests/1697 (it is based on it)."	merged	2020-03-30T18:51:28.539Z	2020-04-14T17:39:30.090Z	pirbo	2020-04-14T17:39:30.214Z			master	mkarpov@issue-119	mrkkrp	14747066	3836952	6c17196b694c2a6a02d4ab560c7dd7d55894ede5			8	105	180	75	8
tezos/tezos	55679537	1748	3836952	WIP: Add `--max-open-fd` option to node capping file descriptors used by p2p	"This MR adds a new option `--max-open-fd` to the `tezos-node run` command to cap the node use of file descriptors.
When this cap is exceed, new connections are delayed until a fd can be used.

Context :
- https://gitlab.com/nomadic-labs/tezos/-/issues/104 ( meta issue )
- https://gitlab.com/tezos/tezos/-/issues/664 ( associated issue )
- https://gitlab.com/tezos/tezos/-/issues/335 ( associated issue )
- https://gitlab.com/tezos/tezos/-/merge_requests/588 ( associated MR )"	closed	2020-04-14T13:18:54.611Z	2020-09-03T16:25:00.288Z			abate	2020-09-03T16:25:00.154Z	master	abate-p2p-fd	abate	9487506	3836952	6f0eec2e5a01eb28d0b31770548a245b33224021			15	217	309	92	15
tezos/tezos	54225969	1710	3836952	Makefile: add new test targets	"Currently, there is no target in the Makefile that runs the full test suite, or launch different types of tests separately.

This MR:
* defines more specialized test targets (`test-unit`, `test-python`, `test-flextesa`, `test-tezt`, `lint-opam-dune`)
* the existing target `test` now runs everything, including python tests and tezt tests
* update the testing doc, and the CI accordingly

The goal of this MR is to:
1. give the ability to the users to only run the framework(s) they use and have configured on their machine (at least be able to run a fast `make test-unit`)
2. add a little more structure and symmetry to the Makefile (all test targets follow a convention `make test-*`)

TODO:
- We could do a similar pass to make linting targets more uniform (`make lint-*` left for a different MR)
- Not clear why `make test` depends on `lint-opam-dune`. More generally, we should provide better separation between `test` and `lint`.

I'd like to address these two points in a separate MR."	merged	2020-03-31T20:39:12.232Z	2020-09-08T16:00:43.268Z	mbouaziz	2020-09-08T16:00:43.362Z			master	philb_makefile_test	bidinger	9487506	3836952	7a4aa43dec3aa6ef34aa9e4e31970098c9ed96dd			3	49	66	17	3
tezos/tezos	54236356	1711	3836952	Tests: improve test environment	"See also https://gitlab.com/tezos/opam-repository/-/merge_requests/95


- Move to Python ^3.8 (3.8.2 in the CI)
- Use poetry to sandbox the test environment
- Change the CI to use the new setup
- Update the documentation accordingly
- Update the targets in the Makefile of the python tests to be executed
  in the poetry safe environment
- Reduce the requirements to the minimum.
- Fix https://gitlab.com/tezos/tezos/-/issues/663. `mypy` updated to 0.782`.
- Fix https://gitlab.com/tezos/tezos/-/issues/630. The python version is given in pyproject.toml.
- Fix https://gitlab.com/tezos/tezos/-/issues/632. Use poetry for that. Also, the dependencies are locked in the `poetry.lock` file. This file can be generated with `poetry lock` (and must be!).

## Some additional notes:
- Related to #680 
- Recommended in the doc to use `pyenv` to manage different python versions
- `poetry` is used to create a sandbox execution environment, and also be more strict on the versions (lock the versions and use hashes).
- commands must be run with the prefix `poetry run` when there is a `pyproject.toml` file.
- another MR will be created if this one is accepted to use poetry in the documentation too. See #750.

## TODO

- [x] Remove the REMOVEME. Related to !1708 
- [x] Test on different machines/setups.
- [x] requirements in opam-repository is useless now no?
- [x] if possible, get rid of the additional template defined in the YAML file."	merged	2020-03-31T22:47:20.791Z	2020-09-09T14:01:18.032Z	pirbo	2020-08-24T18:47:34.960Z			master	dannywillems@improve-tests	dannywillems	9487506	3836952	b1f564b445bcf1921c0e8c6a0ebfb2e93eb2a1f0			16	840	1014	174	16
tezos/tezos	54357539	1715	3836952	Shell : purge legacy logging in Distributed_db	"Related : #721 

Depends on : !1482 

This MR :

* removes legacy logging from distributed_db
* removes legacy logging from distributed_db_messages
* removes legacy logging from p2p_reader
* removes legacy logging from distributed_db_requester"	merged	2020-04-01T17:38:04.426Z	2020-06-10T09:09:44.040Z	pirbo	2020-06-10T09:09:44.073Z			master	colin-lib_shell-purge-legacy-logging-distributed-db	colin.g	9487506	3836952	0384910785263869257089292d0ede8891bafa6c		0384910785263869257089292d0ede8891bafa6c	6	70	116	46	6
tezos/tezos	55378255	1744	3836952	[WIP] test-python: Add a default logging directory	"With this commit, if the user does not provide a logging directory,
we create a default directory for each class. This default directory is `tezos-pytest` which contains all the logs generated by `pytest`.

# How to test this MR

Once in `test_python` directory, just execute `make` or any test. A default directory in `/tmp/tezos-pytest/<timestamp>` has been created and it contains several directories which correspond to a class that has been tested. The name of this directory is `file-class` since there might be several classes with the same name.

# Open questions

- Right now there is no way to prevent the creation of this default directory.
- Instead of having one folder named `file-class` we could have one more directory level such as `file/class`"	closed	2020-04-10T14:32:20.566Z	2020-06-10T09:23:13.579Z			Saroupille	2020-06-10T09:23:13.595Z	master	francois@common-log-dir-tests-python	Saroupille	9487506	3836952	35170498ac9a242a694bd6526c2a28e7a8677f2a			1	37	42	5	1
tezos/tezos	54195727	1709	3836952	Internalize (our own) pbkdf and bip39 in tezos_client_base	"The only turbulence is that it means that tests of lib_protocol depend on tezos-client-base because they use Bip39.

We don't release Pbkdf publicly and independently because it already exists! (but diverges from our by using mirage-crypto instead of HACL for its primitives). Bip39 uses pbkdf and therefore cannot be released as an independent package given that pbkdf isn't."	merged	2020-03-31T15:56:13.196Z	2020-04-06T18:54:24.946Z	pirbo	2020-04-06T18:54:24.981Z			master	internalize_bip39_opam	pirbo	9487506	3836952	9162f4e676d73c3dc31b2175bd3ba81487f163f9			47	606	1119	513	48
tezos/tezos	61005062	1880	3836952	rehaul lwt exit	"`Lwt_exit` (part of `src/lib_stdlib_unix/`) is entirely rewritten to

- give more expressiveness (especially to give enough flexibility to be used in our different binaries)
- handle signals correctly
- tests

Reviewers: @raphael-proust @klakplok @vbotbol

Fixes: https://gitlab.com/tezos/tezos/-/issues/565  
Should also fix: hash five nine one (not writing it out to avoid gitlab autoclosing on merge)"	merged	2020-06-09T09:15:10.688Z	2020-07-22T13:00:20.510Z	pirbo	2020-07-22T13:00:20.531Z			master	raphael-p@improve-lwt-exit	raphael-proust	9487506	3836952	698523eae98a7cdfbc642241ee59f0a175d88786			35	1350	1553	203	35
tezos/tezos	62037665	1918	3836952	Consolidate ban/unban trust/untrust rpc calls in one / clarify the semantic of the greylist and whitelist/blacklist / change the semantic on unban addr to also unban the all associated peers.	"This MR proposed 4 rleated changes:

- Consolidate ban/unban trust/untrust rpc calls in one
- clarify the semantic of the greylist and whitelist/blacklist
- change the semantic on unban addr to also unban the all associated peers.
- adds P2p_addr.rpc_arg. This might be needed in the future.

# RPC calls

the ban/unban , trust/untrust RPC calls for peers and points are all GET rpc calls. 

However these calls are not read only calls, but they change the state of a point/peer and 
as such do not respect the REST standard for RPC calls.

This MR deprecates these rpc calls and introduce two new RPC calls of type `PATCH` .

The payload is a union type defined by the following encoding : 
```
type patch_input = [`Ban of bool | `Trust of bool]

let patch_input_encoding =
  let open Data_encoding in
  union
    [ case
        (Tag 0)
        ~title:""ban""
        (obj1 (req ""ban"" bool))
        (function `Ban v -> Some v | _ -> None)
        (fun v -> `Ban v);
      case
        (Tag 1)
        ~title:""trust""
        (obj1 (req ""trust"" bool))
        (function `Trust v -> Some v | _ -> None)
        (fun v -> `Trust v) ]
```

The client was also adapted to use these new calls and I removed the old now unused services.

Incidentally I've also added the `patch` verb to the tezos-client and to lint a few things in the python framework. 

# Semantic

(copied from https://gitlab.com/tezos/tezos/-/merge_requests/1416 )

Banning an address will effectively ban all the peers from this address. So unbanning this address will unban also all the peers from the same address.

If we consider the NAT case, in order to have multiple nodes running behind a nat you need to manually assign a port to each node. So the network administrator is responsible for this. Banning an ipv4 address will basically punish the sysadm that configured the nat in the first place.

In case of ipv6, it is true that you can have as many peers as many ports you have on the machine, but it is still unlikely that you will unwillingly ban a peer running on the same ipv6 address of another misbehaving peer that is not under the control of the same admin.

For me is about who I am punishing when I ban an address. In all cases, it is the admin of the machine responsible for the node running on that machine rather than the user running the node. And in almost all cases this is the same person.

On the other hand banning/unbanning just one peer (as it is now) makes sense, as an admin can decide to ban an identity, that is the admin of the node.

Reg the last point, I don't think there should be an ungreylist . The admin can configure the grace period, or clean the table all together, but not remove just one. The idea of greylisting is that it is an automatic anti-spam measure.

The admin can whitelist the address is he doesn't want it to be greylisted.

Also there is not only ban/unban, but also trust/untrust. The first acting on the blacklist, the second on the whitelists.

## Proposed changes :
- ban also disconnect and ban all peers associated to this address
- unban also unban all peers associated to this address.

Reviewers: @julien.t @vivienpe"	opened	2020-06-19T12:54:07.492Z	2020-10-27T09:41:09.275Z					master	abate@p2p_rpc_patch	abate	9487506	3836952	b2fc4a8a0f6dcd931ff3ae85b38fe67e9ee7bb84			14	321	425	104	14
tezos/tezos	54075067	1701	3836952	Small refactorization of block_validator_process	"1. `lib_validation/block_validation.mli`: introduces a type
   `apply_environment`

2. `lib_validation/block_validation.ml:check_liveness`:
   remove the unecessary `Lwt.bind`

3. `lib_shell/block_validator_process.ml:`:
   Introduce an error `Failed_to_get_live_blocks`

4. `lib_shell/block_validator_process.ml`:
   Make the internal structure of the external validation and
   internal validation uniform

5. `lib_shell/block_validator_process.ml`:
   Introduce an existential type to avoid the pattern matching
   between Internal/External validation

(see nomadic-labs/tezos#131)"	merged	2020-03-30T17:40:03.033Z	2020-06-11T11:08:21.836Z	pirbo	2020-06-11T11:08:21.876Z			master	francois@refactor-bvp	Saroupille	9487506	3836952	51884ce8407f0386b100e8822796f3f76518bd0f			11	460	748	288	11
tezos/tezos	54121871	1705	3836952	Shell: Purge legacy logging in node	"Related: #721.

Depends on !1662 and !1663. 

This MR has three commits:
 1. remove legacy logging from node
 2. remove aliasing of *_validator limits, as discussed below. 
 3. test node logging

How to test:
 - run `dune runtests` in `src/lib_shell/test`
 - triggering the events manually:
   1. `export TEZOS_EVENTS_CONFIG=file-descriptor-stdout://` to see events in JSON on stdout.
   2. p2p_layer_disabled:
      - start the node in sandboxed mode: `./tezos-node run --sandbox=sandbox-parameters.json --data-dir=tmp` you should see a `p2p_layer_disabled` msg
   3. bootstrapping, p2p_maintain_started
      - start the node normally: `./tezos-node run`"	merged	2020-03-31T06:27:44.719Z	2020-06-09T08:49:01.360Z	arvidnl	2020-06-09T08:49:01.386Z			master	arvid@lib_shell_purge_legacy_logging_node	arvidnl	9487506	3836952	fb82767d6bd24712216f3b9a4ecfd00e29646c32			10	430	561	131	10
tezos/tezos	54082104	1704	3836952	Doc: document Micheline in its own documentation page	"We move the documentation of Micheline to its own page and extend it.

TODO:
- [x] check links and RST formatting
- [x] add links
"	merged	2020-03-30T19:17:37.977Z	2020-04-22T08:45:35.344Z	adrianbrink	2020-04-22T08:45:35.385Z			master	rafoo@doc_micheline	rafoo_	9487506	3836952	b5a0a2b69ae89f1aa363bf7dc389d03141482c78			3	320	408	88	3
